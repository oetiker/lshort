% The Not So Short Introduction to LaTeX
%
% Copyright (C) 1995--2022 Tobias Oetiker, Marcin Serwin, Hubert Partl,
% Irene Hyna, Elisabeth Schlegl and Contributors.
%
% This document is free software: you can redistribute it and/or modify it
% under the terms of the GNU General Public License as published by the Free
% Software Foundation, either version 3 of the License, or (at your option) any
% later version.
%
% This document is distributed in the hope that it will be useful, but WITHOUT
% ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
% FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
% details.
%
% You should have received a copy of the GNU General Public License along with
% this document.  If not, see <https://www.gnu.org/licenses/>.

% !TEX root = ./lshort.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Contents: Customising LaTeX output
% $Id$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Customising \LaTeX}\label{chap:custom}

\begin{intro}
  Documents produced with the commands you have learned up to this
  point will look acceptable to a large audience. While they are not
  fancy-looking, they obey all the established rules of good
  typesetting, which will make them easy to read and pleasant to look at.

  However, there are situations where \LaTeX{} does not provide a
  command or environment that matches your needs, or the output
  produced by some existing command may not meet your requirements.

  In this chapter, I will try to give some hints on
  how to teach \LaTeX{} new tricks and how to make it produce output
  that looks different from what is provided by default.
\end{intro}

\section{New Commands, Environments and Packages}

At the beginning of this book we have mentioned that \LaTeX{} allows us to
write documents using logical markup, with commands like \csi{emph} or 
\csi{section}. There may be however situations where \LaTeX{} does not provide
 an appropriate command for the content you want to write about.
You may have noticed that all the
commands I introduce in this book are typeset in a box, and that they show up
in the index at the end of the book. There is no \LaTeX{} markup to format 
example code or commands, but \LaTeX{} allows me to define my own commands 
for this purpose.

\begin{example}
\begin{lscommand}
  \csi{dum}
\end{lscommand}
\end{example}
In this example, a new environment called
\ei{lscommand} draws a box around the
command, and a new command named \csi{csi}, typesets the command
name and makes a corresponding entry in the index. Check
this out by looking up the \csi{dum} command in the index at the back
of this book, where you'll find an entry for \csi{dum}, pointing to
every page where we mention the \csi{dum} command.

If I ever decide that I do not like having the commands typeset in
a box any more, I can simply change the definition of the
\ei{lscommand} environment to create a new look. This is much
easier than going through the whole document to hunt down all the
places where I have used some generic \LaTeX{} commands to draw a
box around some word.

\subsection{New Commands}\label{sec:new_commands}

You have already learned some basic command creation in
\autoref{sec:simple_commands}. The main command is the
\begin{lscommand}
  \csi{NewDocumentCommand}[name:M, argspec:m, definition:m]
\end{lscommand}
It requires three arguments: the \carg{name} of the command you want to create,
the \carg{argspec} (argument specification) and the \emph{definition} of the
command.

The \carg{argspec} argument specifies the number and types of arguments the
command receives. The two most important types are \cargv{m}, for
\emph{mandatory} and \cargv{o} for \emph{optional}. To create a command that
takes two optional arguments, then two mandatory, then again one optional and
finally three mandatory you would write \cargv{oommommm}. If the \carg{argspec}
argument is empty then the command will take no arguments, as you have already
seen.

This example defines a new command called \csi{tnss}. This is
short for \enquote{The Not So Short Introduction to \LaTeX}. Such a command
could come in handy if you had to write the title of this book over
and over again.

\begin{example}
\NewDocumentCommand{\tnss}{}{%
  The not so Short Introduction
    to \LaTeX}
This is \enquote{\tnss} \ldots{}
\enquote{\tnss}
\end{example}

The next example illustrates how to define a new command that takes two
arguments. In order to refer to the received arguments you use
\mintinline{latex}|#1| for the first argument, \mintinline{latex}|#2| for the
second, and so on.

\begin{example}
\NewDocumentCommand{\txsit}{mm}
 {This is the \emph{#1}
  #2 Introduction to \LaTeX}

% in the document body:
\txsit{not so}{short}

\txsit{very}{long}
\end{example}

If your command accepts an optional argument, but the user does not supply one,
a special marker \cargv{-NoValue-} will be inserted instead.
\begin{example}
\NewDocumentCommand{\txsit}{om}
{This is the \emph{#1}
  #2 Introduction to \LaTeX}

% in the document body:
\txsit{definitive}

\txsit[very]{long}
\end{example}
In order to test whether the user supplied a value, use
\begin{lscommand}
  \csi{IfValueTF}[argument:m, value version:m, no value version:m]
\end{lscommand}
macro.
\begin{example}
\NewDocumentCommand{\MyCommand}{o}{
  \IfValueTF {#1} {
    Optional argument: #1.
  } {
    No optional argument given.
  }%
}

\MyCommand\\
\MyCommand[hello]
\end{example}

There are two variations of it: \csi{IfValueT} and \csi{IfValueF} which may
be used if you only need output for one of the branches. The example with
\cargv{-NoValue-} in the output could be fixed by writing
\begin{example}
\NewDocumentCommand{\txsit}{om}
{This is the
  \IfValueT{#1}{\emph{#1} }%
  #2 Introduction to \LaTeX}

% in the document body:
\txsit{definitive}

\txsit[very]{long}
\end{example}
The commands \csi{IfNoValueTF}, \csi{IfNoValueT} and \csi{IfNoValueF}
work exactly the same, but the value\slash{}no-value branches are swapped.

Often you will want to use optional arguments when present but use some default
values when the user does not provide them. This could be achieved by
\csi{IfValueTF}, but with the \cargv{O} argument a default value can be set directly.
It works like \cargv{o} but allows setting a default
if no value is supplied. Write

\begin{example}
\NewDocumentCommand{\txsit}{O{not so}m}
{This is the \emph{#1}
  #2 Introduction to \LaTeX}

% in the document body:
\txsit{definitive}

\txsit[very]{long}
\end{example}

Another useful argument specification is \cargv{s}, short for star. This
argument allows providing different definitions based on whether the
starred or non-starred version of command was issued by the user. It uses
\csi{IfBooleanTF} command (and its variations\csih{IfBooleanT}\csih{IfBooleanF})
that works like the \csi{IfValueTF} command.

\begin{chktexignore}
  \begin{example}
\NewDocumentCommand{\txsit}{sO{not so}m}
{This is the \emph{#2}
  #3 Introduction to \LaTeX%
  \IfBooleanT{#1}{%
    : Superstar Edition%
  }%
}

% in the document body:
\txsit{long}\\
\txsit*{long}
\end{example}
\end{chktexignore}

These are just the most common argument specifications. For a full description,
take a look at the~\cite{usrguide3}.

As we have discussed in \autoref{sec:simple_commands}, \LaTeX{} will not allow
you to create a new command that would overwrite an existing one, you can do so
using \csi{RenewDocumentCommand}. It uses the same argument specification
syntax as the \csi{NewDocumentCommand} command.

In some cases you might want to use the \csi{ProvideDocumentCommand} command.
It works like \csi{NewDocumentCommand}, but if the command is already defined,
\LaTeX{} will silently ignore the new definition. Yet another variant is the
\csi{DeclareDocumentCommand}. It always creates the given command, overwriting
old definition if it exists.

\subsection{New Environments}
The \csi{NewDocumentEnvironment} command lets you create your own environments. It has the
following syntax:

\begin{lscommand}
  \small
  \csi{NewDocumentEnvironment}[name:m, argspec:m, at begin:m, at end:m]
\end{lscommand}
The \carg{argspec} argument is the same as in the
\csi{NewDocumentCommand} command. The contents of \carg{at begin} and \carg{at
  end} arguments will be inserted respectively when the commands
\csi{begin}[name: m] and \csi{end}[name: m] is encountered. The example
presented in \autoref{lst:kingenv} illustrates the usage of this command.
\begin{listing}
  \begin{example}
\NewDocumentEnvironment{king}{}{%
  \emph{Listen! For the
    king made a statement:}%
  \\[1em]%
} {%
  \\[1em]%
  \emph{This concludes
    the king's statement.}%
}

\begin{king}
My humble subjects \ldots
\end{king}
\end{example}
  \caption{An example of using \csi{NewDocumentEnvironment}
    command.}\label{lst:kingenv}
\end{listing}

Note that when environment argument are read, they are read \emph{after} the
\csi{begin}[name: m] command. This may be especially counterintuitive when we
consider the \cargv{s} specification. \autoref{lst:kingsenv} illustrates this.
\begin{listing}
  \begin{example}
\NewDocumentEnvironment{king}{s}{%
  \IfBooleanTF{#1}{
    \begin{center}
      \emph{Thus spoke Charles I:}
      \\[1em]%
    \end{center}%
  } {
    \emph{Listen! For the
      king made a statement:}%
      \\[1em]%
  }%
} {%
  \\[1em]%
  \emph{This concludes
    the king's statement.}%
}

\begin{king}*
My humble subjects \ldots
\end{king}
\end{example}
  \caption{An example of using the \cargv{s} specifier when defining a new
    environment.}\label{lst:kingsenv}
\end{listing}
If you want to create a starred version of an environment (similar to the
\hologo{AmSLaTeX} environments) you have to define it separately.
\begin{minted}{latex}
\NewDocumentEnvironment{king}{moo} { ... } { ... }
\NewDocumentEnvironment{king*}{moo} { ... } { ... }
\end{minted}
Obviously you can use the same internal commands to define them, for example
renaming the previous implementation to \cargv{kinginternal} making the
\cargv{king} and \cargv{king*} a thin wrapper around it.

The \csi{NewDocumentEnvironment} also introduces a special argument
specification: \cargv{+b}, short for body.\footnote{The \cargv{+} indicates
  that it may contain multiple paragraphs.} It is only allowed as the last
argument in the \carg{argspec}. It allows you to receive the body of the
environment as an argument.
\begin{example}
\NewDocumentEnvironment{twice}{+b} {%
  First time:\\ #1

  Second time:\\ #1
} {}

\begin{twice}
This will be printed twice!
\end{twice}
\end{example}
While this makes one of the \carg{at begin}, \carg{at end} arguments redundant,
they are still required. (In the example above we provided an empty \carg{at
  end}.)

Do not overuse \cargv{+b} as this will both add limitations to the environments
like \csi{verb} not being allowed inside and it will slow down the
typesetting.

Similar to the \csi{NewDocumentCommand}, \LaTeX{} makes sure that you do not
define an environment that already exists. If you ever want to change an
existing environment, use the \csi{RenewDocumentEnvironment} command. Its
arguments are the same as the \csi{NewDocumentEnvironment} command.

\subsection{Copying commands}\label{sec:copyingcommands}

When redefining commands you may want to use the original version of the
command. Your initial code may look like this
\begin{minted}{latex}
\RenewDocumentCommand{\emph}{m}{%
  \emph{#1}~(\enquote{#1} is emphasised)%
}
\end{minted}
but when you try to compile the document you will get the error message
\begin{verbatim}
! TeX capacity exceeded, sorry [input stack size=5000].
\end{verbatim}

To understand why this happens it is instructive to consider how \TeX{} expands
the defined commands. The above \csi{RenewDocumentCommand} tells the \TeX{}
engine that whenever \csi{emph}[foo:vm] is seen it must replace it with
\mintinline{latex}|\emph{foo}~(\enquote{foo} is emphasised)|. You may already see the
problem here. In the next stage it will again replace the \csi{emph}[foo:vm]
yielding
\begin{minted}[breaklines]{latex}
\emph{foo}~(\enquote{foo} is emphasised)~(\enquote{foo} is emphasised)
\end{minted}
This process will never end and at some point \TeX{}
simply gives up.

Note that
\begin{minted}{latex}
\NewDocumentCommand{\oldemph}{m}{\emph{#1}}
\RenewDocumentCommand{\emph}{m}{%
  \oldemph{#1}~(\enquote{#1} is emphasised)%
}
\end{minted}
will suffer the same fate since \mintinline{latex}|\oldemph{...}| %chktex 11 
will  be replaced by \TeX{} with \mintinline{latex}|\emph{...}| and %chktex 11
the  cycle repeats.

In order to avoid this problem a special command exists
\begin{lscommand}
  \csi{NewCommandCopy}[name:M, command:M]
\end{lscommand}
It makes the \carg{name} the exact copy of the \carg{command}. The following example shows how this works
\begin{example}[examplewidth=0.35\linewidth]
\NewDocumentCommand{\foo}{}{Batman!}

\NewDocumentCommand{\newfoo}{}{\foo}
\NewCommandCopy{\copiedfoo}{\foo}

\RenewDocumentCommand{\foo}{}{Na Na Na}

\foo{} \newfoo{} \copiedfoo{}
\end{example}

This is precisely the behaviour we need in order to redefine the \csi{emph}
command as we have tried to do earlier.
\begin{example}[examplewidth=0.35\linewidth]
\NewCommandCopy{\oldemph}{\emph}
\RenewDocumentCommand{\emph}{m}{%
  \oldemph{#1}~(\enquote{#1}
  is emphasised)%
}

And here it \emph{comes}.
\end{example}

\subsection{Command-line \LaTeX}

If you work on a Unix-like OS, you might be using Makefiles to build your
\LaTeX{} projects. In that connection it might be interesting to produce
different versions of the same document by calling \LaTeX{} with command-line
parameters. If you add the following structure to your document:

\begin{minted}{latex}
\IfBooleanTF{\blackandwhite} {
  % "black and white" mode; do something...
} {
  % "color" mode; do something different...
}
\end{minted}

Now compile document like this:
\begin{verbatim}
xelatex '\NewCommandCopy{\blackandwhite}{\BooleanTrue}
    \input{test.tex}'
\end{verbatim}
First the command \verb|\blackandwhite| is defined as the \csi{BooleanTrue} macro which
holds a special value used in \csi{IfBooleanTF} checks. Then the actual file is
read with input. By setting \verb|\blackandwhite| to \csi{BooleanFalse} the
colour version of the document would be produced.

\subsection{Your Own Package}

If you define a lot of new environments and commands, the preamble of
your document will get quite long. In this situation, it is a good
idea to create a \LaTeX{} package containing all your command and
environment definitions. Use the \csi{usepackage}
command to make the package available in your document.

\begin{listing}
  \begin{lined}{\textwidth}
    \begin{minted}{latex}
\ProvidesExplPackage{demopack}{2022-05-05}{0.1}{%
  Package by Tobias Oetiker
}

\NewDocumentCommand{\tnss}{} {
  The~not~so~Short~Introduction~to~\LaTeX
}
\NewDocumentCommand{\txsit}{O{not~so}} {
  The~\emph{#1}~Short~Introduction~to~\LaTeX
}

\NewDocumentEnvironment{king}{} {
  \begin{quote}
} {
  \end{quote}
}
\end{minted}
  \end{lined}
  \caption{Example Package.}\label{package}
\end{listing}

Writing a package basically consists of copying the contents of your document
preamble (with minor adjustments) into a separate file with a name ending in
\texttt{.sty}. There is one special command,
\begin{lscommand}
  \csi{ProvidesExplPackage}[name:m, date:m, version:m, description:m]
\end{lscommand}
for use at the very beginning of your package file. This command tells the
\LaTeX{} to process the  file in \emph{expl mode}. The most visible effect of
this is that all whitespace is ignored. You may have noticed that in many of
the examples above we had to end most lines with \ai{\%} to get correct spacing
in the output. In \emph{expl mode}, spaces have to be added explicitly if
needed at all. They are usually quite rare when writing a package. To insert
spaces, use the \ai{\~} character, which normally denotes non-breaking
space.\footnote{If you want to insert non-breaking space in \emph{expl mode},
  use \csi{nobreakspace}.} Paragraphs can be started with the \csi{par} command.

The arguments are used to provide information about package in the log file. If
you use this package and look at the log file you will find
\begin{verbatim}
Package: demopack 2022-05-05 v0.1 Package by Tobias Oetiker
\end{verbatim}
in the \eei{.log} file.

\csi{ProvidesExplPackage} will also issue a sensible error message when you try
to include a package twice. \autoref{package} shows a small example package
that contains the commands defined in the examples above.

\section{Fonts and Sizes}\label{sec:fontsize}

\subsection{Font Changing Commands}\index{font}\index{font size}

\LaTeX{} fonts are influenced by four parameters
\begin{description}
  \item[family] The collection of fonts. For example, \enquote*{Latin Modern
      Roman} or \enquote*{Source Code Pro}.
  \item[series] The weight of the font. For example, \enquote*{bold} or
    \enquote*{medium}.
  \item[shape] The shape of glyphs within a font family. For example,
    \enquote*{small caps} or \enquote*{italics}.
  \item[size] The size of the glyphs. For example, \enquote*{\qty{10}{pt}} or
    \enquote*{\qty{12}{pt}}.
\end{description}
\LaTeX{} automatically chooses the appropriate font family, series, shape and
size based on the logical structure of the document (sections, footnotes,
emphasis, \ldots). It is possible however to instruct \LaTeX{} manually which
font to use. It is important to note that not every combination of
family\slash{}series\slash{}shape exists as an actual font. \LaTeX{} will
complain if you try for something that does not exist.

\LaTeX{} predefines three font families to use throughout the document: the
upright or roman family accessible via \csi{textrm}, the \textsf{sans serif
  family} accessible via \csi{textsf} and monospace or typewriter family
accessible via \csi{texttt}.
\begin{example}
\textrm{Roman is the default
  in articles.} \\
\textsf{Sans serif is used in
  presentations.} \\
\texttt{Monospace is used in
  verbatim code blocks.}
\end{example}

There are only two predefined \LaTeX{} series: medium (\csi{textmd}) and bold
(\csi{textbf}).
\begin{example}
\textmd{The default.} \\
\textbf{Bold font.}
\end{example}

Shapes are a bit more complicated. The three basic shapes are: italics
(\csi{textit}), oblique or slanted\footnote{Oblique shape differs from the
  italics in that italic shape uses different glyphs while oblique shape uses
  the same glyphs but slanted. The difference is really obvious
  \fontspec{cmunui.otf} when you look at the unslanted italic
  font.} (\csi{textsl}) and small capitals (\csi{textsc}).
\begin{example}
\textit{Italic shape.} \\
\textsl{Slanted shape.} \\
\textsc{Small Capitals.}
\end{example}
However there are two additional shapes that are not provided by default
\LaTeX{} fonts: swash (\csi{textsw}), for decorative fonts and spaced caps and
small caps (\csi{textssc}). These are rarely used but may come in handy when
using custom fonts as described in \autoref{sec:fontspec}.
\begin{example}
\setmainfont{EB Garamond} %!hide
Question vs. \textsw{Question}
\end{example}
In addition two virtual shapes are provided: upright (\csi{textup}) and
upper-lowercase (\csi{textulc}). These are not actually shapes but utility
commands. The former one switches back to upright font while the latter
disables small capitals. The command \csi{textnormal} is just the combination
of the two.
\begin{example}
\textsl{\textsc{Back to
  \textup{upright.}}} \\
\textsl{\textsc{Back to
  \textulc{lowercase.}}} \\
\textsl{\textsc{Back to
  \textnormal{normal.}}}
\end{example}

All of the commands described above also exist in their switch version. Instead
of receiving the text via argument, they change the font permanently until it is
changed again. For example, the switch version of \csi{textit} and \csi{textrm}
are \csi{itshape} and \csi{rmfamily}, respectively. While the argument versions
are useful for defining commands, switch versions are especially useful when
defining your own environments.
\begin{example}
Only \textit{argument} is
affected. After \itshape
everything is in italics
until \upshape is encountered.
\end{example}
Both argument and switch versions of the described commands are presented in
\autoref{tbl:fonts}.
\begin{table}
  \caption{Default font changing commands of \LaTeX.}\label{tbl:fonts}
  \begin{tabular}{@{}lll@{}}
    \toprule
    Argument Command         & Switch           & Example                      \\
    \midrule
    \csi{textrm}[text:m]     & \csi{rmfamily}   & \textrm{\wi{roman}}          \\
    \csi{textsf}[text:m]     & \csi{sffamily}   & \textsf{\wi{sans serif}}     \\
    \csi{texttt}[text:m]     & \csi{ttfamily}   & \texttt{typewriter}          \\[6pt]
    \csi{textmd}[text:m]     & \csi{mdseries}   & \textmd{medium}              \\
    \csi{textbf}[text:m]     & \csi{bfseries}   & \textbf{\wi{bold face}}      \\[6pt]
    \csi{textup}[text:m]     & \csi{upshape}    & \textup{\wi{upright}}        \\
    \csi{textit}[text:m]     & \csi{itshape}    & \textit{\wi{italic}}         \\
    \csi{textsl}[text:m]     & \csi{slshape}    & \textsl{\wi{slanted}}        \\
    \csi{textsc}[text:m]     & \csi{scshape}    & \textsc{\wi{Small Caps}}     \\
    \csi{textsw}[text:m]     & \csi{swshape}    & \textsw{\wi{Queen of Swash}} \\[6pt]
    \csi{textnormal}[text:m] & \csi{normalfont} & \textnormal{document} font   \\
    \bottomrule
  \end{tabular}
\end{table}

When working with switch versions of fonts that are slanted right it is
important to remember about \wi{italic correction}. This is a small space after
the end of right slanting text that is sometimes necessary to avoid overlapping
letters. It is inserted using \csi{/} command.
\begin{chktexignore}  
\begin{example}
Without: {\itshape oof}bar \\
With: {\itshape oof\/}bar
\end{example}
\end{chktexignore}
The italic correction is handled automatically by the argument versions of the
commands.

In contrast to the previous font changing commands, the size of font can only
be controlled via switch versions. \LaTeX{} predefines some switches for
changing font size, see \autoref{sizes} and \autoref{tab:pointsizes} for their
description.
\begin{table}
  \caption{Commands changing font size.}\label{sizes}\index{font size}
  \begin{tabular}{@{}ll@{\qquad}ll@{}}
    \toprule
    Command                     & Size                             &
    Command                     & Size                               \\
    \midrule
    \csi{tiny}                  & \tiny tiny                       &
    \csi{Large}                 & \Large larger                      \\
    \csi{scriptsize}            & \scriptsize very small           &
    \csi{LARGE}                 & \LARGE very large                  \\
    \csi{footnotesize}          & \footnotesize  quite small       &
    \multirow{2}{*}{\csi{huge}} & \multirow{2}{*}{\huge huge}        \\
    \csi{small}                 & \small small                     &
                                &                                    \\
    \csi{normalsize}            & \normalsize  normal              &
    \multirow{2}{*}{\csi{Huge}} & \multirow{2.2}{*}{\Huge largest}   \\
    \csi{large}                 & \large large                     &
                                &                                    \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{table}
  \caption[Absolute point sizes in standard classes.]{Absolute point sizes in
    standard classes depending on the class option. The default class option is
    \cargv{10pt}.}\label{tab:pointsizes}\label{tab:sizes}
  \sisetup{table-format=2.2}
  \begin{tabular}{@{}lSSS@{}}
    \toprule
                       & \multicolumn{3}{c}{Size (\unit{pt})}                                   \\
    \cmidrule(l){2-4}
    Command            & {\cargv{10pt}}                       & {\cargv{11pt}} & {\cargv{12pt}} \\
    \midrule
    \csi{tiny}         & 5                                    & 6              & 6              \\
    \csi{scriptsize}   & 7                                    & 8              & 8              \\
    \csi{footnotesize} & 8                                    & 9              & 10             \\
    \csi{small}        & 9                                    & 10             & 10.95          \\
    \csi{normalsize}   & 10                                   & 10.95          & 12             \\
    \csi{large}        & 12                                   & 12             & 14.4           \\
    \csi{Large}        & 14.4                                 & 14.4           & 17.28          \\
    \csi{LARGE}        & 17.28                                & 17.28          & 20.74          \\
    \csi{huge}         & 20.74                                & 20.74          & 24.88          \\
    \csi{Huge}         & 24.88                                & 24.88          & 24.88          \\
    \bottomrule
  \end{tabular}
\end{table}

When using these commands it is important to remember that the
line spacing is only updated after the paragraph ends. To avoid putting empty
lines before the closing curly brace you may use the \csi{par} command.
\begin{example}
{\Large Here the line spacing
  is not updated. A bit tight!}

{\Large Much better! I can
  breathe freely again!\par}
\end{example}

An arbitrary font size can be specified using the
\begin{lscommand}
  \csi{fontsize}[size: m, line skip: m]\csi{selectfont}
\end{lscommand}
command combo. The \carg{line skip} determines the height of the text line and
should be usually around \(1.2\) times larger than the \carg{size}.
\begin{example}[vertical_mode, examplewidth=0.7\linewidth]
\fontsize{2cm}{2.4cm}\selectfont A big one!
\end{example}

Fun fact: \LaTeX{} default font is a bit unusual in that it looks slightly
different depending on its size. The difference is presented in the table below
where the text written using different sizes was rescaled to the same height.
\begin{center}
  \begin{tabular}{@{}lll@{}}
    \toprule
    \csi{tiny}                           &
    \csi{normalsize}                     &
    \csi{Huge}                             \\
    \midrule
    \resizebox{!}{2em}{\tiny Text}       &
    \resizebox{!}{2em}{\normalsize Text} &
    \resizebox{!}{2em}{\Huge Text}         \\
    \bottomrule
  \end{tabular}
\end{center}

If you need to access even more font variants and shapes\footnote{For example
  the aforementioned \fontspec{cmunui.otf} upright italic shape.} check out
\citetitle{fntguide}~\cite{fntguide}.

\subsection{Danger, Will Robinson, Danger}

Note! Using explicit font setting commands defies the basic idea of
\LaTeX{} described in \autoref{sec:logical_structure}, which is to separate the
logical and visual markup. The fonts should get switched automatically
according to the requirements of the context. A simple rule of thumb: If you
use the same font changing command in several places in order to typeset a
special kind of information, you should use \csi{NewDocumentCommand} to define
a \enquote{logical wrapper command} for the font changing command.

\begin{example}
\NewDocumentCommand{\oops}{m}{%
 \textbf{#1}}
Do not \oops{enter} this room,
it's occupied by \oops{machines}
of unknown origin and purpose.
\end{example}

This approach has the advantage that you can decide at some later
stage that you want to use a visual representation of danger other
than \csi{textbf}, without having to wade through your document,
identifying all the occurrences of \csi{textbf} and then figuring out
for each one whether it was used for pointing out danger or for some other
reason.

\subsection{Advice}

To conclude this journey into the land of fonts and font sizes,
here is a little word of advice:\nopagebreak

\begin{quote}
  \underline{\textbf{Reme\(\mathfrak{mber}\)\Huge!}} \textit{The}
  \textsf{M\textbf{\LARGE O} \(\mathcal{R}\)\textsl{E}} fonts \Huge you
  \tiny use \footnotesize \textbf{in} a \small \texttt{document},
  \large \textit{the} \normalsize more \textsc{readable} and
  \textsl{\textsf{beautiful} it bec\large o\Large m\LARGE e\huge s}.
\end{quote}

\section{Custom Fonts with \pai{fontspec}}\label{sec:fontspec}

In the following examples we use Adobe Source fonts~\cites{sourceserif,
  sourcesans, sourcecodepro}. These fonts are included with \TeXLive{} \LaTeX{}
distributions and should be available in the directory
\begin{code}
  \nolinkurl{.../texmf-dist/fonts/opentype/adobe}
\end{code}
where the \cargv{...} denotes the install-path of \TeXLive{}.
\hologo{LuaTeX} checks this directory automatically, so it should work fine,
but if you are using \hologo{XeTeX} you must first install these fonts in your
system. You can also download and install them manually from the links provided
in the bibliography. Alternatively swap out their respective names with some other
fonts installed in your system.

Many free OpenType fonts are available at \url{https://fontlibrary.org/}.

\subsection{Main Document Fonts}

If you are not pleased with the default Latin Modern font, you can change it to
any font installed in your system using the \pai*{fontspec} package. It provides
three main commands for changing document fonts:
\begin{lscommand}
  \csi{setmainfont}[options: o, font: m] \\
  \csi{setsansfont}[options: o, font: m] \\
  \csi{setmonofont}[options: o, font: m]
\end{lscommand}
This commands change, respectively, the main font of the document, \textsf{the
  sans serif font used in the document} and \texttt{the monospace font in the
  document}.
\begin{example}
Normal text.
  \emph{Emphasised.} \\
\textsf{Sans serif text.
  \emph{Emphasised}.} \\
\texttt{Monospace text.
  \emph{Emphasised}.} \\

\setmainfont{Source Serif Pro}
\setsansfont{Source Sans Pro}
\setmonofont{Source Code Pro}
Normal text.
  \emph{Emphasised.} \\
\textsf{Sans serif text.
  \emph{Emphasised}.} \\
\texttt{Monospace text.
  \emph{Emphasised}.}
\end{example}
Note that it is best to put these commands in the preamble of your document,
because some fonts are frozen when the body starts.

The optional \carg{options} argument accepts key value lists that allow to
customise the font features. For example, many fonts contain,
old style numerals that are not used by default. You can pass
\cargv{Number=OldStyle} if you want to use them in your document.
\begin{example}
\setmainfont{Source Serif Pro}
0123456789

\setmainfont[
  Numbers=OldStyle,
]{Source Serif Pro}
0123456789
\end{example}

Some fonts also provide special glyphs for a given language. For example the
Latin Modern Font provides a special
\enquote{\setmainfont[Language=Polish]{Latin Modern Roman}fk} ligature for the
Polish language. You can set the \cargv{Language} key to a given language to
enable these features.
\begin{example}
agrafka

\setmainfont[
  Language=Polish,
]{Latin Modern Roman}
agrafka
\end{example}
The \pai{polyglossia} package activates these features automatically so you
don't have to worry about them if you use it.

If your font supports it you may wish to enable automatic fractions insertion
with \cargv{Fractions=On} key.
\begin{example}
1/2 3/4 123/456

\setmainfont[
  Fractions=On,
]{Latin Modern Roman}
1/2 3/4 123/456

\setmainfont[
  Fractions=On,
]{Source Serif Pro}
1/2 3/4 123/456
\end{example}

The OpenType font format defines a lot of more font features, that may or may not
be supported by your font of choice. Consult with the \pai*{fontspec} package
documentation for a comprehensive description and examples.

\subsection{Specifying Fonts via Filenames}\label{ssec:fonts_filename}

If you do not want to install fonts in your system or you are working on a
collaborative project where not everybody has the necessary fonts installed on their system,
you can add font files to your project and specify the fonts directly via their filenames.
In this case you must specify
font variations manually. Because the filenames are usually very similar, it is
possible to enter them using \cargv{*} patterns, where \cargv{*} is replaced by
the main name defined. Extension may also be passed via the \cargv{Extension}
key to avoid repetition. See \autoref{lst:fontloading} for a comparison of font
loading techniques. If the font files are not present in the same directory as
the document you may have to specify it directly using the \cargv{Path} key.
\begin{listing}
  \begin{example}[vertical_mode, examplewidth=0.8\linewidth]
\setmainfont{Source Serif Pro}
Normal text. \textit{Italics.} \textbf{Bold.}
\textit{\textbf{Bold italics.}} \\

\setmainfont{SourceSerifPro-Regular.otf}
Normal text. \textit{Italics.} \textbf{Bold.}
\textit{\textbf{Bold italics.}} \\
 
\setmainfont[
  ItalicFont=SourceSerifPro-RegularIt.otf,
  BoldFont=SourceSerifPro-Bold.otf,
  BoldItalicFont=SourceSerifPro-BoldIt.otf,
]{SourceSerifPro-Regular.otf}
Normal text. \textit{Italics.} \textbf{Bold.}
\textit{\textbf{Bold italics.}} \\

\setmainfont[
  Extension=.otf,
  UprightFont=*-Regular,
  ItalicFont=*-RegularIt,
  BoldFont=*-Bold,
  BoldItalicFont=*-BoldIt,
]{SourceSerifPro}
Normal text. \textit{Italics.} \textbf{Bold.}
\textit{\textbf{Bold italics.}}
\end{example}
  \caption{Comparison of font loading with the \pai{fontspec}
    package.}\label{lst:fontloading}
\end{listing}

The default \LaTeX{} fonts are rather atypical in that they distinguish between
\textit{italics} and \textsl{slanted} font. Most fonts do not do this, so
\pai{fontspec} defines slanted font to be the same as italics. This may be
fixed by setting the \cargv{SlantedFont} key explicitly.
\begin{example}[vertical_mode, examplewidth=0.7\linewidth]
\setmainfont{Latin Modern Roman}
\textit{italics} vs. \textsl{slanted}

\setmainfont[
  SlantedFont=Latin Modern Roman Slanted,
]{Latin Modern Roman}
\textit{italics} vs. \textsl{slanted}
\end{example}

\subsection{Defining New Fonts}

So far we have only talked about changing the fonts for the whole document. It
is possible however to define new fonts that are used only sporadically
throughout the document, for emphasis or decorative purposes. It is possible to
do so using the
\begin{lscommand}
  \csi{newfontfamily}[command: M, options: o, font: m]
\end{lscommand}
It defines new \carg{command} that works like to the \csi{rmfamily} or
\csi{sffamily} commands.
\begin{example}
\newfontfamily{\sourcefamily}[
  Numbers=OldStyle,
]{Source Serif Pro}

Normal text when suddenly
\ldots{} \sourcefamily
a different font! 0123456789
\end{example}
This is especially useful when working with multiple languages as you have
already seen in \autoref{sec:polyglossia}.

The \csi{newfontfamily} checks whether the font family is already defined and
raises an error if it is. As in \autoref{sec:new_commands} the
\csi{renewfontfamily} and \csi{providefontfamily} are available if you want to
redefine existing font families.

\subsection{Math Fonts}\label{sec:math_fonts}

The package \pai{unicode-math}, introduced in \autoref{chap:math}, uses
\pai{fontspec} under the hood and already enables you to use any OpenType math
font within your document. The main command to do so is called
\csi{setmathfont}. It accepts either a font name or a filename. In contrast to
the text fonts that often consist of multiple files, math fonts typically
consist of a single file, thus specifying it via a filename is not as
complicated as presented in \autoref{ssec:fonts_filename}.
\begin{code}
  \begin{minted}{latex}
\setmathfont{STIX Two Math}
  \end{minted}
\end{code}
is equivalent to
\begin{code}
  \begin{minted}{latex}
\setmathfont{STIXTwoMath-Regular.otf}
  \end{minted}
\end{code}
and the latter works in both \hologo{LuaLaTeX} and \hologo{XeLaTeX}. While
changing math fonts throughout the document is possible, it may lead to some
problems; prefer to set them in the preamble for the whole document.
\begin{example}[standalone, paperheight=2.5cm, paperwidth=6cm]
\usepackage{unicode-math}%!hide
\setmainfont{EB Garamond}
\setmathfont{Garamond Math}
% ...

\begin{document} %!hide
\noindent %!hide
Now we are using Garamond fonts.
\[
  \symrm{e}^{\symrm{\pi}
    \symrm{i}} + 1 = 0 \quad
  \sum_{i=0}^\infty \iint_a^b
  \lim_{h\to0}\frac{\sqrt[3]{
    \symbb{A}}}{2^h}\,\symrm{d}x
\]
\end{document}%!hide
\end{example}

Not all math fonts have the same character coverage. For example, the default
font doesn't have lowercase script letters. If you don't want to switch the
fonts entirely but just use some characters from a different font, you
can use the \cargv{range} key in the options to the \csi{setmathfont} command.
\begin{example}[standalone, paperheight=1cm, paperwidth=6cm]
\usepackage{unicode-math}%!hide
\begin{document} %!hide
\noindent %!hide
\(xyz = \symscr{Hello}\) vs.\
\setmathfont[
  range=scr,
]{STIX Two Math}
\(xyz = \symscr{Hello}\)
\end{document}%!hide
\end{example}
You can also set it to exact Unicode ranges if you need more control over
replaced symbols.

Some fonts define two types of script font \emph{roundhand} and \emph{chancery}. These are
normally available as the first stylistic set feature of the font. You can map
\csi{symcal} which is normally a synonym for \csi{symscr}, to produce the
alternative script letters.
\begin{example}[standalone, paperheight=1cm, paperwidth=6cm]
\usepackage{unicode-math}%!hide
\begin{document} %!hide
% TODO: Waiting for unicode-math fix
\setmathfont{STIX Two Math}
\setmathfont[
  range={cal, bfcal},
  StylisticSet=1,
]{STIX Two Math}

\noindent %!hide
\(\symscr{ABCDabcd}\) vs.\
\(\symcal{ABCDabcd}\) 
\end{document}%!hide
\end{example}

The default behaviour of the \csi{not} command, is to combine the negating glyph
with the following symbol. This usually produces satisfactory results. If the
font defines a dedicated negated symbol it is probably better to use it in such
situations. The \csi{not} command is able to use a predefined mapping to use
such glyphs based on the negated symbol. If the default mapping does not
contain the combination, or if you prefer to use a different negation you can
create a new mapping by using \csi{NewNegationCommand}.
\begin{example}
\(\not\cong\) vs.\
\NewNegationCommand{%
    \cong}{\simneqq}%
\(\not\cong\)
\end{example}

\section{Colours}\label{sec:colors}\index{colours}

\subsection{Coloured Text}
In the \autoref{sec:logical_structure} we have used different text colours to
illustrate an example. These can be obtained with the \pai*{xcolor} package. It
provides three commands to change the colour of text:
\begin{lscommand}
  \csi{color}[model: o, color: m] \\
  \csi{textcolor}[model: o, color: m, text: m]
  \csi{mathcolor}[model: o, color: m, text: m]
\end{lscommand}
The \csi{color} is a switch version while \csi{textcolor} and \csi{mathcolor}
only apply to their argument. If no \carg{model} is specified, then
\carg{color} is specified as colour expression. The simplest colour expression
is just the name of the colour, for example \cargv{yellow} or \cargv{red}.
\begin{example}
\textcolor{yellow}{foo} \\
\color{red} baz
\[
  \mathcolor{blue}{
    \sum_{k=0}
  }^{10} i
\]
\end{example}
The list of predefined colours can be found in \autoref{tbl:basecolors}. You can
also pass \cargv{dvipsnames}, \cargv{svgnames} or \cargv{x11names} as a package
options to extend the predefined colours. Consult the package documentation for
a full list.
\begin{table}
  \ExplSyntaxOn
  \NewDocumentCommand{\DemoColor}{m}{
    \raisebox{0.15cm}{\cargv{#1}} &
    \fcolorbox{black}{#1}{\phantom{\rule{0.5cm}{0.5cm}}}
  }
  \ExplSyntaxOff
  \caption{Basic colours predefined by the \pai{xcolor}
    package.}\label{tbl:basecolors}
  \begin{tabular}{@{}lc*2{@{\qquad}lc}@{}}
    \toprule
    Name                 & Demo                  &
    Name                 & Demo                  &
    Name                 & Demo                                       \\
    \midrule
    \DemoColor{black}    & \DemoColor{lightgray} & \DemoColor{purple} \\
    \DemoColor{blue}     & \DemoColor{lime}      & \DemoColor{red}    \\
    \DemoColor{brown}    & \DemoColor{magenta}   & \DemoColor{teal}   \\
    \DemoColor{cyan}     & \DemoColor{olive}     & \DemoColor{violet} \\
    \DemoColor{darkgray} & \DemoColor{orange}    & \DemoColor{white}  \\
    \DemoColor{gray}     & \DemoColor{pink}      & \DemoColor{yellow} \\
    \DemoColor{green}    &                       &                    \\
    \bottomrule
  \end{tabular}
\end{table}

Another type of colour expression is a mix of two colours. The syntax is
\begin{code}
  \cargv{\carg{first color}!\carg{percentage}!\carg{second color}}.
\end{code}
The resulting colour will be the result of mixing
\qty[parse-numbers=false]{\carg{percentage}}{\percent} of the \carg{first
  color} and \qty[parse-numbers=false]{100-\carg{percentage}}{\percent} of the
\carg{second color}. If you omit the \carg{second color} it defaults to white.
\begin{example}
\textcolor{green!100!red}{C}%
\textcolor{green!80!red}{o}%
\textcolor{green!60!red}{l}%
\textcolor{green!40!red}{o}%
\textcolor{green!20!red}{r}%
\textcolor{green!0!red}{s} \\
\textcolor{blue!100}{B}%
\textcolor{blue!75}{l}%
\textcolor{blue!50}{u}%
\textcolor{blue!25}{e}
\end{example}
Colour mixing is left associative so
\begin{code}
  \cargv{\carg{A}!\carg{n}!\carg{B}!\carg{m}!\carg{C}}
\end{code}
means calculate the mixture of \carg{A} and \carg{B} and then mixture of the
result and \carg{C}. You can also use the minus sign before the expression to
get the complementary colour.
\begin{example}
\color{green!20!red!60!blue}
\LaTeX{} \\
\color{-green!20!red!60!blue}
\LaTeX{}
\end{example}

\subsection{Models}

While colour mixing via expression is useful for simple colour specification, it
is often the case that we want to use colour that is defined in terms of its RGB
or HSB values. Different input method colours can be specified using the optional
\carg{model} argument. Note that it is case-sensitive.

The simplest model is \cargv{Gray}. It accepts a single number from \(0\)to
\(15\) and produces a grey colour with the given brightness.
\begin{example}
\textcolor[Gray]{0}{Zero}    \\
\textcolor[Gray]{3}{Three}   \\
\textcolor[Gray]{7}{Seven}   \\
\textcolor[Gray]{11}{Eleven} \\
\textcolor[Gray]{15}{Fifteen}
\end{example}

You can input RGB values in three ways: \cargv{rgb}, \cargv{RGB} and
\cargv{HTML} models. The \cargv{HTML} model accepts a hexadecimal colour code.
The code may be either upper or lowercase.
\begin{example}
\textcolor[HTML]{e63946}{e63946}
\textcolor[HTML]{06D6A0}{06D6A0}
\end{example}
The \cargv{rgb} model accepts three decimal numbers, each between \(0\) and
\(1\), while the \cargv{RGB} model accepts three integers from \(0\) to \(255\).
\begin{example}
\textcolor[RGB]{255, 204, 102}{
  255, 204, 102
} \\
\textcolor[rgb]{0.4, 0.4, 1.0}{
  0.4, 0.4, 1.0
}
\end{example}

If you prefer the subtractive colour model, both \cargv{cmy} and \cargv{cmyk} are
available. They accept decimal numbers between \(0\) and \(1\) to specify
the amount of each colour.
\begin{example}
\textcolor[cmy]{0.7, 0.4, 0.3}{
  0.7, 0.4, 0.3
} \\
\textcolor[cmyk]{
  0.7, 0.4, 0.3, 0.5
}{
  0.7, 0.4, 0.3, 0.5
}
\end{example}

There are three models that enable defining colours by HSB\@: \cargv{hsb},
\cargv{Hsb} and \cargv{HSB}. The first two accept three decimal numbers for
each value, the difference being that the \cargv{Hsb} accepts hue as an angle
in degrees, that is a number between \(0\) and \(360\). The \cargv{hsb} accepts
it as a number between \(0\) and \(1\), while saturation and brightness
are passed the same way in both model---as a number between \(0\) and \(1\).
\begin{example}
\textcolor[hsb]{
  0.4, 0.8, 0.75
}{
  0.4, 0.8, 0.75
}\\
\textcolor[Hsb]{
  144, 0.8, 0.75
}{
  144, 0.8, 0.75
}
\end{example}
The \cargv{HSB} in turn accepts all three as integers---each between \(0\) and
\(240\).
\begin{example}
\textcolor[HSB]{
  144, 200, 120
}{
  144, 200, 120
}
\end{example}

If you are writing a paper about light you may also find that the \cargv{wave}
model comes in handy. It allows you to specify a colour by its wavelength. It
accepts a single decimal number that represents a wavelength in visible
spectrum in nanometres.
\begin{example}
\textcolor[wave]{452}{
  If a light has wavelength
  \qty{452}{\nm} it looks
  like this.  
} \\
\textcolor[wave]{700}{
  Light with wavelength above
  \qty{814}{\nm} is called
  infrared.
}
\end{example}

\subsection{Defining Your Own Colours}

If you want to use a given colour more than once it makes sense to define
it as a macro. While you could use the \csi{NewDocumentCommand} to define it,
the \pai{xcolor} package provides a better way via the
\begin{lscommand}
  \csi{definecolor}[name: m, model: m, value: m].
\end{lscommand}
command. Using it makes it possible to use the newly defined colour in colour
mixing and such.
\begin{example}
\definecolor{MyRed}{wave}{712}
\textcolor{MyRed}{MyRed is
  the perfect colour for you!}
\textcolor{MyRed!60}{Tints
  are also available!}
\end{example}
Be careful though, since it doesn't guard against redefinition. If you want to
check whether you haven't redefined some colour put \csi{tracingcolors} in your
preamble. This will produce warnings when redefinition happens.

If you want to make sure a colour is present but don't want to redefine it if it
already exists then \csi{providecolor} does exactly that. There is also
\csi{colorlet} that simply creates a copy of a given colour similar to the
\csi{NewCommandCopy} command.

Colours defined in different models may need to be converted when mixing them.
This may lead to a situation where \mintinline{latex}|\color{a!75!b}| will
result in different colour than \mintinline{latex}|\color{b!25!a}|. Keep that in
mind when mixing your own colours.

\subsection{Colourful Pages and Boxes}

So far we have only considered changing the text colour. It is however possible
to also change the background colour of the document page. To do this use the
\begin{lscommand}
  \csi{pagecolor}[model: o, color: m]
\end{lscommand}
command, which accepts the same arguments as the \csi{color} command. If you
want to revert to the default transparent background you may do so with the
\csi{nopagecolor} command.
\begin{example}[standalone, paperheight=1cm]
\usepackage{xcolor} %!hide
\begin{document} %!hide
\pagecolor{orange} \color{-orange}
Small is colourful \ldots?
\end{document} %!hide
\end{example}

If you only want to specify a background of some text instead of the whole page
you can use the
\begin{lscommand}
  \csi{colorbox}[model: o, color: m, text: m] \\
  \csi{fcolorbox}[model: o, color: m, model: o, color: m, text: m]
\end{lscommand}
commands. The first one only colours the background, while the second one
allows also drawing a frame (the \enquote*{f} stands for \enquote{framed}).
\begin{example}
It is \colorbox{gray}{curious}
how much a document can be
enhanced or ruined by
\fcolorbox{blue}{red}{
  colours.
}
\end{example}
Boxes are explored further in \autoref{sec:boxes}.

\section{Lengths and Spacing}

\subsection{\LaTeX{} Units}\index{units (\TeX)}\index{dimensions}%
\label{sec:dimensions}
\begingroup
\DeclareSIUnit{\in}{in}
\DeclareSIUnit{\pt}{pt}
\DeclareSIUnit{\bp}{bp}
\DeclareSIUnit{\sp}{sp}
\DeclareSIUnit{\dd}{dd}
\ExplSyntaxOn
\NewDocumentCommand{\DimVal}{m}{
  \num{\dim_to_decimal_in_sp:n {#1}}
}
\NewDocumentCommand{\fnum}{mm}{
  \num[
    number-mode=text,
    parse-numbers=false,
  ]{
    \sfrac{
      \num[number-mode=math,parse-numbers=true]{#1}
    }{
      \num[number-mode=math,parse-numbers=true]{#2}
    }
  }
}

\NewDocumentCommand{\fqty}{mmm}{
  \qty[
    number-mode=text,
    parse-numbers=false,
  ]{
    \sfrac{
      \num[number-mode=math,parse-numbers=true]{#1}
    }{
      \num[number-mode=math,parse-numbers=true]{#2}
    }
  }{#3}
}
\ExplSyntaxOff

Throughout this booklet we have often presented commands that accept length as
one of its parameters such as \csi{\bs} or \csi{fontsize}. When introducing
them we have used \unit{\cm} and \unit{\pt} which stand for centimetre and
point, but these are not the only units available in \LaTeX{}.

The most fundamental unit in \LaTeX{} is \unit{\sp} which stands for
\emph{scaled point}. Its width is equal to \fqty{1}{65536}{\pt}, where
\qty{1}{\pt} is equal to \fnum{1}{72.27} of an international inch which in turn
is defined as exactly \qty{25.4}{\mm}. All units in \TeX{} are ultimately
represented as a whole numbers of \unit{sp}. See \autoref{units} for the exact
values.
\begin{table}
  \caption{\LaTeX{} Units.}\label{units}\index{units}
  \begin{tabular}{@{}clrrl@{}}
    \toprule
    Unit     & Meaning                                                                                                 & Definition            & {Value (\unit{\sp})} & Demo            \\
    \midrule
    \ltx|cm| & centimetre                                                                                              & \qty{0.01}{\m}        & \DimVal{1cm}         & \demowidth{1cm} \\
    \ltx|mm| & millimetre                                                                                              & \qty{0.001}{\m}       & \DimVal{1mm}         & \demowidth{1mm} \\
    \ltx|in| & inch                                                                                                    & \qty{25.4}{\mm}       & \DimVal{1in}         & \demowidth{1in} \\
    \ltx|pt| & point                                                                                                   & \fqty{1}{72.27}{\in}  & \DimVal{1pt}         & \demowidth{1pt} \\
    \ltx|sp| & scaled point                                                                                            & \fqty{1}{65536}{\pt}  & \DimVal{1sp}         & \demowidth{1sp} \\
    \ltx|pc| & pica                                                                                                    & \qty{12}{\pt}         & \DimVal{1pc}         & \demowidth{1pc} \\
    \ltx|dd| & didot                                                                                                   & \qty{0.376065}{\mm}   & \DimVal{1dd}         & \demowidth{1dd} \\
    \ltx|cc| & cicero                                                                                                  & \qty{12}{\dd}         & \DimVal{1cc}         & \demowidth{1cc} \\
    \ltx|nd| & new didot                                                                                               & \qty{0.375}{\mm}      & \DimVal{1nd}         & \demowidth{1nd} \\
    \ltx|bp| & big point                                                                                               & \fqty{1}{72}{\in}     & \DimVal{1bp}         & \demowidth{1bp} \\[6pt]
    \ltx|em| & \multicolumn{3}{m{7cm}}{roughly width of an \enquote*{M} in the current font}                           & \demowidth{1em}                                                \\
    \ltx|ex| & \multicolumn{3}{m{7cm}}{roughly height of an \enquote*{x} in the current font}                          & \demowidth{1ex}                                                \\
    \ltx|mu| & \multicolumn{3}{m{7cm}}{equal to \fqty{1}{18}{em}, where \unit{em} is taken from the current math font} & \demowidth{0.05556em}                                          \\
    \bottomrule
  \end{tabular}
\end{table}

The last three units mentioned in the table are relative to the current font
used. Historically they were related to the \enquote*{M} and \enquote*{x}
glyphs in a given font but today they are arbitrarily set by fonts. These units
are useful if we want the length to scale proportionally when used with
different font sizes. The \mintinline{latex}|em| unit is usually used for
horizontal lengths, while the \mintinline{latex}|ex| is used for vertical
lengths. The \mintinline{latex}|mu| unit can only be used in math mode for math
spacing (see \autoref{sec:math-spacing}).
\begin{example}
\begin{minipage}[b]{0.5\linewidth} %!hide
foo\\[1ex] bar
\end{minipage}\begin{minipage}[b]{0.5\linewidth}%!hide

\tiny foo\\[1ex] bar
\end{minipage}%!hide
\end{example}

The desktop publishing point (DTP point) is the \emph{de facto} standard point
as used in most programs, and it is defined as \fqty{1}{72}{\in}. For
historical reasons the default \TeX{} points are a bit smaller, while the DTP
points are called \enquote{big points}. While this shouldn't be noticeable in
normal circumstances, remember to use \mintinline{latex}|bp| if exact point
values are required of you.
\begin{example}
\fontsize{12pt}{15pt}\selectfont
Text in 12 \TeX{} points.

\fontsize{12bp}{15bp}\selectfont
Text in 12 DTP points.
\end{example}
\endgroup

\subsection{Horizontal Space}\label{sec:hspace}

\LaTeX{} determines the spaces between words and sentences automatically.
However, similarly to commands described in \autoref{sec:math_spacing}, there are
ways to influence the spaces in normal text. For example, to add horizontal
space, you can use:\index{horizontal!space}
\begin{lscommand}
  \csi{hspace}[length: m]
\end{lscommand}
The \carg{length} argument can be specified using the units described in previous
section in the usual way. You can use decimal and even negative numbers as
values.
\begin{example}
This\hspace{1.5cm}is a space
of \qty{1.5}{\cm}. A bit too
cramped\hspace{-5pt}here.
\end{example}
The space added that way will disappear if it lands on the end of a line,
similarly to an interword spacing. If you want to retain the extra space, use the
starred version of the command.
\begin{example}
The gap here is\hspace{1cm}%
\linebreak missing.

Here the gap is\hspace*{1cm}%
\linebreak not missing.
\end{example}

So far all the lengths we have seen have been \emph{rigid}\index{rigid
  length}\index{length!rigid}, that is the length is exactly as specified. But
you probably noticed that the spaces between words are not rigid---they can
stretch and shrink, so that \TeX{} can make the right margin equal. Lengths
that can do that are called \emph{rubber} lengths\index{rubber
  length}\index{length!rubber}.

Such lengths can be specified using a special \ltx{plus} and \ltx{minus}
syntax. For example to specify that a space can stretch if a need arises you
can specify it by writing \ltx{plus} followed by the maximum allowed stretch.
\begin{example}
This small\hspace{1em plus 2cm}%
space may grow if a need arises.

Here\hspace{1em plus 2cm}the
need\linebreak very much arises.
\end{example}
The additional space can extend even beyond the specified maximum, but in such
cases \LaTeX{} will print a warning.

The shrinking can be specified in a similar way using the \ltx{minus} syntax.
\begin{example}
This\hspace{1em minus 2em}%
space may disappear if it gets
too crampy.
\end{example}

When there are multiple rubber spaces in text \TeX{} calculates the amount of
`stretch' proportionally to the specified maximum. Thus if \TeX{} needs
additional \qty{2}{\cm} of whitespace and one length has \ltx{plus 1cm} while
the other has \ltx{plus 3cm} modifier, it will result in the first one being
enlarged by \(\left(\frac{1}{1+3}\right) \times \qty{2}{\cm}\) while the second
one by \(\left(\frac{3}{1+3}\right) \times \qty{2}{\cm}\).
\begin{example}
This\hspace{0pt plus 3cm}is
stretched\hspace{0pt plus 1cm}%
three\linebreak times as much.
\end{example}

With these informations you can use the spaces to automatically centre the text
in a page by setting the allowed stretching to a high number.
\begin{example}
\hspace*{0pt plus 100cm}Hello
\hspace*{0pt plus 100cm}
\linebreak
\end{example}
This approach will, however, interfere with the spacing inside the centred
expression, since the spaces are still distributed proportionally. The effect
will be getting smaller if you set the allowed stretching to a larger number
but it will still be present. For situations like these, \TeX{} actually
supports a concept of infinitely stretchable space---by using the special
\cargv{fill} unit, allowed only as stretching and shrinking value, we can
ensure that all the other rubber lengths will not stretch.\footnote{\TeX{}
  actually recognises three orders of infinity: \cargv{fil}, \cargv{fill} and
  \cargv{filll}, but as a document author you should stick to using only the
  second one. The first order infinity---\cargv{fil}---is used by some of the
  internal \LaTeX{} such as \cs{\bs} or \cs{newpage}. The third one can be used
  to disallow stretching of the second order infinity when it's needed in some
  very rare circumstances.}
\begin{example}
\hspace*{0pt plus 1fill}%
No\hspace{0pt plus 100cm}
stretching allowed.%
\hspace*{0pt plus 1fill}%
\linebreak
\end{example}

Because the \cargv{fill} value is often used with zero width space \LaTeX{}
defines a macro that simplifies entering it---the
\begin{lscommand}
  \csi{stretch}[n: m]
\end{lscommand}
command.
\begin{example}
\hspace*{\stretch{1}}
is equivalent to
\hspace*{0pt plus 1fill}
\linebreak
\end{example}
The \carg{n} argument is the coefficient by which the \cargv{fill} is
multiplied. Recall that the spaces are distributed proportionally and this is
still the case when infinities are involved.
\begin{example}
x\hspace{\stretch{1}}%
x\hspace{\stretch{3}}x
\end{example}

Still, the most common value to use is \ltx{\hspace{0pt plus 1fill}} and so
\LaTeX{} defines \csi{hfill} that is equivalent to it. It's often used when you
want to flush the rest of the line right.
\begin{example}
Peter Pan\hfill Neverland

Dear Wendy, \ldots
\end{example}

\subsection{Vertical Space}

You have already seen that vertical space between lines can be inserted using
\csi{\bs} command. However, it does not work well when used for spacing between
paragraphs---the reason being that it always starts a new line, so if it's used
at the end of paragraph, it will end in an empty line.
\begin{example}
Paragraph.\\

There's an empty line above.
\end{example}
\LaTeX{} has a dedicated command for setting the space between paragraphs, the
\begin{lscommand}
  \csi{vspace}[length: m]
\end{lscommand}
command. It works similarly to the \cs{hspace} command, however when used
inside a line it will only produce the space after the line is ended.
\begin{example}
Some\vspace{1em} text that
spans multiple lines.
\end{example}
Since it does not produce empty lines when used, it is perfect for inserting a
space between paragraphs. Similarly to the \cs{hspace} command, the space will
be discarded if it lands at the end of a page---use the starred version if this
is not desirable.

The rubber lengths, \csi{stretch} and \csi{vfill} work for vertical space too. However, since manual vertical spacing is
much more common compared to manual horizontal spacing, \LaTeX{} also declares
three semantic commands for inserting them:
\begin{lscommand}
  \csi{bigskip} \\
  \csi{medskip} \\
  \csi{smallskip}
\end{lscommand}
The exact sizes of these skips is dependent on the class used. You can access
them as length by appending \enquote{amount} to their name, for example,
\csi{medskipamount}. These are useful when creating your own environments or to
indicate a thought break between paragraphs.\index{vertical space}

There also exist the \csi{addvspace command}, which works similarly to the
\cs{vspace} command, however when multiple such commands are entered one after
another, only the one with the biggest length will be used. Note that using it
will lead to an error if it is not used between paragraphs.
\begin{example}
Hello.

\addvspace{1pt}
\addvspace{1em}
\addvspace{1cm}
There is \qty{1}{\cm} space
above me.
\end{example}
This command is useful if you want to ensure that a vertical space is present
but avoid entering several of them accidentally.

\subsection{Length Variables}

Like many things in \LaTeX, lengths can be stored inside commands to allow
reuse.
\begin{example}
\NewDocumentCommand{%
  \mylength}{}{2em}
foo\hspace{\mylength}bar
\end{example}
However, \LaTeX{} provides dedicated length variables, which are much better
suited for the purpose. These are created using
\begin{lscommand}
  \csi{newlength}[variable: M]
\end{lscommand}
and set using
\begin{lscommand}
  \csi{setlength}[variable: M, length: m]
\end{lscommand}
It's important to note that \csi{newlength} declares the length globally, but
\csi{setlength} only affects the current group. If you declare a length
variable without setting it, it will have a default value of zero.

In contrast to the command approach, length variables are stored as numbers and
not as text. This allows you to to do simple arithmetic operations, for
example, to scale them by prepending them with a number.
\begin{example}
\newlength{\mylength}
\setlength{\mylength}{2em}
foo\hspace{0.5\mylength}bar%
\hspace{2\mylength}baz
\end{example}
In order to increase an existing length variable you can use \csi{addtolength}.
\begin{example}
\setlength{\mylength}{2em} %!hide
foo\hspace{\mylength}bar\\
\addtolength{\mylength}{2em}
foo\hspace{\mylength}bar
\end{example}

Since length variables are not stored as text macros, but as \TeX{} internal
numbers, trying to typeset them in a document results in an error. To translate
them back into their textual representation use the \csi{the} command. Note
that their value will always be printed using points as units.
\begin{chktexignore}  
\begin{example}
\setlength{\mylength}{1cm}
\the\mylength
\end{example}
\end{chktexignore}

Lengths can be also determined dynamically from the content. The following
commands allow you to determine the width, height and depth of a \LaTeX{} text
and assign it to length variable.
\begin{lscommand}
  \csi{settoheight}[variable: M, element: m]\\
  \csi{settodepth}[variable: M, element: m] \\
  \csi{settowidth}[variable: M, element: m]
\end{lscommand}
The element height is calculated by taking into account the part of the element
that extends above baseline, while the depth takes into account the part that
extends below baseline.
\begin{example}[vertical_mode, examplewidth=0.85\linewidth]
\newlength{\myheight} \settoheight{\myheight}{Major}
\newlength{\mydepth} \settodepth{\mydepth}{Major}
\newlength{\mywidth} \settowidth{\mywidth}{Major}
The word Major has width of \the\mywidth, height of
\the\myheight{} and depth of \the\mydepth.
\end{example}

These commands are especially useful when creating your own environments
requiring complicated alignment or spacing. An example of using them is
presented in \autoref{lst:fun_with_lengths}.

\begin{listing}
  \begin{example}[vertical_mode, examplewidth=0.85\linewidth]
\newlength{\vardescindent}
\NewDocumentEnvironment{vardesc}{m}{%
  \settowidth{\vardescindent}{#1:\ }%
  \RenewDocumentCommand{\item}{so}{%
    \IfBooleanTF{##1}{#1: }{\\\hspace*{\vardescindent}}%
    \IfValueT{##2}{##2 ---}%
  }%
  \ignorespaces
}{}

\[  a^2+b^2=c^2 \]
\begin{vardesc}{Where}
  \item*[\(a\), \(b\)] are adjacent to the right angle
    of a right-angled triangle.
  \item[\(c\)] is the hypotenuse of the triangle and
    feels lonely.
  \item[\(d\)] finally does not show up here at all.
    Isn't that puzzling?
\end{vardesc}
\end{example}
  \caption{An example of using \cs{settowidth} to align all of the
    definitions to a preceding phrase.}\label{lst:fun_with_lengths}
\end{listing}

As you will see \LaTeX{} uses length variables for many things. When
typesetting a document you can use some of them when setting lengths to make them
relative. For example, the \csi{linewidth} length holds the length of the
current line. You can use it when inserting a picture to make it fill the page
or scale it to take up half the space available.
\begin{example}
\includegraphics[
  width=0.5\linewidth,
]{example-image}
\end{example}

\section{The Layout of the Document}

\subsection{Document Class Options}\label{sec:documentclassoptions}

The easiest way to influence the layout of the document is to pass options to
the
\begin{lscommand}
  \csi{documentclass}[options: o, class: m]
\end{lscommand}
command at the beginning of your file. The available classes where already
described in \autoref{documentclasses} on \autopageref{documentclasses}. The
\carg{options} have to be separated by commas. The most common options for the
standard document classes are listed in \autoref{options}.

\begin{table}
  \RenewDocumentCommand{\arraystretch}{}{1.2}
  \caption{Document Class Options.}\label{options}
  \begin{tabular}{@{}>{\RaggedRight}p{2.5cm}p{9cm}@{}}
    \toprule
    Options                                  & Description                   \\
    \midrule
    \cargv{10pt}, \cargv{11pt}, \cargv{12pt} & Sets the size
    of the main font in the document. If no option is specified,
    \cargv{10pt} is assumed.\index{document font size}\index{base
    font size}                                                               \\
    \cargv{a4paper}, \cargv{letterpaper}     & Defines the paper size.
    The default size can be configured when installing \LaTeX. Besides these,
    \cargv{a5paper}, \cargv{b5paper}, \cargv{executivepaper}, and
    \cargv{legalpaper} can be specified. Note that it only affects the layout
    of margins, not the PDF paper size itself, see \autoref{sec:page_layout}
    for more details.\index{legal paper}\index{paper
      size}\index{A4 paper}\index{letter paper}\index{A5 paper}\index{B5
    paper}\index{executive paper}                                            \\
    \cargv{fleqn}                            & Typesets
    displayed formulae left-aligned instead of centred.                      \\
    \cargv{leqno}                            & Places
    the numbering of formulae on the left hand side instead of the right.    \\
    \cargv{titlepage}, \cargv{notitlepage}   & Specifies
    whether a new page should be started after the \wi{document title}
    or not. The \cli{article} class does not start a new page by
    default, while the \cli{report} and \cli{book} classes do.\index{title}              \\
    \cargv{onecolumn}, \cargv{twocolumn}     & Instructs
    \LaTeX{} to typeset the document in \wi{one column} or \wi{two column}s. \\
    \cargv{twoside, oneside}                 & Specifies whether
    double or single sided output should be generated. The classes
    \cli{article} and \cli{report} are \wi{single sided}, while the
    \cli{book} class is \wi{double sided} by default. Note that this
    option concerns the style of the document only. \cargv{twoside}
    does \emph{not} tell the printer to make a two-sided printout.                               \\
    \cargv{landscape}                        & Changes the
    layout of the document to print in landscape mode.                       \\
    \cargv{openright, openany}               & Makes chapters begin
    either only on right hand pages o,r on the next page available. This does
    not work with the \cli{article} class, as it does not know about
    chapters. By default, the \cli{report} class by default starts chapters on
    the next page available, while the \cli{book} class starts them on
    right hand pages.                                                        \\
    \bottomrule
  \end{tabular}
\end{table}

For example, if an input file for a \LaTeX{} document starts with the line
\begin{code}
\csi{documentclass}[{11pt, twoside, a4paper}: vo, article: vm]
\end{code}
then it instructs \LaTeX{} to typeset the document as an article with a base
font size of eleven points, and to produce a layout suitable for double sided
printing\footnote{Note that this only influences the appearance of the document
  to be adequate for double sided printing---you still have to pass proper
  instructions to your printer to print it on both sides.} on A4 paper.

If you do not like the appearance of the standard \LaTeX{} classes, the easiest
way to change it is to use some alternatives. For example, the
\pai*{koma-script} package provides alternatives that produce documents with European
typography traditions in mind. Another popular package is \pai*{memoir}, which
provides a single \cli{memoir} class with extensive customization options. On
\href{https://www.ctan.org/}{CTAN} you can find many more specialized classes
that will let you produce documents as prescribed by various universities or
typographical traditions.

\subsection{Page Styles}

\LaTeX{} supports three predefined \wi{header}\slash\wi{footer}
combinations---so-called \wi{page style}s. The \carg{style} parameter
of the\index{page style!plain@\texttt{plain}}\index{plain@\texttt{plain}}\index{page
  style!headings@\texttt{headings}}\index{headings@\texttt{headings}}\index{page
  style!empty@\texttt{empty}}\index{empty@\texttt{empty}}
\begin{lscommand}
  \csi{pagestyle}[style: m]
\end{lscommand}
command defines which one to use. \autoref{pagestyle} lists the predefined
page styles.

\begin{table}
  \caption{The Predefined Page Styles of \LaTeX.}\label{pagestyle}
  \begin{tabular}{lp{8cm}}
    \toprule
    Style              & Description                                      \\
    \midrule
    \cargv{plain}      & Prints the page numbers on the bottom
    of the page, in the middle of the footer. This is the default page
    style.                                                                \\
    \cargv{headings}   & Prints the current chapter heading
    and the page number in the header on each page, while the footer
    remains empty.  (This is the style used in this document.)             \\
    \cargv{empty}      & Sets both the header and footer
    to be empty.                                                          \\
    \cargv{myheadings} & Similar to the \cargv{headings} style but leaves
    the headers and footers empty, allowing them to be defined by
    the author. A description of how to do this is in
    \autoref{sec:fancy}.                                                  \\
    \bottomrule
  \end{tabular}
\end{table}

It is possible to change the page style of the current page with the command
\begin{lscommand}
  \csi{thispagestyle}[style: m]
\end{lscommand}

You may also control the style of the displayed page numbers. To change it, use
the
\begin{lscommand}
  \csi{pagenumbering}[style: m]
\end{lscommand}
command, where \carg{style} is one of the styles presented in
\autoref{tb:numberings}.

\begin{table}
  \caption{Possible argument of the \csi{pagenumbering}
    command.}\label{tb:numberings}
  \begin{tabular}{@{}ll@{}}
    \toprule
    Style          & Description                                   \\
    \midrule
    \cargv{arabic} & Arabic numerals (1, 2, 3, \ldots)             \\
    \cargv{roman}  & Lowercase Roman numerals (i, ii, iii, \ldots) \\
    \cargv{Roman}  & Uppercase Roman numerals (I, II, III, \ldots) \\
    \cargv{alph}   & Lowercase Latin letters (a, b, c, \ldots)     \\
    \cargv{Alph}   & Uppercase Latin letters (A, B, C, \ldots)     \\
    \bottomrule
  \end{tabular}
\end{table}

If would like more control over the apparance of your headers and footers, refere to \autoref{sec:fancy} on \autopageref{sec:fancy}.

\subsection{Line Spacing}\index{line spacing}

When using custom fonts, you may find that the default line spacing does not
match your taste. You could redefine it using the \csi{fontsize} commands,
however, this will be overwritten once you use size changing commands described
in \autoref{sizes}.

To make such adjustments easier \LaTeX{} defines the
\begin{lscommand}
  \csi{linespread}[factor: m]
\end{lscommand}
command. Once used, each line skip will be multiplied by the \carg{factor}.
Note, that outside the preamble, you must follow it by \csi{selectfont} for the
changes to be visible.
\begin{example}
\linespread{0.9}\selectfont
If you want to save paper, set
the linespread to a value
below 1 to sacrifice a bit of
space between lines.

\linespread{1.1}\selectfont
On the other hand, if your
assignment is short a few
pages, setting it to a value
above 1 might just save you
some typing.
\end{example}

Using the \csi{linespread} command it's also possible to create an effect of
\enquote{one and a half} or \enquote{double} line spacing. Recall that the
default line spacing is around \qty{1.2}{em}. Thus if you want to make the
document use double line spacing you have to set the \carg{factor} to
\(\sfrac{2}{1.2} \approx 1.667\).

Note that setting the \csi{linespread} will change the line spacing
\emph{everywhere}---including footnotes, table of contents and floats. Doing so
is not always desirable, so another approach is to set the \csi{baselineskip}
length. This will only affect the line spacing of the main document text.
Similarly to the size changing commands it affects the whole paragraph.
\begin{example}
{\setlength{\baselineskip}{%
  1.5\baselineskip}
This paragraph is typeset with
the baseline skip set to 1.5 of
what it was before. Note the
par command at the end of the
paragraph.\par}

Here the line spacing returns
to normal, because line skip
changes are local to a group.
\end{example}

Yet another approach is to use a dedicated package, like \pai*{setspace} that
defines \csi{doublespacing} and similar commands. Note that in general you
should avoid using excessive line spacing, unless you are emulating an old
document look.

\subsection{Paragraph Formatting}\label{parsp}

In \LaTeX{}, there are two lengths influencing paragraph layout:
\csi{parindent} defines how much a paragraph is indented, while \csi{parskip}
is the amount of space inserted between paragraphs.
\begin{example}
\setlength{\parindent}{0pt}
\setlength{\parskip}{%
  \medskipamount}

On the web it is common to
separate paragraphs by some
space instead of indenting.

Like this.
\end{example}
Beware, that these lengths also affect the table of contents---its lines get
spaced more loosely. To avoid this, you might want to put the two commands
after the \cs{tableofcontents} command or to not use them at all, because
you'll find that most professional books use indenting and not spacing to
separate paragraphs.

If you want to indent a paragraph that is not indented, use \csi{indent} at the
beginning of the paragraph. Obviously, this will only have an effect when
\csi{parindent} is not set to zero. In continental Europe it is sometimes the
case that every paragraph should be indented, even after sections. To avoid
using ths \csi{indent} command everywhere, simply use the \pai*{indentfirst}
package in your preamble.
\begin{example}[standalone, paperheight=2.5cm, paperwidth=0.5\linewidth]
\usepackage{indentfirst}
% ...

\begin{document} %!hide
\section{Title}

The first paragraph is now
indented.
\end{document} %!hide
\end{example}

To create a non-indented paragraph, use \csi{noindent} as the first command of
the paragraph. This might come in handy when you start a document with body
text and not with a sectioning command.

\subsection{Page Layout}\label{sec:page_layout}
\begingroup
\LshortExampleSetup{
  standalone,
  template=empty,
  paperwidth=6cm,
}
As you have seen, \LaTeX{} allows you to specify the \wi{paper size} via
options in the \cs{documentclass} command. It then automatically picks the
right text \wi{margins}, but sometimes you may not be happy with the predefined
values. Naturally, you can customize them to your liking. But before you start
making the margins as narrow as possible to cram the text in, take a few
seconds to think. As with most things in \LaTeX, there are good reasons for the
page layout to be as it is.

Sure, compared to your off-the-shelf page of your favourite WYSIWYG editor, the
margins look awfully wide. But take a look at your favourite, professionally
printed book and count the number of characters on a standard text line. You
will find that most lines contain between 45 and 80 characters. Now do the same
on your \LaTeX{} page. You will find that the same relationship holds.
Empirical studies suggest that averaging around 66 characters per line creates
the optimal reading experience for readers. If you want to save space when
printing your document consider using \cargv{twocolumn} option or smaller page
sizes.

With that warning in place let us proceed to the proper introduction of
\pai*{geometry} package that allows you to easily customize the page dimensions
of your document. It is worth noting that simply including the package in your
preamble will result in considerably narrower margins, (the very thing we
warned you to avoid) so only use the package if you intend to set them
manually or use the \cargv{pass} option that disables most of the package
functions but retains the paper size adjustments.

As we have mentioned in \autoref{options}, simply setting \cargv{a5paper} (or
similar) option will only adjust margins of the document without changing the
paper dimensions themselves. The simplest way to fix that is to add the
\pai{geometry} package to your preamble. It will read the page size option
and adjust it accordingly. The package itself also supports many more page
sizes, such as \cargv{a0paper} or \cargv{a6paper}.
\begin{example}
\documentclass{article}

\usepackage[
  a6paper,
  landscape,
]{geometry}

\begin{document}
This document is typeset on
A6 paper in landscape mode.
\end{document}
\end{example}

If the predefined dimensions are not enough you can always set it directly
using \cargv{paperheight} and \cargv{paperwidth} keys.
\begin{example}
\documentclass{article} %!hide
\usepackage[
  paperwidth=6cm,
  paperheight=3cm
]{geometry}
% ...

\begin{document} %!hide
This page has dimensions of
6 by 3 centimetres.
\end{document} %!hide
\end{example}

As we have indicated, the package is also capable of adjusting the margins. The
simplest way to do so is to use the \cargv{left}, \cargv{right}, \cargv{top},
and \cargv{bottom} options, each of which sets the size of the respective
margin.
\begin{example}[paperheight=4cm]
\documentclass{article} %!hide
\usepackage[
  paperheight=\height, %!hide
  paperwidth=\width, %!hide
  top=0.5cm,
  bottom=1cm,
  left=1.5cm,
  right=2cm,
]{geometry}
% ...
%!hidebegin
\usepackage{blindtext}
\sloppy
\begin{document}
\blindtext
\end{document}
\end{example}
Note that by default the header and footer are not considered part of the
page body, so they may not fit on page if the margins are too narrow (like in
the example above). If you want to include them when considering margins use
the \cargv{includefoot} and/or \cargv{includehead} options.

One of the killer features of the \pai{geometry} package is its ability to
calculate the correct margin sizes based on other metrics. For example, we can
declare that we want the text to have a given width via \cargv{textwidth}
option and that each page should have a given number of lines via \cargv{lines}
option and the appropriate sizes of margins will be calculated automatically.
\begin{example}[paperheight=4cm]
\documentclass{article} %!hide
\usepackage[
  paperheight=\height, %!hide
  paperwidth=\width, %!hide
  textwidth=5cm,
  lines=3
]{geometry}
% ...
%!hidebegin
\usepackage{blindtext}
\sloppy
\begin{document}
\blindtext
\end{document}
\end{example}
There are many more options to influence the margins: specifying their ratios
(\cargv{ratio}), defining them to take up certain percent of available paper
size (\cargv{scale}), or including binding offset (\cargv{bindingoffset}).
Check out the package documentation~\cite{pack:geometry} for a full list with
examples.

A useful option for prototyping your layout is the \cargv{showframe} option
that draws frames around document body and margins to easier evaluate the
chosen layout.
\endgroup
\section{Fancy Headers}\label{sec:fancy}

\subsection{Basic commands}

%$$ Not sure if the overall conversational tone of this subsection is in keeping
%$$ with the bulk of the rest of the document.

The \pai*{fancyhdr} package provides a few simple commands that allow you to
customise the header and footer lines of your document. It defines an
additional page style \cargv{fancy} and a set of commands to customise it to
your liking. By default, it only adds a line separating the header from the page
body.
\begin{example}[standalone, paperheight=3cm]
\geometry{includefoot, includehead, headsep=.5em, footskip=1em} %!hide
%!showbegin %!hide
\documentclass{article}

%!showend %!hide
\usepackage{fancyhdr}
\pagestyle{fancy}

\begin{document}
\noindent %!hide
This statement is false.
\end{document}
\end{example}

The primary command of the package is
\begin{lscommand}
  \csi{fancyhf}[places: o, field: m]
\end{lscommand}
The \carg{places} is a comma separated list of places where the \carg{field} should be displayed. There are total of 12 different places and each is identified by a
combination of three letters:
\begin{itemize}
  \item The first specifies whether the location is in the header (\cargv{H}) or
        in the footer (\cargv{F}).
  \item The second letter specifies the location within the header or footer:
        \cargv{L} for left, \cargv{C} for centre, and \cargv{R} for right.
  \item The third letter defines whether the field should be printed on even
        (\cargv{E}) or odd (\cargv{O}) pages. If the document is not two sided,
        then all pages are treated as odd.
\end{itemize}
For example, the combination \cargv{FCE} identifies the centre part of the
footer on even pages. If any of the letters is omitted, then the identifier
points toward all positions specifiable by the omitted letter. For example,
\cargv{HR} is right side of the header on both odd and even pages.
\begin{example}[template=empty, standalone, paperheight=2.3cm, paperwidth=6cm, to_page=2,vertical_pages]
\documentclass[twoside]{article}

%!hidebegin
\usepackage[paperheight=\height,
    paperwidth=\width,
    margin=0.3cm,
    includefoot,
    includehead,
    headsep=.5em,
    footskip=1em
]{geometry}
%!hideend
\usepackage{fancyhdr}
\pagestyle{fancy}

\fancyhf[HCE]{A}
\fancyhf[L]{\emph{B}}
\fancyhf[FR]{\textbf{C}}
\fancyhf[HCO, HRE]{\textsl{D}}

\begin{document}
\noindent %!hide
The next statement is false.
The previous statement is true.
\end{document}
\end{example}

There are two additional commands, \csi{fancyhead} and \csi{fancyfoot}, that
work in the same way, except that they respectively assume \cargv{H} and
\cargv{F} in their \carg{places} argument, unless otherwise specified.
\begin{example}[standalone, paperheight=3.5cm]
\geometry{includefoot, includehead, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{csquotes} %!hide
\usepackage{fancyhdr}%!hide
\pagestyle{fancy}%!hide

\fancyhead[L]{A}
\fancyfoot[R]{B}

\begin{document}%!hide
\noindent %!hide
\enquote{Yields a falsehood when
appended to its own quotation}
yields a falsehood when appended
to its own quotation.
\end{document}%!hide
\end{example}

The lines drawn by the \pai{fancyhdr} package may also be customised. To change
%$$ Inserted comma after 'thickness'.
their thickness, redefine the
\begin{lscommand}
  \csi{headrulewidth} \\
  \csi{footrulewidth}
\end{lscommand}
macros to the desired size.
\begin{example}[standalone, paperheight=3cm, paperwidth=3cm]
\geometry{includefoot, includehead, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr} %!hide
\pagestyle{fancy} %!hide
\RenewDocumentCommand{\headrulewidth}{}{.2cm}
\RenewDocumentCommand{\footrulewidth}{}{.5cm}

\begin{document}%!hide
\noindent %!hide
Do not read this sentence.
\end{document}%!hide
\end{example}

By default, headers and footers are as long as the text on the page. If you want
to extend or shorten them, use the
\begin{lscommand}
  \csi{fancyhfoffset}[places: o, offset: m]
\end{lscommand}
Added comma after \csi{fancyhf}.
command. The \carg{places} argument is the same as in \csi{fancyhf}, except that
it cannot contain \cargv{C}.
\begin{example}[standalone, paperheight=3cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\pagestyle{fancy}%!hide
\fancyhfoffset[L]{-1cm}
\fancyhfoffset[R]{.2cm}

\begin{document}%!hide
\noindent %!hide
If this sentence is true,
then \(2 + 2 = 5\).
\end{document}%!hide
\end{example}
The command \csi{fancyheadoffset} and \csi{fancyfootoffset} are
used the same way as \csi{fancyf}, but they only modify header or footer respectively.

\subsection{Contents of the headers}

%$$ Not sure if the overall conversational tone of this subsection is in keeping
%$$ with the bulk of the rest of the document.

The default footer of the article class contains the current page number. To
use it inside the fancy header, simply use the command \csi{thepage}.
\begin{example}[standalone, paperheight=2.5cm, to_page=2, vertical_pages]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\pagestyle{fancy}%!hide
\fancyhf{Page~\thepage}

\begin{document}%!hide
\noindent %!hide
This statement is dedicated to
all statements that are not
dedicated to themselves.
\end{document}%!hide
\end{example}

It is often useful to have the header and footer contain information based on
the content of the page. These are called \enquote{marks} in \LaTeX{}
terminology. Before we talk about the default ones, let's consider how you can
define your own using the \pai{extramarks}\footnote{\pai{extramarks} is part
  of \pai*{fancyhdr}.} package.
\begin{lscommand}
  \csi{extramarks}[left:m, right:m] \\
  \csi{firstleftxmark} \\
  \csi{firstrightxmark} \\
  \csi{lastleftxmark} \\
  \csi{lastrightxmark}
\end{lscommand}
The \csi{extramarks} command sets the contents of \carg{left} and \carg{right}
marks. Then you can access these marks inside the headers by using the appropriate
command. The \texttt{first}- commands refer to the first mark occurring on the
page, while the \texttt{last}- refer to the last one.
\begin{example}[standalone, paperheight=4cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}
\pagestyle{fancy}%!hide

\fancyhead[L]{\firstleftxmark}
\fancyhead[R]{\lastleftxmark}
\fancyfoot[L]{\firstrightxmark}
\fancyfoot[R]{\lastrightxmark}

\begin{document} %!hide
\noindent %!hide
The second statement is false.
\extramarks{One}{2 is false}
The third statement is false.
\extramarks{Two}{3 is false}
The first statement is false.
\extramarks{Three}{1 is false}
\end{document} %!hide
\end{example}

Let us now look at the default marks defined by \LaTeX{}. After loading
\pai{extramarks}, these may be set and accessed similarly:
\begin{lscommand}
  \csi{markboth}[left:m, right:m] \\
  \csi{firstleftmark} \\
  \csi{firstrightmark} \\
  \csi{lastleftmark} \\
  \csi{lastrightmark}
\end{lscommand}
The only difference between these and the extra marks is that \LaTeX{} classes
automatically fill them. Hence, if you are not careful, you may lose your
content.\footnote{You may prevent this by setting the pagestyle to
  \cargv{myheadings} and then redefining it to use it with \pai{fancyhdr} as
  described later.}
For example, in the article class, \carg{left} is set by the \csi{section}
command, while \carg{right} is set by the \csi{subsection} command.
\begin{example}[standalone, paperheight=5cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}%!hide
\pagestyle{fancy}%!hide
\fancyhead[L]{\firstleftmark}
\fancyhead[R]{\lastleftmark}
\fancyfoot[L]{\firstrightmark}
\fancyfoot[R]{\lastrightmark}

\begin{document}%!hide
\section{First}
\subsection{Sub}
\section{Second}
\subsection{Sub}
\end{document}%!hide
\end{example}
Note that \csi{firstrightmark} is empty in the above example. This is caused by
the fact that \csi{section} commands set both marks, leaving the right one
empty.

You may have noticed that section titles are typeset in uppercase when provided
by -\texttt{mark} commands. To disable this use the \csi{nouppercase} command inside the
\csi{fancyhf} command.
\begin{example}[standalone, paperheight=3cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}%!hide
\pagestyle{fancy}%!hide
\fancyhead[R]{%
  \nouppercase{\firstleftmark}%
}

\begin{document}%!hide
\section{Today}
is opposite day.
\end{document}%!hide
\end{example}

\subsection{Advanced commands}

If you want even more control over section titles, you can redefine the
\csi{sectionmark}.\footnote{Or \csi{chaptermark}, \csi{subsectionmark} \ldots} The
command receives the section title as its first argument, while the section
number is available as \csi{thesection}.
\begin{example}[standalone, paperheight=4.5cm, paperwidth=4cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}%!hide
\pagestyle{fancy}%!hide
\fancyhead[R]{\firstleftmark}
\RenewDocumentCommand{\sectionmark}{m}{%
  \markboth{%
    Section no.\,\thesection: #1}{}%
}

\begin{document}%!hide
\section{Person}
There exists a person such that
if they are reading this then
everybody is reading this.
\end{document}%!hide
\end{example}
If you only want to change the right mark, use the \csi{markright} command.

By default, the field in the centre of the header or footer will expand equally
to the left and right. This is usually the desired behaviour, but in some
cases it may overlap with either left or right text, while still having some
space on the other side.
\begin{example}[standalone, paperheight=3cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}%!hide
\pagestyle{fancy}%!hide
\fancyhead[L]{\thepage}
\fancyhead[C]{\firstleftmark}
\fancyhead[R]{Jane Doe}

\begin{document}%!hide
\section{Section}
Section by Jane Doe
\end{document}%!hide
\end{example}
In this situation you may want to use the
\begin{lscommand}
  \csi{fancycenter}[distance:o, stretch:o, left:m, centre:m, right:m]
\end{lscommand}
command, which automatically shifts the centre toward the shorter text. The
\carg{distance} is the minimum distance by which the elements are always
surrounded (\cargv{1em}, by default). The \carg{stretch} controls the preference
for shifting the \carg{centre}; \cargv{1} means shift only when and as much
as necessary. Higher numbers will start shifting sooner and more aggressively.
The default is \cargv{3}. This command writes over the whole header\slash{}footer
space so it should only be put in one place (typically \cargv{C}) and other
places (\cargv{L,R}) should be empty.
\begin{example}[standalone, paperheight=3cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}%!hide
\pagestyle{fancy}%!hide
\fancyhead[L,R]{}
\fancyhead[C]{%
  \fancycenter%
    {\thepage}%
    {\firstleftmark}%
    {Jane Doe}%
}

\begin{document}%!hide
\section{Section}
Section by Jane Doe
\end{document}%!hide
\end{example}

You may want to present different headers or footers when the corresponding
page starts with a float or ends with a footnote. The \pai{fancyhdr} package
defines four commands that let you achieve this.
\begin{lscommand}
  \csi{iftopfloat}[true branch:m, false branch:m] \\
  \csi{ifbotfloat}[true branch:m, false branch:m] \\
  \csi{iffloatpage}[true branch:m, false branch:m] \\
  \csi{iffootnote}[true branch:m, false branch:m]
\end{lscommand}
Commands \csi{iftopfloat} and \csi{ifbotfloat} execute their \carg{true branch}
if a float sits at the top or bottom of the page (respectively).

Similarly, \csi{iffloatpage} checks whether
the page is a special float-only page, while \csi{iffootnote} checks for a
footnote at the bottom of the page.
\begin{example}[standalone, paperheight=4cm, to_page=2, vertical_pages]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}%!hide
\pagestyle{fancy}%!hide

\fancyhead[C]{%
  \iftopfloat{%
    A float is below me%
  } {}
}
\fancyfoot[C]{%
  \iffootnote{%
    A footnote is above me%
  } {%
    \thepage%
  }%
}

\begin{document}%!hide
\noindent %!hide
Ignore this footnote.%
\footnote{Read this.}
\begin{figure}[t]
  \centering
  A floating float.
  \caption{Hmm}
\end{figure}
\end{document}%!hide
\end{example}

The ruled lines in headers and footers are created by invoking \csi{headrule}
and \csi{footrule} commands. If you want finer control over the lines, consider
redefining these macros. Use \csi{headruleskip} and \csi{footruleskip} to raise
or lower them, if necessary.
\begin{example}[standalone, paperheight=4cm, paperwidth=3.2cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}%!hide
\pagestyle{fancy}%!hide
\RenewDocumentCommand{\headrule}{}{
  \rule{0.05\headwidth}{0.2cm}%
  \rule[0.1cm]{0.9\headwidth}{\headrulewidth}%
  \rule{0.05\headwidth}{0.2cm}%
}

\RenewDocumentCommand{\headruleskip}{}{-0.2cm}

\begin{document}%!hide
\noindent %!hide
My age is the first number not
nameable in under twenty words.
\end{document} %!hide
\end{example}

While working on a longer document, you may want to have several page styles for
different occasions. You may also notice that some commands (\csi{chapter} and
\csi{maketitle}, for example) change the page style to \cargv{plain}.
The solution to both of these problems is the
\begin{lscommand}
  \csi{fancypagestyle}[name:m, code:m]
\end{lscommand}
command. The \carg{name} is the name of page style to (re)define, while the %chktex 36
\carg{code} is the code to set the page style. All page styles declared this
way use the \cargv{fancy} page style as their basis, so if empty \carg{code} is
given they will match \cargv{fancy} exactly.
\begin{example}[standalone, paperheight=3cm]
\geometry{includehead, includefoot, headsep=.5em, footskip=1em} %!hide
\sloppy %!hide
\usepackage{fancyhdr}%!hide
\usepackage{extramarks}%!hide
\fancypagestyle{mine}{
  \fancyhead[L]{My style}
}
\pagestyle{mine}

\begin{document}%!hide
%!showbegin %!hide
Were you expecting a paradox here?
%!showend !hidebegin
\noindent
You may be disappointed.
\end{document}
\end{example}
%$$ I don't think I understand the above example.
%$$ The connection between 'paradox' on the left, and 'disappointed' on the 
%$$ right isn't obvious. Did I miss something?

\section{Boxes}\label{sec:boxes}
\LaTeX{} builds up its pages by pushing around boxes. At first, each
letter is a little box, which is then glued to other letters to form
words. These are again glued to other words, but with special glue,
which is elastic so that a series of words can be squeezed or
stretched as to exactly fill a line on the page.

I admit, this is a very simplistic version of what really happens, but the
point is that \TeX{} operates on glue and boxes. Letters are not the only
things that can be boxes. You can put virtually everything into a box,
including other boxes. Each box will then be handled by \LaTeX{} as if it
were a single letter.

In earlier chapters you encountered some boxes, although I did
not tell you. The \ei{tabular} environment and the \csi{includegraphics}, for
example, both produce a box. This means that you can easily arrange two
tables or images side by side. You just have to make sure that their
combined width is not larger than the text width.

You can also pack a paragraph of your choice into a box with either
the

\begin{lscommand}
  \csi{parbox}\verb|[|\emph{pos}\verb|]{|\emph{width}\verb|}{|\emph{text}\verb|}|
\end{lscommand}

\noindent command or the

\begin{lscommand}
  \verb|\begin{|\ei{minipage}\verb|}[|\emph{pos}\verb|]{|\emph{width}\verb|}| text
  \verb|\end{|\ei{minipage}\verb|}|
\end{lscommand}

\noindent environment. The \texttt{pos} parameter can take one of the letters
\texttt{c, t} or \texttt{b} to control the vertical alignment of the box,
relative to the baseline of the surrounding text. \texttt{width} takes
a length argument specifying the width of the box. The main difference
between a \ei{minipage} and a \csi{parbox} is that you cannot use all commands
and environments inside a \ei{parbox}, while almost anything is possible in
a \ei{minipage}.

While \csi{parbox} packs up a whole paragraph doing line breaking and
everything, there is also a class of boxing commands that operates
only on horizontally aligned material. We already know one of them;
it's called \csi{mbox}. It simply packs up a series of boxes into
another one, and can be used to prevent \LaTeX{} from breaking two
words. As boxes can be put inside boxes, these horizontal box packers
give you ultimate flexibility.

\begin{lscommand}
  \csi{makebox}\verb|[|\emph{width}\verb|][|\emph{pos}\verb|]{|\emph{text}\verb|}|
\end{lscommand}

\noindent \texttt{width} defines the width of the resulting box as
seen from the outside.\footnote{This means it can be smaller than the
  material inside the box. You can even set the
  width to 0pt so that the text inside the box will be typeset without
  influencing the surrounding boxes.}  Besides the length
expressions, you can also use \csi{width}, \csi{height}, \csi{depth}, and
\csi{totalheight} in the width parameter. They are set from values
obtained by measuring the typeset \emph{text}. The \emph{pos} parameter takes
a one letter value: \textbf{c}enter, flush\textbf{l}eft,
flush\textbf{r}ight, or \textbf{s}pread the text to fill the box.

The command \csi{framebox} works exactly the same as \csi{makebox}, but
it draws a box around the text.

The following example shows you some things you could do with
the \csi{makebox} and \csi{framebox} commands.

\begin{example}
\makebox[\textwidth]{%
    c e n t r a l}\par
\makebox[\textwidth][s]{%
    s p r e a d}\par
\framebox[1.1\width]{Guess I'm
    framed now!} \par
\hspace{1cm} %!hide
\framebox[0.8\width][r]{Bummer,
    I am too wide} \par
\framebox[1cm][l]{never
    mind, so am I}
Can you read this?
\end{example}

Now that we control the horizontal, the obvious next step is to go for
the vertical.\footnote{Total control is only to be obtained by
  controlling both the horizontal and the vertical \ldots}
No problem for \LaTeX{}. The

\begin{lscommand}
  \csi{raisebox}\verb|{|\emph{lift}\verb|}[|\emph{extend-above-baseline}\verb|][|\emph{extend-below-baseline}\verb|]{|\emph{text}\verb|}|
\end{lscommand}

\noindent command lets you define the vertical properties of a
box. You can use \csi{width}, \csi{height}, \csi{depth}, and
\csi{totalheight} in the first three parameters, in order to act
upon the size of the box inside the \emph{text} argument.

\begin{example}[examplewidth=0.45\linewidth]
\raisebox{0pt}[0pt][0pt]{\Large%
\textbf{Aaaa\raisebox{-0.3ex}{a}%
\raisebox{-0.7ex}{aa}%
\raisebox{-1.2ex}{r}%
\raisebox{-2.2ex}{g}%
\raisebox{-4.5ex}{h}}}
she shouted, but not even the next
one in line noticed that something
terrible had happened to her.
\end{example}

\section{Rules}\label{sec:rule}

A few pages back you may have noticed the command

\begin{lscommand}
  \csi{rule}\verb|[|\emph{lift}\verb|]{|\emph{width}\verb|}{|\emph{height}\verb|}|
\end{lscommand}

\noindent In normal use it produces a simple black box.

\begin{example}
\rule{3mm}{.1pt}%
\rule[-1mm]{5mm}{1cm}%
\rule{3mm}{.1pt}%
\rule[1mm]{1cm}{5mm}%
\rule{3mm}{.1pt}
\end{example}

\noindent This is useful for drawing vertical and horizontal
lines. The line on the title page, for example, has been created with a
\csi{rule} command.

\bigskip
\begin{FlushRight}
  The End.
\end{FlushRight}

%

% Local Variables:
% TeX-master: "lshort2e"
% mode: latex
% mode: flyspell
% End:
