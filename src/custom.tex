% The Not So Short Introduction to LaTeX
%
% Copyright (C) 1995--2022 Tobias Oetiker, Marcin Serwin, Hubert Partl,
% Irene Hyna, Elisabeth Schlegl and Contributors.
%
% This document is free software: you can redistribute it and/or modify it
% under the terms of the GNU General Public License as published by the Free
% Software Foundation, either version 3 of the License, or (at your option) any
% later version.
%
% This document is distributed in the hope that it will be useful, but WITHOUT
% ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
% FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
% details.
%
% You should have received a copy of the GNU General Public License along with
% this document.  If not, see <https://www.gnu.org/licenses/>.

% !TEX root = ./lshort.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Contents: Customising LaTeX output
% $Id$
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Customising \LaTeX}\label{chap:custom}

\begin{intro}
  Documents produced with the commands you have learned up to this
  point will look acceptable to a large audience. While they are not
  fancy-looking, they obey all the established rules of good
  typesetting, which will make them easy to read and pleasant to look at.

  However, there are situations where \LaTeX{} does not provide a
  command or environment that matches your needs, or the output
  produced by some existing command may not meet your requirements.

  In this chapter, I will try to give some hints on
  how to teach \LaTeX{} new tricks and how to make it produce output
  that looks different from what is provided by default.
\end{intro}

\section{New Commands, Environments and Packages}

At the beginning of this book we have mentioned that \LaTeX{} allows us to
write documents using logical markup, with commands like \csi{emph} or \csi{section}. There
may be however situations where \LaTeX{} does not provide an appropriate command for the content you want to write about.
You may have noticed that all the
commands I introduce in this book are typeset in a box, and that they show up
in the index at the end of the book. There is no \LaTeX{} markup to format example code or commands, but \LaTeX{} allows me to define my own commands for this purpose. I
can write:

\begin{example}
\begin{lscommand}
  \csi{dum}
\end{lscommand}
\end{example}

In this example, I am using both a new environment called
\ei{lscommand}, which is responsible for drawing the box around the
command, and a new command named \csi{csi}, which typesets the command
name and makes a corresponding entry in the index. Check
this out by looking up the \csi{dum} command in the index at the back
of this book, where you'll find an entry for \csi{dum}, pointing to
every page where I mentioned the \csi{dum} command.

If I ever decide that I do not like having the commands typeset in
a box any more, I can simply change the definition of the
\ei{lscommand} environment to create a new look. This is much
easier than going through the whole document to hunt down all the
places where I have used some generic \LaTeX{} commands to draw a
box around some word.

\subsection{New Commands}\label{sec:new_commands}

You have already learned some basic command creation in
\autoref{sec:simple_commands}. The main command is the
\begin{lscommand}
  \csi{NewDocumentCommand}[name:M, argspec:m, definition:m]
\end{lscommand}
It requires three arguments: the \carg{name} of the command you want to create,
the \carg{argspec} (argument specification) and the \emph{definition} of the
command.

The \carg{argspec} argument specifies the number and types of arguments the
command receives. The two most important types are \cargv{m}, for
\emph{mandatory} and \cargv{o} for \emph{optional}. To create a command that
takes two optional arguments, then two mandatory, then again one optional and
finally three mandatory you would write \cargv{oommommm}. If the \carg{argspec}
argument is empty then the command will take no arguments, as you have already
seen.

This example defines a new command called \csi{tnss}. This is
short for \enquote{The Not So Short Introduction to \LaTeX}. Such a command
could come in handy if you had to write the title of this book over
and over again.

\begin{example}
\NewDocumentCommand{\tnss}{}{%
  The not so Short Introduction
    to \LaTeX}
This is \enquote{\tnss} \ldots{}
\enquote{\tnss}
\end{example}

The next example illustrates how to define a new command that takes two
arguments. In order to refer to the received arguments you use
\mintinline{latex}|#1| for the first argument, \mintinline{latex}|#2| for the
second, and so on.

\begin{example}
\NewDocumentCommand{\txsit}{mm}
 {This is the \emph{#1}
  #2 Introduction to \LaTeX}

% in the document body:
\txsit{not so}{short}

\txsit{very}{long}
\end{example}

If your command accepts an optional argument, but the user does not supply one,
a special marker \cargv{-NoValue-} will be inserted instead.
\begin{example}
\NewDocumentCommand{\txsit}{om}
{This is the \emph{#1}
  #2 Introduction to \LaTeX}

% in the document body:
\txsit{definitive}

\txsit[very]{long}
\end{example}
In order to test whether the user supplied a value, use
\begin{lscommand}
  \csi{IfValueTF}[argument:m, value version:m, no value version:m]
\end{lscommand}
macro.
\begin{example}
\NewDocumentCommand{\MyCommand}{o}{
  \IfValueTF {#1} {
    Optional argument: #1.
  } {
    No optional argument given.
  }%
}

\MyCommand\\
\MyCommand[hello]
\end{example}

There are two variations of it: \csi{IfValueT} and \csi{IfValueF} which may
be used if you only need output for one of the branches. The example with
\cargv{-NoValue-} in the output could be fixed by writing
\begin{example}
\NewDocumentCommand{\txsit}{om}
{This is the
  \IfValueT{#1}{\emph{#1} }%
  #2 Introduction to \LaTeX}

% in the document body:
\txsit{definitive}

\txsit[very]{long}
\end{example}
The commands \csi{IfNoValueTF}, \csi{IfNoValueT} and \csi{IfNoValueF}
work exactly the same, but the value\slash{}no-value branches are swapped.

Often you will want to use optional arguments when present but use some default
values when the user does not provide them. This could be achieved by
\csi{IfValueTF}, but with the \cargv{O} argument a default value can be set directly.
It works like \cargv{o} but allows setting a default
if no value is supplied. Write

\begin{example}
\NewDocumentCommand{\txsit}{O{not so}m}
{This is the \emph{#1}
  #2 Introduction to \LaTeX}

% in the document body:
\txsit{definitive}

\txsit[very]{long}
\end{example}

Another useful argument specification is \cargv{s}, short for star. This
argument allows providing different definitions based on whether the
starred or non-starred version of command was issued by the user. It uses
\csi{IfBooleanTF} command (and its variations\csih{IfBooleanT}\csih{IfBooleanF})
that works like the \csi{IfValueTF} command.

\begin{chktexignore}
  \begin{example}
\NewDocumentCommand{\txsit}{sO{not so}m}
{This is the \emph{#2}
  #3 Introduction to \LaTeX%
  \IfBooleanT{#1}{%
    : Superstar Edition%
  }%
}

% in the document body:
\txsit{long}\\
\txsit*{long}
\end{example}
\end{chktexignore}

These are just the most common argument specifications. For a full description,
take a look at the~\cite{usrguide3}.

As we have discussed in \autoref{sec:simple_commands}, \LaTeX{} will not allow
you to create a new command that would overwrite an existing one, you can do so
using \csi{RenewDocumentCommand}. It uses the same argument specification
syntax as the \csi{NewDocumentCommand} command.

In some cases you might want to use the \csi{ProvideDocumentCommand} command.
It works like \csi{NewDocumentCommand}, but if the command is already defined,
\LaTeX{} will silently ignore the new definition. Yet another variant is the
\csi{DeclareDocumentCommand}. It always creates the given command, overwriting
old definition if it exists.

\subsection{New Environments}
The \csi{NewDocumentEnvironment} command lets you create your own environments. It has the
following syntax:

\begin{lscommand}
  \small
  \csi{NewDocumentEnvironment}[name:m, argspec:m, at begin:m, at end:m]
\end{lscommand}
The \carg{argspec} argument is the same as in the
\csi{NewDocumentCommand} command. The contents of \carg{at begin} and \carg{at
  end} arguments will be inserted respectively when the commands
\csi{begin}[name: m] and \csi{end}[name: m] is encountered. The example
presented in \autoref{lst:kingenv} illustrates the usage of this command.
\begin{listing}
  \begin{example}
\NewDocumentEnvironment{king}{}{%
  \emph{Listen! For the
    king made a statement:}%
  \\[1em]%
} {%
  \\[1em]%
  \emph{This concludes
    the king's statement.}%
}

\begin{king}
My humble subjects \ldots
\end{king}
\end{example}
  \caption{An example of using \csi{NewDocumentEnvironment}
    command.}\label{lst:kingenv}
\end{listing}

Note that when environment argument are read, they are read \emph{after} the
\csi{begin}[name: m] command. This may be especially counterintuitive when we
consider the \cargv{s} specification. \autoref{lst:kingsenv} illustrates this.
\begin{listing}
  \begin{example}
\NewDocumentEnvironment{king}{s}{%
  \IfBooleanTF{#1}{
    \begin{center}
      \emph{Thus spoke Charles I:}
      \\[1em]%
    \end{center}%
  } {
    \emph{Listen! For the
      king made a statement:}%
      \\[1em]%
  }%
} {%
  \\[1em]%
  \emph{This concludes
    the king's statement.}%
}

\begin{king}*
My humble subjects \ldots
\end{king}
\end{example}
  \caption{An example of using the \cargv{s} specifier when defining a new
    environment.}\label{lst:kingsenv}
\end{listing}
If you want to create a starred version of an environment (similar to the
\hologo{AmSLaTeX} environments) you have to define it separately.
\begin{minted}{latex}
\NewDocumentEnvironment{king}{moo} { ... } { ... }
\NewDocumentEnvironment{king*}{moo} { ... } { ... }
\end{minted}
Obviously you can use the same internal commands to define them, for example
renaming the previous implementation to \cargv{kinginternal} making the
\cargv{king} and \cargv{king*} a thin wrapper around it.

The \csi{NewDocumentEnvironment} also introduces a special argument
specification: \cargv{+b}, short for body.\footnote{The \cargv{+} indicates
  that it may contain multiple paragraphs.} It is only allowed as the last
argument in the \carg{argspec}. It allows you to receive the body of the
environment as an argument.
\begin{example}
\NewDocumentEnvironment{twice}{+b} {%
  First time:\\ #1

  Second time:\\ #1
} {}

\begin{twice}
This will be printed twice!
\end{twice}
\end{example}
While this makes one of the \carg{at begin}, \carg{at end} arguments redundant,
they are still required. (In the example above we provided an empty \carg{at
  end}.)

Do not overuse \cargv{+b} as this will both add limitations to the environments
like \csi{verb} not being allowed inside and it will slow down the
typesetting.

Similar to the \csi{NewDocumentCommand}, \LaTeX{} makes sure that you do not
define an environment that already exists. If you ever want to change an
existing environment, use the \csi{RenewDocumentEnvironment} command. Its
arguments are the same as the \csi{NewDocumentEnvironment} command.

\subsection{Copying commands}\label{sec:copyingcommands}

When redefining commands you may want to use the original version of the
command. Your initial code may look like this
\begin{minted}{latex}
\RenewDocumentCommand{\emph}{m}{%
  \emph{#1}~(\enquote{#1} is emphasised)%
}
\end{minted}
but when you try to compile the document you will get the error message
\begin{verbatim}
! TeX capacity exceeded, sorry [input stack size=5000].
\end{verbatim}

To understand why this happens it is instructive to consider how \TeX{} expands
the defined commands. The above \csi{RenewDocumentCommand} tells the \TeX{}
engine that whenever \csi{emph}[foo:vm] is seen it must replace it with
\mintinline{latex}|\emph{foo}~(\enquote{foo} is emphasised)|. You may already see the
problem here. In the next stage it will again replace the \csi{emph}[foo:vm]
yielding
\begin{minted}[breaklines]{latex}
\emph{foo}~(\enquote{foo} is emphasised)~(\enquote{foo} is emphasised)
\end{minted}
This process will never end and at some point \TeX{}
simply gives up.

Note that
\begin{minted}{latex}
\NewDocumentCommand{\oldemph}{m}{\emph{#1}}
\RenewDocumentCommand{\emph}{m}{%
  \oldemph{#1}~(\enquote{#1} is emphasised)%
}
\end{minted}
will suffer the same fate since \mintinline{latex}|\oldemph{...}| %chktex 11 
will  be replaced by \TeX{} with \mintinline{latex}|\emph{...}| and %chktex 11
the  cycle repeats.

In order to avoid this problem a special command exists
\begin{lscommand}
  \csi{NewCommandCopy}[name:M, command:M]
\end{lscommand}
It makes the \carg{name} the exact copy of the \carg{command}. The following example shows how this works
\begin{example}[examplewidth=0.35\linewidth]
\NewDocumentCommand{\foo}{}{Batman!}

\NewDocumentCommand{\newfoo}{}{\foo}
\NewCommandCopy{\copiedfoo}{\foo}

\RenewDocumentCommand{\foo}{}{Na Na Na}

\foo{} \newfoo{} \copiedfoo{}
\end{example}

This is precisely the behaviour we need in order to redefine the \csi{emph}
command as we have tried to do earlier.
\begin{example}[examplewidth=0.35\linewidth]
\NewCommandCopy{\oldemph}{\emph}
\RenewDocumentCommand{\emph}{m}{%
  \oldemph{#1}~(\enquote{#1}
  is emphasised)%
}

And here it \emph{comes}.
\end{example}

\subsection{Command-line \LaTeX}

If you work on a Unix-like OS, you might be using Makefiles to build your
\LaTeX{} projects. In that connection it might be interesting to produce
different versions of the same document by calling \LaTeX{} with command-line
parameters. If you add the following structure to your document:

\begin{minted}{latex}
\IfBooleanTF{\blackandwhite} {
  % "black and white" mode; do something...
} {
  % "color" mode; do something different...
}
\end{minted}

Now compile document like this:
\begin{verbatim}
xelatex '\NewCommandCopy{\blackandwhite}{\BooleanTrue}
    \input{test.tex}'
\end{verbatim}
First the command \verb|\blackandwhite| is defined as the \csi{BooleanTrue} macro which
holds a special value used in \csi{IfBooleanTF} checks. Then the actual file is
read with input. By setting \verb|\blackandwhite| to \csi{BooleanFalse} the
colour version of the document would be produced.

\subsection{Your Own Package}

If you define a lot of new environments and commands, the preamble of
your document will get quite long. In this situation, it is a good
idea to create a \LaTeX{} package containing all your command and
environment definitions. Use the \csi{usepackage}
command to make the package available in your document.

\begin{listing}
  \begin{lined}{\textwidth}
    \begin{minted}{latex}
\ProvidesExplPackage{demopack}{2022-05-05}{0.1}{%
  Package by Tobias Oetiker
}

\NewDocumentCommand{\tnss}{} {
  The~not~so~Short~Introduction~to~\LaTeX
}
\NewDocumentCommand{\txsit}{O{not~so}} {
  The~\emph{#1}~Short~Introduction~to~\LaTeX
}

\NewDocumentEnvironment{king}{} {
  \begin{quote}
} {
  \end{quote}
}
\end{minted}
  \end{lined}
  \caption{Example Package.}\label{package}
\end{listing}

Writing a package basically consists of copying the contents of your document
preamble (with minor adjustments) into a separate file with a name ending in
\texttt{.sty}. There is one special command,
\begin{lscommand}
  \csi{ProvidesExplPackage}[name:m, date:m, version:m, description:m]
\end{lscommand}
for use at the very beginning of your package file. This command tells the
\LaTeX{} to process the  file in \emph{expl mode}. The most visible effect of
this is that all whitespace is ignored. You may have noticed that in many of
the examples above we had to end most lines with \ai{\%} to get correct spacing
in the output. In \emph{expl mode}, spaces have to be added explicitly if
needed at all. They are usually quite rare when writing a package. To insert
spaces, use the \ai{\~} character, which normally denotes non-breaking
space.\footnote{If you want to insert non-breaking space in \emph{expl mode},
  use \csi{nobreakspace}.} Paragraphs can be started with the \csi{par} command.

The arguments are used to provide information about package in the log file. If
you use this package and look at the log file you will find
\begin{verbatim}
Package: demopack 2022-05-05 v0.1 Package by Tobias Oetiker
\end{verbatim}
in the \eei{.log} file.

\csi{ProvidesExplPackage} will also issue a sensible error message when you try
to include a package twice. \autoref{package} shows a small example package
that contains the commands defined in the examples above.

\section{Fonts and Sizes}\label{sec:fontsize}

\subsection{Font Changing Commands}\index{font}\index{font size}

\LaTeX{} fonts are influenced by four parameters
\begin{description}
  \item[family] The collection of fonts. For example, \enquote*{Latin Modern
      Roman} or \enquote*{Source Code Pro}.
  \item[series] The weight of the font. For example, \enquote*{bold} or
    \enquote*{medium}.
  \item[shape] The shape of glyphs within a font family. For example,
    \enquote*{small caps} or \enquote*{italics}.
  \item[size] The size of the glyphs. For example, \enquote*{\qty{10}{pt}} or
    \enquote*{\qty{12}{pt}}.
\end{description}
\LaTeX{} automatically chooses the appropriate font family, series, shape and
size based on the logical structure of the document (sections, footnotes,
emphasis, \ldots). It is possible however to instruct \LaTeX{} manually which
font to use. It is important to note that not every combination of
family\slash{}series\slash{}shape exists as an actual font. \LaTeX{} will
complain if you try for something that does not exist.

\LaTeX{} predefines three font families to use throughout the document: the
upright or roman family accessible via \csi{textrm}, the \textsf{sans serif
  family} accessible via \csi{textsf} and monospace or typewriter family
accessible via \csi{texttt}.
\begin{example}
\textrm{Roman is the default
  in articles.} \\
\textsf{Sans serif is used in
  presentations.} \\
\texttt{Monospace is used in
  verbatim code blocks.}
\end{example}

There are only two predefined \LaTeX{} series: medium (\csi{textmd}) and bold
(\csi{textbf}).
\begin{example}
\textmd{The default.} \\
\textbf{Bold font.}
\end{example}

Shapes are a bit more complicated. The three basic shapes are: italics
(\csi{textit}), oblique or slanted\footnote{Oblique shape differs from the
  italics in that italic shape uses different glyphs while oblique shape uses
  the same glyphs but slanted. The difference is really obvious
  \fontspec{cmunui.otf} when you look at the unslanted italic
  font.} (\csi{textsl}) and small capitals (\csi{textsc}).
\begin{example}
\textit{Italic shape.} \\
\textsl{Slanted shape.} \\
\textsc{Small Capitals.}
\end{example}
However there are two additional shapes that are not provided by default
\LaTeX{} fonts: swash (\csi{textsw}), for decorative fonts and spaced caps and
small caps (\csi{textssc}). These are rarely used but may come in handy when
using custom fonts as described in \autoref{sec:fontspec}.
\begin{example}
\setmainfont{EB Garamond} %!hide
Question vs. \textsw{Question}
\end{example}
In addition two virtual shapes are provided: upright (\csi{textup}) and
upper-lowercase (\csi{textulc}). These are not actually shapes but utility
commands. The former one switches back to upright font while the latter
disables small capitals. The command \csi{textnormal} is just the combination
of the two.
\begin{example}
\textsl{\textsc{Back to
  \textup{upright.}}} \\
\textsl{\textsc{Back to
  \textulc{lowercase.}}} \\
\textsl{\textsc{Back to
  \textnormal{normal.}}}
\end{example}

All of the commands described above also exist in their switch version. Instead
of receiving the text via argument, they change the font permanently until it is
changed again. For example, the switch version of \csi{textit} and \csi{textrm}
are \csi{itshape} and \csi{rmfamily}, respectively. While the argument versions
are useful for defining commands, switch versions are especially useful when
defining your own environments.
\begin{example}
Only \textit{argument} is
affected. After \itshape
everything is in italics
until \upshape is encountered.
\end{example}
Both argument and switch versions of the described commands are presented in
\autoref{tbl:fonts}.
\begin{table}
  \caption{Default font changing commands of \LaTeX.}\label{tbl:fonts}
  \begin{tabular}{@{}lll@{}}
    \toprule
    Argument Command         & Switch           & Example                      \\
    \midrule
    \csi{textrm}[text:m]     & \csi{rmfamily}   & \textrm{\wi{roman}}          \\
    \csi{textsf}[text:m]     & \csi{sffamily}   & \textsf{\wi{sans serif}}     \\
    \csi{texttt}[text:m]     & \csi{ttfamily}   & \texttt{typewriter}          \\[6pt]
    \csi{textmd}[text:m]     & \csi{mdseries}   & \textmd{medium}              \\
    \csi{textbf}[text:m]     & \csi{bfseries}   & \textbf{\wi{bold face}}      \\[6pt]
    \csi{textup}[text:m]     & \csi{upshape}    & \textup{\wi{upright}}        \\
    \csi{textit}[text:m]     & \csi{itshape}    & \textit{\wi{italic}}         \\
    \csi{textsl}[text:m]     & \csi{slshape}    & \textsl{\wi{slanted}}        \\
    \csi{textsc}[text:m]     & \csi{scshape}    & \textsc{\wi{Small Caps}}     \\
    \csi{textsw}[text:m]     & \csi{swshape}    & \textsw{\wi{Queen of Swash}} \\[6pt]
    \csi{textnormal}[text:m] & \csi{normalfont} & \textnormal{document} font   \\
    \bottomrule
  \end{tabular}
\end{table}

When working with switch versions of fonts that are slanted right it is
important to remember about \wi{italic correction}. This is a small space after
the end of right slanting text that is sometimes necessary to avoid overlapping
letters. It is inserted using \csi{/} command.
\begin{chktexignore}  
\begin{example}
Without: {\itshape oof}bar \\
With: {\itshape oof\/}bar
\end{example}
\end{chktexignore}
The italic correction is handled automatically by the argument versions of the
commands.

In contrast to the previous font changing commands, the size of font can only
be controlled via switch versions. \LaTeX{} predefines some switches for
changing font size, see \autoref{sizes} and \autoref{tab:pointsizes} for their
description.
\begin{table}
  \caption{Commands changing font size.}\label{sizes}\index{font size}
  \begin{tabular}{@{}ll@{\qquad}ll@{}}
    \toprule
    Command                     & Size                             &
    Command                     & Size                               \\
    \midrule
    \csi{tiny}                  & \tiny tiny                       &
    \csi{Large}                 & \Large larger                      \\
    \csi{scriptsize}            & \scriptsize very small           &
    \csi{LARGE}                 & \LARGE very large                  \\
    \csi{footnotesize}          & \footnotesize  quite small       &
    \multirow{2}{*}{\csi{huge}} & \multirow{2}{*}{\huge huge}        \\
    \csi{small}                 & \small small                     &
                                &                                    \\
    \csi{normalsize}            & \normalsize  normal              &
    \multirow{2}{*}{\csi{Huge}} & \multirow{2.2}{*}{\Huge largest}   \\
    \csi{large}                 & \large large                     &
                                &                                    \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{table}
  \caption[Absolute point sizes in standard classes.]{Absolute point sizes in
    standard classes depending on the class option. The default class option is
    \cargv{10pt}.}\label{tab:pointsizes}\label{tab:sizes}
  \sisetup{table-format=2.2}
  \begin{tabular}{@{}lSSS@{}}
    \toprule
                       & \multicolumn{3}{c}{Size (\unit{pt})}                                   \\
    \cmidrule(l){2-4}
    Command            & {\cargv{10pt}}                       & {\cargv{11pt}} & {\cargv{12pt}} \\
    \midrule
    \csi{tiny}         & 5                                    & 6              & 6              \\
    \csi{scriptsize}   & 7                                    & 8              & 8              \\
    \csi{footnotesize} & 8                                    & 9              & 10             \\
    \csi{small}        & 9                                    & 10             & 10.95          \\
    \csi{normalsize}   & 10                                   & 10.95          & 12             \\
    \csi{large}        & 12                                   & 12             & 14.4           \\
    \csi{Large}        & 14.4                                 & 14.4           & 17.28          \\
    \csi{LARGE}        & 17.28                                & 17.28          & 20.74          \\
    \csi{huge}         & 20.74                                & 20.74          & 24.88          \\
    \csi{Huge}         & 24.88                                & 24.88          & 24.88          \\
    \bottomrule
  \end{tabular}
\end{table}

When using these commands it is important to remember that the
line spacing is only updated after the paragraph ends. To avoid putting empty
lines before the closing curly brace you may use the \csi{par} command.
\begin{example}
{\Large Here the line spacing
  is not updated. A bit tight!}

{\Large Much better! I can
  breathe freely again!\par}
\end{example}

An arbitrary font size can be specified using the
\begin{lscommand}
  \csi{fontsize}[size: m, line skip: m]\csi{selectfont}
\end{lscommand}
command combo. The \carg{line skip} determines the height of the text line and
should be usually around \(1.2\) times larger than the \carg{size}.
\begin{example}[vertical_mode, examplewidth=0.7\linewidth]
\fontsize{2cm}{2.4cm}\selectfont A big one!
\end{example}

Fun fact: \LaTeX{} default font is a bit unusual in that it looks slightly
different depending on its size. The difference is presented in the table below
where the text written using different sizes was rescaled to the same height.
\begin{center}
  \begin{tabular}{@{}lll@{}}
    \toprule
    \csi{tiny}                           &
    \csi{normalsize}                     &
    \csi{Huge}                             \\
    \midrule
    \resizebox{!}{2em}{\tiny Text}       &
    \resizebox{!}{2em}{\normalsize Text} &
    \resizebox{!}{2em}{\Huge Text}         \\
    \bottomrule
  \end{tabular}
\end{center}

If you need to access even more font variants and shapes\footnote{For example
  the aforementioned \fontspec{cmunui.otf} upright italic shape.} check out
\citetitle{fntguide}~\cite{fntguide}.

\subsection{Danger, Will Robinson, Danger}

Note! Using explicit font setting commands defies the basic idea of
\LaTeX{} described in \autoref{sec:logical_structure}, which is to separate the
logical and visual markup. The fonts should get switched automatically
according to the requirements of the context. A simple rule of thumb: If you
use the same font changing command in several places in order to typeset a
special kind of information, you should use \csi{NewDocumentCommand} to define
a \enquote{logical wrapper command} for the font changing command.

\begin{example}
\NewDocumentCommand{\oops}{m}{%
 \textbf{#1}}
Do not \oops{enter} this room,
it's occupied by \oops{machines}
of unknown origin and purpose.
\end{example}

This approach has the advantage that you can decide at some later
stage that you want to use a visual representation of danger other
than \csi{textbf}, without having to wade through your document,
identifying all the occurrences of \csi{textbf} and then figuring out
for each one whether it was used for pointing out danger or for some other
reason.

\subsection{Advice}

To conclude this journey into the land of fonts and font sizes,
here is a little word of advice:\nopagebreak

\begin{quote}
  \underline{\textbf{Reme\(\mathfrak{mber}\)\Huge!}} \textit{The}
  \textsf{M\textbf{\LARGE O} \(\mathcal{R}\)\textsl{E}} fonts \Huge you
  \tiny use \footnotesize \textbf{in} a \small \texttt{document},
  \large \textit{the} \normalsize more \textsc{readable} and
  \textsl{\textsf{beautiful} it bec\large o\Large m\LARGE e\huge s}.
\end{quote}

\section{Custom Fonts with \pai{fontspec}}\label{sec:fontspec}

In the following examples we use Adobe Source fonts~\cites{sourceserif,
  sourcesans, sourcecodepro}. These fonts are included with \TeXLive{} \LaTeX{}
distributions and should be available in the directory
\begin{code}
  \nolinkurl{.../texmf-dist/fonts/opentype/adobe}
\end{code}
where the \cargv{...} denotes the install-path of \TeXLive{}.
\hologo{LuaTeX} checks this directory automatically, so it should work fine,
but if you are using \hologo{XeTeX} you must first install these fonts in your
system. You can also download and install them manually from the links provided
in the bibliography. Alternatively swap out their respective names with some other
fonts installed in your system.

Many free OpenType fonts are available at \url{https://fontlibrary.org/}.

\subsection{Main Document Fonts}

If you are not pleased with the default Latin Modern font, you can change it to
any font installed in your system using the \pai*{fontspec} package. It provides
three main commands for changing document fonts:
\begin{lscommand}
  \csi{setmainfont}[options: o, font: m] \\
  \csi{setsansfont}[options: o, font: m] \\
  \csi{setmonofont}[options: o, font: m]
\end{lscommand}
This commands change, respectively, the main font of the document, \textsf{the
  sans serif font used in the document} and \texttt{the monospace font in the
  document}.
\begin{example}
Normal text.
  \emph{Emphasised.} \\
\textsf{Sans serif text.
  \emph{Emphasised}.} \\
\texttt{Monospace text.
  \emph{Emphasised}.} \\

\setmainfont{Source Serif Pro}
\setsansfont{Source Sans Pro}
\setmonofont{Source Code Pro}
Normal text.
  \emph{Emphasised.} \\
\textsf{Sans serif text.
  \emph{Emphasised}.} \\
\texttt{Monospace text.
  \emph{Emphasised}.}
\end{example}
Note that it is best to put these commands in the preamble of your document,
because some fonts are frozen when the body starts.

The optional \carg{options} argument accepts key value lists that allow to
customise the font features. For example, many fonts contain,
old style numerals that are not used by default. You can pass
\cargv{Number=OldStyle} if you want to use them in your document.
\begin{example}
\setmainfont{Source Serif Pro}
0123456789

\setmainfont[
  Numbers=OldStyle,
]{Source Serif Pro}
0123456789
\end{example}

Some fonts also provide special glyphs for a given language. For example the
Latin Modern Font provides a special
\enquote{\setmainfont[Language=Polish]{Latin Modern Roman}fk} ligature for the
Polish language. You can set the \cargv{Language} key to a given language to
enable these features.
\begin{example}
agrafka

\setmainfont[
  Language=Polish,
]{Latin Modern Roman}
agrafka
\end{example}
The \pai{polyglossia} package activates these features automatically so you
don't have to worry about them if you use it.

If your font supports it you may wish to enable automatic fractions insertion
with \cargv{Fractions=On} key.
\begin{example}
1/2 3/4 123/456

\setmainfont[
  Fractions=On,
]{Latin Modern Roman}
1/2 3/4 123/456

\setmainfont[
  Fractions=On,
]{Source Serif Pro}
1/2 3/4 123/456
\end{example}

The OpenType font format defines a lot of more font features, that may or may not
be supported by your font of choice. Consult with the \pai*{fontspec} package
documentation for a comprehensive description and examples.

\subsection{Specifying Fonts via Filenames}\label{ssec:fonts_filename}

If you do not want to install fonts in your system or you are working on a
collaborative project where not everybody has the necessary fonts installed on their system,
you can add font files to your project and specify the fonts directly via their filenames.
In this case you must specify
font variations manually. Because the filenames are usually very similar, it is
possible to enter them using \cargv{*} patterns, where \cargv{*} is replaced by
the main name defined. Extension may also be passed via the \cargv{Extension}
key to avoid repetition. See \autoref{lst:fontloading} for a comparison of font
loading techniques. If the font files are not present in the same directory as
the document you may have to specify it directly using the \cargv{Path} key.
\begin{listing}
  \begin{example}[vertical_mode, examplewidth=0.8\linewidth]
\setmainfont{Source Serif Pro}
Normal text. \textit{Italics.} \textbf{Bold.}
\textit{\textbf{Bold italics.}} \\

\setmainfont{SourceSerifPro-Regular.otf}
Normal text. \textit{Italics.} \textbf{Bold.}
\textit{\textbf{Bold italics.}} \\
 
\setmainfont[
  ItalicFont=SourceSerifPro-RegularIt.otf,
  BoldFont=SourceSerifPro-Bold.otf,
  BoldItalicFont=SourceSerifPro-BoldIt.otf,
]{SourceSerifPro-Regular.otf}
Normal text. \textit{Italics.} \textbf{Bold.}
\textit{\textbf{Bold italics.}} \\

\setmainfont[
  Extension=.otf,
  UprightFont=*-Regular,
  ItalicFont=*-RegularIt,
  BoldFont=*-Bold,
  BoldItalicFont=*-BoldIt,
]{SourceSerifPro}
Normal text. \textit{Italics.} \textbf{Bold.}
\textit{\textbf{Bold italics.}}
\end{example}
  \caption{Comparison of font loading with the \pai{fontspec}
    package.}\label{lst:fontloading}
\end{listing}

The default \LaTeX{} fonts are rather atypical in that they distinguish between
\textit{italics} and \textsl{slanted} font. Most fonts do not do this, so
\pai{fontspec} defines slanted font to be the same as italics. This may be
fixed by setting the \cargv{SlantedFont} key explicitly.
\begin{example}[vertical_mode, examplewidth=0.7\linewidth]
\setmainfont{Latin Modern Roman}
\textit{italics} vs. \textsl{slanted}

\setmainfont[
  SlantedFont=Latin Modern Roman Slanted,
]{Latin Modern Roman}
\textit{italics} vs. \textsl{slanted}
\end{example}

\subsection{Defining New Fonts}

So far we have only talked about changing the fonts for the whole document. It
is possible however to define new fonts that are used only sporadically
throughout the document, for emphasis or decorative purposes. It is possible to
do so using the
\begin{lscommand}
  \csi{newfontfamily}[command: M, options: o, font: m]
\end{lscommand}
It defines new \carg{command} that works like to the \csi{rmfamily} or
\csi{sffamily} commands.
\begin{example}
\newfontfamily{\sourcefamily}[
  Numbers=OldStyle,
]{Source Serif Pro}

Normal text when suddenly
\ldots{} \sourcefamily
a different font! 0123456789
\end{example}
This is especially useful when working with multiple languages as you have
already seen in \autoref{sec:polyglossia}.

The \csi{newfontfamily} checks whether the font family is already defined and
raises an error if it is. As in \autoref{sec:new_commands} the
\csi{renewfontfamily} and \csi{providefontfamily} are available if you want to
redefine existing font families.

\subsection{Math Fonts}\label{sec:math_fonts}

The package \pai{unicode-math}, introduced in \autoref{chap:math}, uses
\pai{fontspec} under the hood and already enables you to use any OpenType math
font within your document. The main command to do so is called
\csi{setmathfont}. It accepts either a font name or a filename. In contrast to
the text fonts that often consist of multiple files, math fonts typically
consist of a single file, thus specifying it via a filename is not as
complicated as presented in \autoref{ssec:fonts_filename}.
\begin{code}
  \begin{minted}{latex}
\setmathfont{STIX Two Math}
  \end{minted}
\end{code}
is equivalent to
\begin{code}
  \begin{minted}{latex}
\setmathfont{STIXTwoMath-Regular.otf}
  \end{minted}
\end{code}
and the latter works in both \hologo{LuaLaTeX} and \hologo{XeLaTeX}. While
changing math fonts throughout the document is possible, it may lead to some
problems; prefer to set them in the preamble for the whole document.
\begin{example}
\setoperatorfont\symrm%!hide
\setmainfont{Garamond Libre}
\setmathfont{Garamond Math}
Now we are using Garamond fonts.
\[
  \symrm{e}^{\symrm{\pi}
    \symrm{i}} + 1 = 0 \quad
  \sum_{i=0}^\infty \iint_a^b
  \lim_{h\to0}\frac{\sqrt[3]{
    \symbb{A}}}{2^h}\,\symrm{d}x
\]
\setmathfont{Latin Modern Math} %!hide
\end{example}

Not all math fonts have the same character coverage. For example, the default
font doesn't have lowercase script letters. If you don't want to switch the
fonts entirely but just use some characters from a different font, you
can use the \cargv{range} key in the options to the \csi{setmathfont} command.
\begin{example}
\(xyz = \symscr{Hello}\) vs.\
\setmathfont[
  range=scr,
]{STIX Two Math}
\(xyz = \symscr{Hello}\)
\setmathfont{Latin Modern Math} %!hide
\end{example}
You can also set it to exact Unicode ranges if you need more control over
replaced symbols.

Some fonts define two types of script font \emph{roundhand} and \emph{chancery}. These are
normally available as the first stylistic set feature of the font. You can map
\csi{symcal} which is normally a synonym for \csi{symscr}, to produce the
alternative script letters.
\begin{example}
\setmathfont{STIX Two Math}
\setmathfont[
  range={cal, bfcal},
  StylisticSet=1,
]{STIX Two Math}

\(\symscr{ABCDabcd}\) vs.\
\(\symcal{ABCDabcd}\) 
\setmathfont{Latin Modern Math} %!hide
\end{example}

The default behaviour of the \csi{not} command, is to combine the negating glyph
with the following symbol. This usually produces satisfactory results. If the
font defines a dedicated negated symbol it is probably better to use it in such
situations. The \csi{not} command is able to use a predefined mapping to use
such glyphs based on the negated symbol. If the default mapping does not
contain the combination, or if you prefer to use a different negation you can
create a new mapping by using \csi{NewNegationCommand}.
\begin{example}
\(\not\cong\) vs.\
\NewNegationCommand{%
    \cong}{\simneqq}%
\(\not\cong\)
\end{example}

\section{Colours}\label{sec:colors}\index{colours}

\subsection{Coloured Text}
In the \autoref{sec:logical_structure} we have used different text colours to
illustrate an example. These can be obtained with the \pai*{xcolor} package. It
provides three commands to change the colour of text:
\begin{lscommand}
  \csi{color}[model: o, color: m] \\
  \csi{textcolor}[model: o, color: m, text: m]
  \csi{mathcolor}[model: o, color: m, text: m]
\end{lscommand}
The \csi{color} is a switch version while \csi{textcolor} and \csi{mathcolor}
only apply to their argument. If no \carg{model} is specified, then
\carg{color} is specified as colour expression. The simplest colour expression
is just the name of the colour, for example \cargv{yellow} or \cargv{red}.
\begin{example}
\textcolor{yellow}{foo} \\
\color{red} baz
\[
  \mathcolor{blue}{
    \sum_{k=0}
  }^{10} i
\]
\end{example}
The list of predefined colours can be found in \autoref{tbl:basecolors}. You can
also pass \cargv{dvipsnames}, \cargv{svgnames} or \cargv{x11names} as a package
options to extend the predefined colours. Consult the package documentation for
a full list.
\begin{table}
  \ExplSyntaxOn
  \NewDocumentCommand{\DemoColor}{m}{
    \raisebox{0.15cm}{\cargv{#1}} &
    \fcolorbox{black}{#1}{\phantom{\rule{0.5cm}{0.5cm}}}
  }
  \ExplSyntaxOff
  \caption{Basic colours predefined by the \pai{xcolor}
    package.}\label{tbl:basecolors}
  \begin{tabular}{@{}lc*2{@{\qquad}lc}@{}}
    \toprule
    Name                 & Demo                  &
    Name                 & Demo                  &
    Name                 & Demo                                       \\
    \midrule
    \DemoColor{black}    & \DemoColor{lightgray} & \DemoColor{purple} \\
    \DemoColor{blue}     & \DemoColor{lime}      & \DemoColor{red}    \\
    \DemoColor{brown}    & \DemoColor{magenta}   & \DemoColor{teal}   \\
    \DemoColor{cyan}     & \DemoColor{olive}     & \DemoColor{violet} \\
    \DemoColor{darkgray} & \DemoColor{orange}    & \DemoColor{white}  \\
    \DemoColor{gray}     & \DemoColor{pink}      & \DemoColor{yellow} \\
    \DemoColor{green}    &                       &                    \\
    \bottomrule
  \end{tabular}
\end{table}

Another type of colour expression is a mix of two colours. The syntax is
\begin{code}
  \cargv{\carg{first color}!\carg{percentage}!\carg{second color}}.
\end{code}
The resulting colour will be the result of mixing
\qty[parse-numbers=false]{\carg{percentage}}{\percent} of the \carg{first
  color} and \qty[parse-numbers=false]{100-\carg{percentage}}{\percent} of the
\carg{second color}. If you omit the \carg{second color} it defaults to white.
\begin{example}
\textcolor{green!100!red}{C}%
\textcolor{green!80!red}{o}%
\textcolor{green!60!red}{l}%
\textcolor{green!40!red}{o}%
\textcolor{green!20!red}{r}%
\textcolor{green!0!red}{s} \\
\textcolor{blue!100}{B}%
\textcolor{blue!75}{l}%
\textcolor{blue!50}{u}%
\textcolor{blue!25}{e}
\end{example}
Colour mixing is left associative so
\begin{code}
  \cargv{\carg{A}!\carg{n}!\carg{B}!\carg{m}!\carg{C}}
\end{code}
means calculate the mixture of \carg{A} and \carg{B} and then mixture of the
result and \carg{C}. You can also use the minus sign before the expression to
get the complementary colour.
\begin{example}
\color{green!20!red!60!blue}
\LaTeX{} \\
\color{-green!20!red!60!blue}
\LaTeX{}
\end{example}

\subsection{Models}

While colour mixing via expression is useful for simple colour specification, it
is often the case that we want to use colour that is defined in terms of its RGB
or HSB values. Different input method colours can be specified using the optional
\carg{model} argument. Note that it is case-sensitive.

The simplest model is \cargv{Gray}. It accepts a single number from \(0\)to
\(15\) and produces a grey colour with the given brightness.
\begin{example}
\textcolor[Gray]{0}{Zero}    \\
\textcolor[Gray]{3}{Three}   \\
\textcolor[Gray]{7}{Seven}   \\
\textcolor[Gray]{11}{Eleven} \\
\textcolor[Gray]{15}{Fifteen}
\end{example}

You can input RGB values in three ways: \cargv{rgb}, \cargv{RGB} and
\cargv{HTML} models. The \cargv{HTML} model accepts a hexadecimal colour code.
The code may be either upper or lowercase.
\begin{example}
\textcolor[HTML]{e63946}{e63946}
\textcolor[HTML]{06D6A0}{06D6A0}
\end{example}
The \cargv{rgb} model accepts three decimal numbers, each between \(0\) and
\(1\), while the \cargv{RGB} model accepts three integers from \(0\) to \(255\).
\begin{example}
\textcolor[RGB]{255, 204, 102}{
  255, 204, 102
} \\
\textcolor[rgb]{0.4, 0.4, 1.0}{
  0.4, 0.4, 1.0
}
\end{example}

If you prefer the subtractive colour model, both \cargv{cmy} and \cargv{cmyk} are
available. They accept decimal numbers between \(0\) and \(1\) to specify
the amount of each colour.
\begin{example}
\textcolor[cmy]{0.7, 0.4, 0.3}{
  0.7, 0.4, 0.3
} \\
\textcolor[cmyk]{
  0.7, 0.4, 0.3, 0.5
}{
  0.7, 0.4, 0.3, 0.5
}
\end{example}

There are three models that enable defining colours by HSB\@: \cargv{hsb},
\cargv{Hsb} and \cargv{HSB}. The first two accept three decimal numbers for
each value, the difference being that the \cargv{Hsb} accepts hue as an angle
in degrees, that is a number between \(0\) and \(360\). The \cargv{hsb} accepts
it as a number between \(0\) and \(1\), while saturation and brightness
are passed the same way in both model---as a number between \(0\) and \(1\).
\begin{example}
\textcolor[hsb]{
  0.4, 0.8, 0.75
}{
  0.4, 0.8, 0.75
}\\
\textcolor[Hsb]{
  144, 0.8, 0.75
}{
  144, 0.8, 0.75
}
\end{example}
The \cargv{HSB} in turn accepts all three as integers---each between \(0\) and
\(240\).
\begin{example}
\textcolor[HSB]{
  144, 200, 120
}{
  144, 200, 120
}
\end{example}

If you are writing a paper about light you may also find that the \cargv{wave}
model comes in handy. It allows you to specify a colour by its wavelength. It
accepts a single decimal number that represents a wavelength in visible
spectrum in nanometres.
\begin{example}
\textcolor[wave]{452}{
  If a light has wavelength
  \qty{452}{\nm} it looks
  like this.  
} \\
\textcolor[wave]{700}{
  Light with wavelength above
  \qty{814}{\nm} is called
  infrared.
}
\end{example}

\subsection{Defining Your Own Colours}

If you want to use a given colour more than once it makes sense to define
it as a macro. While you could use the \csi{NewDocumentCommand} to define it,
the \pai{xcolor} package provides a better way via the
\begin{lscommand}
  \csi{definecolor}[name: m, model: m, value: m].
\end{lscommand}
command. Using it makes it possible to use the newly defined colour in colour
mixing and such.
\begin{example}
\definecolor{MyRed}{wave}{712}
\textcolor{MyRed}{MyRed is
  the perfect colour for you!}
\textcolor{MyRed!60}{Tints
  are also available!}
\end{example}
Be careful though, since it doesn't guard against redefinition. If you want to
check whether you haven't redefined some colour put \csi{tracingcolors} in your
preamble. This will produce warnings when redefinition happens.

If you want to make sure a colour is present but don't want to redefine it if it
already exists then \csi{providecolor} does exactly that. There is also
\csi{colorlet} that simply creates a copy of a given colour similar to the
\csi{NewCommandCopy} command.

Colours defined in different models may need to be converted when mixing them.
This may lead to a situation where \mintinline{latex}|\color{a!75!b}| will
result in different colour than \mintinline{latex}|\color{b!25!a}|. Keep that in
mind when mixing your own colours.

\subsection{Colourful Pages and Boxes}

So far we have only considered changing the text colour. It is however possible
to also change the background colour of the document page. To do this use the
\begin{lscommand}
  \csi{pagecolor}[model: o, color: m]
\end{lscommand}
command, which accepts the same arguments as the \csi{color} command. If you
want to revert to the default transparent background you may do so with the
\csi{nopagecolor} command.
\begin{example}[standalone, paperheight=1cm]
\usepackage{xcolor} %!hide
\begin{document} %!hide
\pagecolor{orange} \color{-orange}
Small is colourful \ldots?
\end{document} %!hide
\end{example}

If you only want to specify a background of some text instead of the whole page
you can use the
\begin{lscommand}
  \csi{colorbox}[model: o, color: m, text: m] \\
  \csi{fcolorbox}[model: o, color: m, model: o, color: m, text: m]
\end{lscommand}
commands. The first one only colours the background, while the second one
allows also drawing a frame (the \enquote*{f} stands for \enquote{framed}).
\begin{example}
It is \colorbox{gray}{curious}
how much a document can be
enhanced or ruined by
\fcolorbox{blue}{red}{
  colours.
}
\end{example}
Boxes are explored further in \autoref{sec:boxes}.

\section{Lengths and Spacing}

\subsection{\LaTeX{} Units}\index{units (\TeX)}\index{dimensions}%
\label{sec:dimensions}
\begingroup
\DeclareSIUnit{\in}{in}
\DeclareSIUnit{\pt}{pt}
\DeclareSIUnit{\bp}{bp}
\DeclareSIUnit{\sp}{sp}
\DeclareSIUnit{\dd}{dd}
\ExplSyntaxOn
\NewDocumentCommand{\DimVal}{m}{
  \num{\dim_to_decimal_in_sp:n {#1}}
}
\NewDocumentCommand{\fnum}{mm}{
  \num[
    number-mode=text,
    parse-numbers=false,
  ]{
    \sfrac{
      \num[number-mode=math,parse-numbers=true]{#1}
    }{
      \num[number-mode=math,parse-numbers=true]{#2}
    }
  }
}

\NewDocumentCommand{\fqty}{mmm}{
  \qty[
    number-mode=text,
    parse-numbers=false,
  ]{
    \sfrac{
      \num[number-mode=math,parse-numbers=true]{#1}
    }{
      \num[number-mode=math,parse-numbers=true]{#2}
    }
  }{#3}
}
\ExplSyntaxOff

Throughout this booklet we have often presented commands that accept length as
one of its parameters such as \csi{\bs} or \csi{fontsize}. When introducing
them we have used \unit{\cm} and \unit{\pt} which stand for centimetre and
point, but these are not the only units available in \LaTeX{}.

The most fundamental unit in \LaTeX{} is \unit{\sp} which stands for
\emph{scaled point}. Its width is equal to \fqty{1}{65536}{\pt}, where
\qty{1}{\pt} is equal to \fnum{1}{72.27} of an international inch which in turn
is defined as exactly \qty{25.4}{\mm}. All units in \TeX{} are ultimately
represented as a whole numbers of \unit{sp}. See \autoref{units} for the exact
values.
\begin{table}
  \caption{\TeX{} Units.}\label{units}\index{units}
  \begin{tabular}{@{}clrrl@{}}
    \toprule
    Unit                   & Meaning                                                                                                 & Definition            & {Value (\unit{\sp})} & Demo            \\
    \midrule
    \mintinline{latex}{cm} & centimetre                                                                                              & \qty{0.01}{\m}        & \DimVal{1cm}         & \demowidth{1cm} \\
    \mintinline{latex}{mm} & millimetre                                                                                              & \qty{0.001}{\m}       & \DimVal{1mm}         & \demowidth{1mm} \\
    \mintinline{latex}{in} & inch                                                                                                    & \qty{25.4}{\mm}       & \DimVal{1in}         & \demowidth{1in} \\
    \mintinline{latex}{pt} & point                                                                                                   & \fqty{1}{72.27}{\in}  & \DimVal{1pt}         & \demowidth{1pt} \\
    \mintinline{latex}{sp} & scaled point                                                                                            & \fqty{1}{65536}{\pt}  & \DimVal{1sp}         & \demowidth{1sp} \\
    \mintinline{latex}{pc} & pica                                                                                                    & \qty{12}{\pt}         & \DimVal{1pc}         & \demowidth{1pc} \\
    \mintinline{latex}{dd} & didot                                                                                                   & \qty{0.376065}{\mm}   & \DimVal{1dd}         & \demowidth{1dd} \\
    \mintinline{latex}{cc} & cicero                                                                                                  & \qty{12}{\dd}         & \DimVal{1cc}         & \demowidth{1cc} \\
    \mintinline{latex}{nd} & new didot                                                                                               & \qty{0.375}{\mm}      & \DimVal{1nd}         & \demowidth{1nd} \\
    \mintinline{latex}{bp} & big point                                                                                               & \fqty{1}{72}{\in}     & \DimVal{1bp}         & \demowidth{1bp} \\[6pt]
    \mintinline{latex}{em} & \multicolumn{3}{m{7cm}}{roughly width of an \enquote*{M} in the current font}                           & \demowidth{1em}                                                \\
    \mintinline{latex}{ex} & \multicolumn{3}{m{7cm}}{roughly height of an \enquote*{x} in the current font}                          & \demowidth{1ex}                                                \\
    \mintinline{latex}{mu} & \multicolumn{3}{m{7cm}}{equal to \fqty{1}{18}{em}, where \unit{em} is taken from the current math font} & \demowidth{0.05556em}                                          \\
    \bottomrule
  \end{tabular}
\end{table}

The last three units mentioned in the table are relative to the current font
used. Historically they were related to the \enquote*{M} and \enquote*{x}
glyphs in a given font but today they are arbitrarily set by fonts. These units
are useful if we want the length to scale proportionally when used with
different font sizes. The \mintinline{latex}|em| unit is usually used for
horizontal lengths, while the \mintinline{latex}|ex| is used for vertical
lengths. The \mintinline{latex}|mu| unit can only be used in math mode for math
spacing (see \autoref{sec:math-spacing}).
\begin{example}
\begin{minipage}[b]{0.5\linewidth} %!hide
foo\\[1ex] bar
\end{minipage}\begin{minipage}[b]{0.5\linewidth}%!hide

\tiny foo\\[1ex] bar
\end{minipage}%!hide
\end{example}

The desktop publishing point (DTP point) is the \emph{de facto} standard point
as used in most programs, and it is defined as \fqty{1}{72}{\in}. For
historical reasons the default \TeX{} points are a bit smaller, while the DTP
points are called \enquote{big points}. While this shouldn't be noticeable in
normal circumstances, remember to use \mintinline{latex}|bp| if exact point
values are required of you.
\begin{example}
\fontsize{12pt}{15pt}\selectfont
Text in 12 \TeX{} points.

\fontsize{12bp}{15bp}\selectfont
Text in 12 DTP points.
\end{example}
\endgroup
\subsection{Line Spacing}\index{line spacing}

If you want to use larger inter-line spacing in a
document, change its value by putting the
\begin{lscommand}
  \csi{linespread}[factor: m]
\end{lscommand}
command into the preamble of your document.
Use \verb|\linespread{1.3}| for ``one and a half'' line
spacing, and \verb|\linespread{1.6}| for ``double'' line spacing.  Normally
the lines are not spread, so the default line spread factor
is~1.\index{double line spacing}

Note that the effect of the \csi{linespread} command is rather drastic and
not appropriate for published work. So if you have a good reason for
changing the line spacing you might want to use the command:
\begin{lscommand}
  \mintinline{latex}|\setlength{\baselineskip}{1.5\baselineskip}|
\end{lscommand}

\begin{example}
{\setlength{\baselineskip}%
           {1.5\baselineskip}
This paragraph is typeset with
the baseline skip set to 1.5 of
what it was before. Note the
par command at the end of the
paragraph.\par}

This paragraph has a clear
purpose, it shows that after the
curly brace has been closed,
everything is back to normal.
\end{example}

\subsection{Paragraph Formatting}\label{parsp}

In \LaTeX{}, there are two parameters influencing paragraph layout.
By placing a definition like
\begin{code}
\csi{setlength}\verb|{|\csi{parindent}\verb|}{0pt}| \\
\verb|\setlength{|\csi{parskip}\verb|}{1ex plus 0.5ex minus 0.2ex}|
\end{code}
in the preamble of the input file, you can change the layout of
paragraphs. These two commands increase the space between two paragraphs
while setting the paragraph indent to zero.

The \texttt{plus} and \texttt{minus} parts of the length above tell
\TeX{} that it can compress and expand the inter-paragraph skip by the
amount specified, if this is necessary to properly fit the paragraphs
onto the page.

In continental Europe,
paragraphs are often separated by some space and not indented. But
beware, this also has its effect on the table of contents. Its lines
get spaced more loosely now as well. To avoid this, you might want to
move the two commands from the preamble into your document to some
place below the command \verb|\tableofcontents| or to not use them at all,
because you'll find that most professional books use indenting and not
spacing to separate paragraphs.

If you want to indent a paragraph that is not indented, use
\begin{lscommand}
  \csi{indent}
\end{lscommand}
\noindent at the beginning of the paragraph.\footnote{To indent the first paragraph after each section head, use
  the \pai{indentfirst} package in the `tools' bundle.} Obviously,
this will only have an effect when \verb|\parindent| is not set to
zero.

To create a non-indented paragraph, use
\begin{lscommand}
  \csi{noindent}
\end{lscommand}
\noindent as the first command of the paragraph. This might come in handy when
you start a document with body text and not with a sectioning command.

\subsection{Horizontal Space}\label{sec:hspace}

\LaTeX{} determines the spaces between words and sentences
automatically. To add horizontal space, use:\index{horizontal!space}
\begin{lscommand}
  \csi{hspace}[length: m]
\end{lscommand}
If such a space should be kept even if it falls at the end or the
start of a line, use \verb|\hspace*| instead of \verb|\hspace|.

\begin{example}
This\hspace{1.5cm}is a space
of \qty{1.5}{\cm}.
\end{example}

The command
\begin{lscommand}
  \csi{stretch}[n: m]
\end{lscommand}
\noindent generates a special rubber space. It stretches until all the
remaining space on a line is filled up. If multiple
\verb|\hspace{\stretch{|\emph{n}\verb|}}| commands are issued on the same
line, they occupy all available space in proportion of their respective
stretch factors.

\begin{example}
x\hspace{\stretch{1}}
x\hspace{\stretch{3}}x
\end{example}

When using horizontal space together with text, it may make sense to make
the space adjust its size relative to the size of the current font.
This can be done by using the text-relative units \texttt{em} and
\texttt{ex}:

\begin{example}
{\Large{}big\hspace{1em}y}\\
{\tiny{}tin\hspace{1em}y}
\end{example}

\subsection{Vertical Space}
The space between paragraphs, sections, subsections, \ldots\ is
determined automatically by \LaTeX. If necessary, additional vertical
space \emph{between two paragraphs} can be added with the command:
\begin{lscommand}
  \csi{vspace}[length: m]
\end{lscommand}

This command should normally be used between two empty lines.  If the
space should be preserved at the top or at the bottom of a page, use
the starred version of the command, \verb|\vspace*|, instead of \verb|\vspace|.\index{vertical space}

The \verb|\stretch| command, in connection with \verb|\pagebreak|, can
be used to typeset text on the last line of a page, or to centre text
vertically on a page.
\begin{code}
\begin{minted}{latex}
Some text \ldots

\vspace{\stretch{1}}
This goes onto the last line of the page.\pagebreak
\end{minted}
\end{code}

Additional space between two lines of \emph{the same} paragraph or
within a table is specified with the
\begin{lscommand}
  \csi{\bs}[length: o]
\end{lscommand}
\noindent command.

With \csi{bigskip} and \csi{smallskip} you can skip a predefined amount of
vertical space without having to worry about exact numbers.

\section{Page Layout}

\begin{figure}[!hp]
  \begin{center}
    \makeatletter\@mylayout\makeatother
  \end{center}
  \vspace*{1.8cm}
  \caption[Layout parameters for this book.]{Layout parameters for this book. Try the \pai{layouts} package to print the layout of your own document.}\label{fig:layout}
  \csih{footskip}
  \csih{headheight}
  \csih{headsep}
  \csih{marginparpush}
  \csih{marginparsep}
  \csih{marginparwidth}
  \csih{oddsidemargin}
  \csih{paperheight}
  \csih{paperwidth}
  \csih{textheight}
  \csih{textwidth}
  \csih{topmargin}
\end{figure}\index{page layout}

\LaTeX{} allows you to specify the \wi{paper size} in the
\verb|\documentclass| command. It then automatically picks the right
text \wi{margins}, but sometimes you may not be happy with
the predefined values. Naturally, you can change them.
%no idea why this is needed here ...
\thispagestyle{fancyplain}
\autoref{fig:layout} shows all the parameters that can be changed.
The figure was produced with the \pai{layout} package from the tools bundle.%
\footnote{\CTANref|pkg/tools|}

\textbf{WAIT!} \ldots before you launch into a ``Let's make that
narrow page a bit wider'' frenzy, take a few seconds to think. As with
most things in \LaTeX, there is a good reason for the page layout to
be as it is.

Sure, compared to your off-the-shelf MS Word page, it looks awfully
narrow. But take a look at your favourite book\footnote{I mean a real
  printed book produced by a reputable publisher.} and count the number
of characters on a standard text line. You will find that there are no
more than about 66 characters on each line. Now do the same on your
\LaTeX{} page. You will find that there are also about 66 characters
per line.  Experience shows that the reading gets difficult as soon as
there are more characters on a single line. This is because it is
difficult for the eyes to move from the end of one line to the start of the next one.
This is also why newspapers are typeset in multiple columns.

So if you increase the width of your body text, keep in mind that you
are making life difficult for the readers of your paper. But enough
of the cautioning, I promised to tell you how you do it \ldots

\LaTeX{} provides two commands to change these parameters. They are
usually used in the document preamble.

The first command assigns a fixed value to any of the parameters:
\begin{lscommand}
  \csi{setlength}\verb|{|\emph{parameter}\verb|}{|\emph{length}\verb|}|
\end{lscommand}

The second command adds a length to any of the parameters:
\begin{lscommand}
  \csi{addtolength}\verb|{|\emph{parameter}\verb|}{|\emph{length}\verb|}|
\end{lscommand}

This second command is actually more useful than the \csi{setlength}
command, because it works relative to the existing settings.
To add one centimetre to the overall text width, I put the
following commands into the document preamble:
\begin{code}
\verb|\addtolength{\hoffset}{-0.5cm}|\\
\verb|\addtolength{\textwidth}{1cm}|
\end{code}

In this context, you might want to look at the \pai{calc} package.
It allows you to use arithmetic operations in the argument of \csi{setlength}
and other places where numeric values are entered into function
arguments.

\section{More Fun With Lengths}

Whenever possible, I avoid using absolute lengths in
\LaTeX{} documents. I rather try to base things on the width or height
of other page elements. For the width of a figure this could
be \verb|\textwidth| in order to make it fill the page.

The following 3 commands allow you to determine the width, height, and
depth of a text string.

\begin{lscommand}
  \csi{settoheight}\verb|{|\emph{variable}\verb|}{|\emph{text}\verb|}|\\
  \csi{settodepth}\verb|{|\emph{variable}\verb|}{|\emph{text}\verb|}|\\
  \csi{settowidth}\verb|{|\emph{variable}\verb|}{|\emph{text}\verb|}|
\end{lscommand}

\noindent The example below shows a possible application of these commands.

\begin{example}[examplewidth=0.45\linewidth]
\newenvironment{vardesc}[1]{%
  \settowidth{\parindent}{#1:\ }
  \makebox[0pt][r]{#1:\ }}{}

\begin{displaymath}
a^2+b^2=c^2
\end{displaymath}

\begin{vardesc}{Where}\(a\),
\(b\) --- are adjacent to the right
angle of a right-angled triangle.

\(c\) --- is the hypotenuse of
the triangle and feels lonely.

\(d\) --- finally does not show up
here at all. Isn't that puzzling?
\end{vardesc}
\end{example}

\section{Boxes}\label{sec:boxes}
\LaTeX{} builds up its pages by pushing around boxes. At first, each
letter is a little box, which is then glued to other letters to form
words. These are again glued to other words, but with special glue,
which is elastic so that a series of words can be squeezed or
stretched as to exactly fill a line on the page.

I admit, this is a very simplistic version of what really happens, but the
point is that \TeX{} operates on glue and boxes. Letters are not the only
things that can be boxes. You can put virtually everything into a box,
including other boxes. Each box will then be handled by \LaTeX{} as if it
were a single letter.

In earlier chapters you encountered some boxes, although I did
not tell you. The \ei{tabular} environment and the \csi{includegraphics}, for
example, both produce a box. This means that you can easily arrange two
tables or images side by side. You just have to make sure that their
combined width is not larger than the text width.

You can also pack a paragraph of your choice into a box with either
the

\begin{lscommand}
  \csi{parbox}\verb|[|\emph{pos}\verb|]{|\emph{width}\verb|}{|\emph{text}\verb|}|
\end{lscommand}

\noindent command or the

\begin{lscommand}
  \verb|\begin{|\ei{minipage}\verb|}[|\emph{pos}\verb|]{|\emph{width}\verb|}| text
  \verb|\end{|\ei{minipage}\verb|}|
\end{lscommand}

\noindent environment. The \texttt{pos} parameter can take one of the letters
\texttt{c, t} or \texttt{b} to control the vertical alignment of the box,
relative to the baseline of the surrounding text. \texttt{width} takes
a length argument specifying the width of the box. The main difference
between a \ei{minipage} and a \csi{parbox} is that you cannot use all commands
and environments inside a \ei{parbox}, while almost anything is possible in
a \ei{minipage}.

While \csi{parbox} packs up a whole paragraph doing line breaking and
everything, there is also a class of boxing commands that operates
only on horizontally aligned material. We already know one of them;
it's called \csi{mbox}. It simply packs up a series of boxes into
another one, and can be used to prevent \LaTeX{} from breaking two
words. As boxes can be put inside boxes, these horizontal box packers
give you ultimate flexibility.

\begin{lscommand}
  \csi{makebox}\verb|[|\emph{width}\verb|][|\emph{pos}\verb|]{|\emph{text}\verb|}|
\end{lscommand}

\noindent \texttt{width} defines the width of the resulting box as
seen from the outside.\footnote{This means it can be smaller than the
  material inside the box. You can even set the
  width to 0pt so that the text inside the box will be typeset without
  influencing the surrounding boxes.}  Besides the length
expressions, you can also use \csi{width}, \csi{height}, \csi{depth}, and
\csi{totalheight} in the width parameter. They are set from values
obtained by measuring the typeset \emph{text}. The \emph{pos} parameter takes
a one letter value: \textbf{c}enter, flush\textbf{l}eft,
flush\textbf{r}ight, or \textbf{s}pread the text to fill the box.

The command \csi{framebox} works exactly the same as \csi{makebox}, but
it draws a box around the text.

The following example shows you some things you could do with
the \csi{makebox} and \csi{framebox} commands.

\begin{example}
\makebox[\textwidth]{%
    c e n t r a l}\par
\makebox[\textwidth][s]{%
    s p r e a d}\par
\framebox[1.1\width]{Guess I'm
    framed now!} \par
\hspace{1cm} %!hide
\framebox[0.8\width][r]{Bummer,
    I am too wide} \par
\framebox[1cm][l]{never
    mind, so am I}
Can you read this?
\end{example}

Now that we control the horizontal, the obvious next step is to go for
the vertical.\footnote{Total control is only to be obtained by
  controlling both the horizontal and the vertical \ldots}
No problem for \LaTeX{}. The

\begin{lscommand}
  \csi{raisebox}\verb|{|\emph{lift}\verb|}[|\emph{extend-above-baseline}\verb|][|\emph{extend-below-baseline}\verb|]{|\emph{text}\verb|}|
\end{lscommand}

\noindent command lets you define the vertical properties of a
box. You can use \csi{width}, \csi{height}, \csi{depth}, and
\csi{totalheight} in the first three parameters, in order to act
upon the size of the box inside the \emph{text} argument.

\begin{example}[examplewidth=0.45\linewidth]
\raisebox{0pt}[0pt][0pt]{\Large%
\textbf{Aaaa\raisebox{-0.3ex}{a}%
\raisebox{-0.7ex}{aa}%
\raisebox{-1.2ex}{r}%
\raisebox{-2.2ex}{g}%
\raisebox{-4.5ex}{h}}}
she shouted, but not even the next
one in line noticed that something
terrible had happened to her.
\end{example}

\section{Rules}\label{sec:rule}

A few pages back you may have noticed the command

\begin{lscommand}
  \csi{rule}\verb|[|\emph{lift}\verb|]{|\emph{width}\verb|}{|\emph{height}\verb|}|
\end{lscommand}

\noindent In normal use it produces a simple black box.

\begin{example}
\rule{3mm}{.1pt}%
\rule[-1mm]{5mm}{1cm}%
\rule{3mm}{.1pt}%
\rule[1mm]{1cm}{5mm}%
\rule{3mm}{.1pt}
\end{example}

\noindent This is useful for drawing vertical and horizontal
lines. The line on the title page, for example, has been created with a
\csi{rule} command.

\bigskip
\begin{FlushRight}
  The End.
\end{FlushRight}

%

% Local Variables:
% TeX-master: "lshort2e"
% mode: latex
% mode: flyspell
% End:
