% The Not So Short Introduction to LaTeX
%
% Copyright (C) 1995--2022 Tobias Oetiker, Marcin Serwin, Hubert Partl,
% Irene Hyna, Elisabeth Schlegl and Contributors.
%
% This document is free software: you can redistribute it and/or modify it
% under the terms of the GNU General Public License as published by the Free
% Software Foundation, either version 3 of the License, or (at your option) any
% later version.
%
% This document is distributed in the hope that it will be useful, but WITHOUT
% ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
% FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
% details.
%
% You should have received a copy of the GNU General Public License along with
% this document.  If not, see <https://www.gnu.org/licenses/>.

% !TEX root = ./lshort.tex

\chapter{Typesetting Mathematical Formulae}\label{chap:math}

\begin{intro}
  The \TeX{} typesetting system has become nearly ubiquitous when it comes to
  typesetting mathematics. Many software packages even offer to export their
  mathematical formulae to \LaTeX{} (for example, SageMath~\cite{sagemath}) or
  allow entering math expressions in \LaTeX{} or \LaTeX{}-derived syntax (for
  example, Wikipedia~\cite{enwiki:1091087776}). In this chapter, you will learn
  how to insert math formulae into your document.
\end{intro}

\section{Modern Mathematics}

While core \LaTeX{} is able to produce high quality mathematics output out of
the box, there are a few areas where useful features are missing, and some
design choices have not aged well over the last 30 years.

The \emph{\wi{American Mathematical Society}} was very interested in \TeX{} from
the earliest days and sponsored the development of several well received
enhancements to improve \LaTeX{}'s math abilities. The enhancements are known as
\hologo{AmSTeX} and \hologo{AmSLaTeX}.

These days, the \hologo{AmSLaTeX} features, and some additional ones, are
provided by the \pai*{mathtools} package. It loads the \pai{amsmath} package
internally, adjusts some settings, fixes some behaviours, and adds some
additional commands. We recommend loading it together with the
\pai*{unicode-math} package for an optimal math-writing experience.

The original \TeX{} used its own font encoding for typesetting mathematics,
which is still used by default in \LaTeX{}. In recent years, a new standard
appeared: OpenType math extensions,\footnote{Its internal structure is actually
  based on \TeX{} font tables.} which makes it possible to use standardized
Unicode characters inside documents. The \pai{unicode-math} package adds
support for these fonts in \LaTeX{}, allowing you to use more symbols and makes
the commands for accessing math symbols a bit more consistent. The problem with
\pai{unicode-math}, is that some older math packages rely on the
classic math font encoding. So if you have to use them, do not use the
\pai{unicode-math} package, to protect your sanity.

Throughout this section, we assume that your preamble contains these two
lines in this order:
\begin{minted}{latex}
\usepackage{mathtools}
\usepackage[
  math-style=ISO,
  warnings-off={mathtools-colon, mathtools-overbracket},
]{unicode-math}
\end{minted}
The \cargv{math-style=ISO} key fixes a small inconsistency in original \TeX{}
regarding the shape of uppercase Greek letters. The \cargv{warnings-off} key
disables two warnings about overwriting some \pai{mathtools}
commands.\footnote{These are \csi{overbracket}, \csi{underbracket},
  \csi{coloneq}, \csi{dblcolon}, \csi{coloneqq}, \csi{Coloneqq} and
  \csi{eqqcolon}. Disable this package option and read these warnings if you are
  going to use them.}

\section{Single Equations}\label{sec:single_equations}

\LaTeX{} distinguishes between two styles of typesetting formulae:
\emph{\wi{text style}} and \emph{\wi{display style}}. The text style is used to
typeset inline math in running text, like this: \(\sum_{k=0}^\infty
\frac{1}{k}\), while the display style is used to typeset bigger equations on
their own line, like this:
\[
  \sum_{k=0}^\infty \frac{1}{k}.
\]

To typeset an inline formula, put it between \csi{(} and \csi{)} commands, while
\csi{[} and \csi{]} typesets it in display mode.
\begin{chktexignore}
\begin{example}
Not like this 3-1=0,
but like this \(3-1=2\)
or this
\[
  3 - 1 = 2
\]
\end{example}
\end{chktexignore}

It is often the case that we want to refer to a specific formula or equation in
the document. To make this possible, a special \ei{equation} environment exists
that typesets the formula in display mode and adds a number to the right. The
equations can be labelled and referred to by using the commands described in
\autoref{sec:crossref}.
\begin{example}
\begin{equation}
  \label{trivial}
  2 + 2 = 4
\end{equation}
Equation~\ref{trivial}
is true.
\end{example}
The commands \csi{eqref} and \csi{tag} make cross-referencing in math context
even simpler. The first one is similar to the \cs{ref} command but encloses its
label in parentheses to match the appearance of the equation label. The second
one allows you to customize the visible label of the equation.
\begin{example}
\begin{equation}
  \tag{Ingsoc's theorem}
  \label{ingsoc}
  2 + 2 = 5
\end{equation}
Equation~\eqref{ingsoc} is false.
\end{example}
The starred version, \ei{equation*}, is a synonym of \csi{[}.

\subsection{Math Mode}

The commands and environments mentioned in the previous section activate a
special math-optimised version of the \LaTeX{} language. It is commonly known
as \emph{\wi{math mode}}. \LaTeX{} normally operates in \emph{text mode}. There
are numerous differences between the two modes. For starters, most of the
whitespace is ignored in math mode.
\begin{example}
\(123xyz\) is the same as \(
  1 2 3 x y z
\).
\end{example}
The spaces around symbols are derived logically from the mathematical
expressions. We will talk more about those in \autoref{sec:math-spacing}. Since
there is no concept of a paragraph in math formulae, leaving empty lines inside
math mode is \emph{not} allowed. Doing so will result in the \enquote{Bad math
  environment delimiter.} error.

Another difference is the fact that all letters are treated as mathematical
variables. Variables are printed using an \textit{italic} font, and the
spacing around each letter is wider than in text-mode.
\begin{example}
Compare office to \(office\).
\end{example}
If you want to typeset normal text within a formula, you can use the \csi{text}
command.
\begin{example}
\( 1 + \text{one} = 2\)
\end{example}

Finally, additional commands and syntax become available to enable typesetting
mathematical notation. For example, the \ai{\^{}} and \ai{\_} characters can
now be used to typeset \wi{superscript}s and \wi{subscript}s, respectively.
\begin{example}
\( a^2 + b^2 = c^2 \) \\
\( A_x = G_{\text{foo}} \)
\end{example}

\section{Building Blocks of Mathematical Formulae}

In this section, we describe the most important commands used in mathematical
typesetting. The list of symbols introduced here is far from comprehensive. If
you need some additional symbols, be sure to check out~\cite{detexify,
  unicode-math-symbols, latexcomp} since there is a high chance they already
exist.

\subsection{Basic Arithmetic}

You can probably guess how to typeset addition, subtraction, and equality based
on the previous examples. To typeset multiplication and division symbols, you
can use \csi{times} and \csi{div} commands.
\begin{example}
\( (4 \times 6) \div 3 = 8 \)
\end{example}
If you prefer to use dots for multiplication or slash for division, you can use
\csi{cdot} and \csi{divslash}, respectively. To typeset a negated equality, you
can precede the equal sign with \csi{not}.
\begin{example}
\( (5 \cdot 3) \divslash 2
  \not= 7 \)
\end{example}
Alternatively, you can use \csi{neq} which will produce the same result. The
\csi{not} notation is more general in that it works with many more symbols.

To typeset weak inequalities, you can use the \csi{leq} (less or equal) and
\csi{geq} (greater or equal) commands. If you prefer slanted versions, swap them
for \csi{leqslant} and \csi{geqslant}.
\begin{example}
\( 1 \leq 2 \) vs.\
\(1 \leqslant 2\)
\end{example}

Exponents are written using the superscript character \ai{\^{}}\index{exponent}.
\LaTeX{} will adapt the size and position of the superscript to the
the height of the previous character. This is usually correct, but when
parentheses are present the position may be a bit too low.
\begin{example}
\( a^2 \) is fine, but what
about \( (a^2)^2 \)?
\end{example}
In the example above, the second superscript doesn't know about the first one
inside the parenthesis, and it adapts only to the height of the closing
parenthesis. To fix this, enclose the parentheses in a group.
\begin{example}
\( {(a^2)}^2 \) is better.
\end{example}
In \autoref{sec:delimiters} we will also talk about growing parentheses that do
not have this problem.

To enter \wi{square root}s use, the \csi{sqrt} command. It will automatically
overline the expression it received as the argument.
\begin{example}
From Homer's theorem it
follows that
\[
  \sqrt{a} + \sqrt{b} = \sqrt{c}
\]
so we can see that
\(c = \sqrt{2x^2+7}\).
\end{example}
The full syntax of the \csi{sqrt} is actually
\begin{lscommand}
  \csi{sqrt}[n: o, expr: m]
\end{lscommand}
The optional argument \carg{n} allows you to typeset \carg{n}-th root
radicals.\footnote{The name \csi{sqrt} is a bit misleading in that respect
  \smiley.}
\begin{example}
Find three positive integers
\(a, b\) and \(c\), such that
\[
  a = \sqrt[7]{b^7 + c^7}
\]
\end{example}

Finally, typesetting built-up fractions is made possible by the
\begin{lscommand}
  \csi{frac}[numerator:m, denominator:m]
\end{lscommand}
command.
\begin{example}
And since
\[
  \frac{a}{b} \leq
  \frac{a+c}{b+d} \leq
  \frac{c}{d}
\]
it follows that
\(x = \frac{\sqrt{z+3}}{y^3}\).
\end{example}

\subsection{Logic and Set Theory}

The basic logical operations can be typeset using rather self-explanatory
commands: \csi{lnot}, \csi{land}, \csi{lor}, \csi{implies} and \csi{iff}.
\begin{example}
\[
  p \land q \iff
  \lnot (p \implies \lnot q)
\]
\end{example}
There's also a left facing implication named \csi{impliedBy}. Some less
established logical symbols can also be found under less intuitive names such
as \csi{veebar}, which produces \(\veebar\) used by some for exclusive
disjunction. If you intend to use them, make sure to use commands described in
\autoref{sec:simple_commands} to create meaningful synonyms.

The quantifier symbols can be typeset using \csi{forall} and \csi{exists}
commands.
\begin{example}
\[
  \lnot\forall_{q} P(q) \iff
  \exists_{q}\lnot P(q)
\]
\end{example}

To typeset sets, use the \csiv|{| and \csiv|}| commands.
\begin{example}
\( \{1, 2, 3, \ldots, 100\} \)
\end{example}
To indicate set membership (\enquote{is an element of}), you can use the
\csi{in} command.\footnote{Try to guess its left-flipped version name.} Sets
defined by a predicate are often written using set-builder notation with a
colon. The naïve way would be to write it like this:
\begin{example}
\( \{x \in X:
  \exists_n x^n = 1\} \)
\end{example}
The result doesn't look right, though. The reason is the aforementioned
automatic spacing based on mathematical meaning. The \mintinline{latex}|:|
character is used in \LaTeX{} for ratios, such as \(1:2\), which is why it has
equal spacing on both of its sides. To typeset colons in set-builder notation,
use the \csi{colon} command instead.
\begin{example}
\(\{ X \ni x\colon
  \exists_n x^n = 1\} \)
\end{example}

The usual set inclusion symbols are accessible as \csi{subset}, \csi{subseteq}
and \csi{subsetneq}, while their flipped versions are accessible as
\csi{supset}, \csi{supseteq} and \csi{supsetneq}. The set union symbol is
hiding behind \csi{cup} while set intersection is \csi{cap}. Set difference is
just \csi{setminus} though. You may also find \csi{emptyset} useful.
\begin{example}
% TODO: Waiting for unicode-math fix
\RenewDocumentCommand{\setminus}{}{\smallsetminus}
\[
  \emptyset
  \subset X \setminus X
  \subseteq X \cap \emptyset
  \subsetneq X
  \supseteq X \cup X
\]
\end{example}

\subsection{Greek Letters}

Every mathematician knows the Latin alphabet just isn't enough. Accessing the
Greek alphabet is as easy as typing \csi{alpha}, \csi{beta}, \csi{gamma},
\ldots{} for lowercase letters and \csi{Alpha}, \csi{Beta}, \csi{Gamma},
\ldots{} for uppercase letters.%
\csih{alpha}\csih{beta}\csih{gamma}\csih{delta}\csih{epsilon}\csih{zeta}%
\csih{eta}\csih{theta}\csih{iota}\csih{kappa}\csih{lambda}\csih{mu}%
\csih{nu}\csih{xi}\csih{omicron}\csih{pi}\csih{rho}\csih{sigma}\csih{tau}%
\csih{upsilon}\csih{phi}\csih{chi}\csih{psi}\csih{omega}\csih{Alpha}%
\csih{Beta}\csih{Gamma}\csih{Delta}\csih{Epsilon}\csih{Zeta}\csih{Eta}%
\csih{Theta}\csih{Iota}\csih{Kappa}\csih{Lambda}\csih{Mu}\csih{Nu}\csih{Xi}%
\csih{Omicron}\csih{Pi}\csih{Rho}\csih{Sigma}\csih{Tau}\csih{Upsilon}%
\csih{Phi}\csih{Chi}\csih{Psi}\csih{Omega}
\begin{example}
Let \(\epsilon\) be a small
number, and let  \(\Epsilon\)
be a large number.
\end{example}
As you can see above, in most fonts (including the default \LaTeX{} one) there
is no visual difference between some uppercase Greek letters and their Latin
equivalents. If you want to use them, make sure they do not clash in your
document.

Some Greek letters have defined variants. These are accessible by prepending
the word \texttt{var} before the letter name; \csi{varepsilon}, for example. A
list of all defined variants is presented in \autoref{tbl:greek_variants}.
\begin{table}
  \ExplSyntaxOn
  \NewDocumentCommand{\VariantShowcase}{m}{
    \csi{var#1} & \(\use:c{var#1}\) & \(\use:c{#1}\)
  }
  \ExplSyntaxOff
  \caption{Available variants of Greek letters.}\label{tbl:greek_variants}
  \begin{tabular}{@{}lcc@{}}
    \toprule
    Command & Variant & Main  \\
    \midrule
    \VariantShowcase{epsilon} \\
    \VariantShowcase{kappa}   \\
    \VariantShowcase{phi}     \\
    \VariantShowcase{pi}      \\
    \VariantShowcase{rho}     \\
    \VariantShowcase{sigma}   \\
    \VariantShowcase{theta}   \\
    \VariantShowcase{Theta}   \\
    \bottomrule
  \end{tabular}
\end{table}

Note that all Greek letters in math mode, the same as all the Latin letters,
are considered to be mathematical variables. In particular, \csi{pi}
\emph{should not} be used to denote the famous constant.

\subsection{Mathematical Fonts and How To Use Them}

When writing mathematics, we tend to use different fonts for
mathematical symbols depending on the object they represent. For example,
variables are typeset using an italic font, while named sets often get a fancy
double-struck (also known as \enquote*{blackboard bold}) font, for example,
\(\symbb{N}\). You can access various fonts by using the family of \cs{sym...}
commands. For example, to typeset double-struck letters use the \csi{symbb}
command.
\begin{example}
\[
  \forall_{p \in \symbb{P}}
  \exists_{n \in \symbb{N}}
  p < 5 \lor p^2 = 24n + 1
\]
\end{example}
All font changing commands are listed in \autoref{tbl:sym_commands}.
\begin{table}
  \ExplSyntaxOn
  \NewDocumentCommand{\Ncmmr}{m}{
    \setmathfont{New Computer Modern Math Regular}
    #1
    \setmathfont{Latin Modern Math}
  }

  \NewDocumentCommand{\LStr}{}{ABCabc\ \ldots}
  \NewDocumentCommand{\GStr}{}{
    \Alpha\Beta\Gamma\alpha\beta\gamma\ \ldots}
  \NewDocumentCommand{\NStr}{}{123\ \ldots}
  \ExplSyntaxOff
  \caption{Commands that change the font of mathematical symbols. An empty
    example field indicates that the Unicode does not define glyphs in the
    given set.}\label{tbl:sym_commands}
  \begin{minipage}{\linewidth}
    \centering
    \begin{tabular}{@{}*4l@{}}
      \toprule
                      & \multicolumn{3}{c}{Example}                                                           \\
      \cmidrule(l){2-4}
      Command         & Latin                        & Greek                          & Numerals              \\
      \midrule

      \csi{symup}     & \(\symup{\LStr}\)            & \(\symup{\GStr}\)              & \(\symup{\NStr}\)     \\
      \csi{symbfup}   & \(\symbfup{\LStr}\)          & \(\symbfup{\GStr}\)            & \(\symbfup{\NStr}\)   \\
      \csi{symit}     & \(\symit{\LStr}\)            & \(\symit{\GStr}\)              &                       \\
      \csi{symbfit}   & \(\symbfit{\LStr}\)          & \(\symbfit{\GStr}\)            &                       \\
      \csi{symsfup}   & \(\symsfup{\LStr}\)          &                                & \(\symsfup{\NStr}\)   \\
      \csi{symbfsfup} & \(\symbfsfup{\LStr}\)        & \(\symbfsfup{\GStr}\)          & \(\symbfsfup{\NStr}\) \\
      \csi{symsfit}   & \(\symsfit{\LStr}\)          &                                &                       \\
      \csi{symbfsfit} & \(\symbfsfit{\LStr}\)        & \(\symbfsfit{\GStr}\)          &                       \\
      \csi{symtt}     & \(\symtt{\LStr}\)            &                                & \(\symtt{\NStr}\)     \\
      \csi{symbb}\footnote{
        In the Greek set, only the four presented glyphs (\cs{Gamma}, \cs{Pi},
        \cs{gamma} and \cs{pi}) are defined by the Unicode standard.
      }               & \(\symbb{\LStr}\)            & \(\symbb{\Gamma\Pi\gamma\pi}\) & \(\symbb{\NStr}\)     \\
      \csi{symbbit}\footnote{
        Only the five presented glyphs (\texttt{D}, \texttt{d}, \texttt{e},
        \texttt{i} and \texttt{j}) are defined by the Unicode standard.
      }               & \(\symbbit{Ddeij}\)          &                                &                       \\
      \csi{symscr}\footnote{
        The default font does not contain lowercase glyphs. Here they are shown
        using a different font.
      }               & \Ncmmr{\(\symscr{\LStr}\)}   &                                &                       \\
      \csi{symbfscr}\footnote{
        Same as above.
      }               & \Ncmmr{\(\symbfscr{\LStr}\)} &                                &                       \\
      \csi{symfrak}   & \(\symfrak{\LStr}\)          &                                &                       \\
      \csi{symbffrak} & \(\symbffrak{\LStr}\)        &                                &                       \\
      \bottomrule
    \end{tabular}
  \end{minipage}
\end{table}

Avoid writing these commands directly in your formulas. Instead, you should
create logical wrappers around them. For example, the
\citetitle{iso80000-2}~\cite{iso80000-2} standard states that mathematical
constants should be written in a Roman (upright) font. Writing
\mintinline{latex}|\symrm{e}| every time we want to refer to the base of the
natural logarithm will make the code less readable, so we create simple
wrappers for the constants we are going to use.
\begin{example}[vertical_mode, examplewidth=0.7\linewidth]
\NewDocumentCommand{\e}{}{\symrm{e}}
\NewDocumentCommand{\im}{}{\symrm{i}}
\NewDocumentCommand{\cpi}{}{\symrm{\pi}}
\[ \e^{\im\cpi} + 1 = 0 \]
\end{example}

Functions such as \(\sin\) or \(\log\) should be written in Roman style,
however you should not use the \csi{symrm} command to do so. As the name of the
command indicates, it is meant to be used for mathematical symbols. Since in
\enquote{\(\sin\)} \(s\), \(i\) and \(n\) are not symbols, but
components of a single operator name, there are separate commands for
typesetting these. Fortunately you do not have to access them directly since
many of the standard functions are already defined.
\begin{example}
\NewDocumentCommand{\cpi}{}{\symrm{\pi}} %!hide
\NewDocumentCommand{\e}{}{\symrm{e}} %!hide
\( \cos(2\cpi) = \ln(\e) \)
\end{example}
The full list of predefined functions is presented in \autoref{tbl:functions}.
\begin{table}
  \caption{All functions predefined by \LaTeX{}.}\label{tbl:functions}
  \begin{tabular}{llllll}
    \toprule
    \csi{arccos} & \csi{cos}  & \csi{csc} & \csi{exp}  & \csi{ker}    & \csi{limsup} \\
    \csi{arcsin} & \csi{cosh} & \csi{deg} & \csi{gcd}  & \csi{lg}     & \csi{ln}     \\
    \csi{arctan} & \csi{cot}  & \csi{det} & \csi{hom}  & \csi{lim}    & \csi{log}    \\
    \csi{arg}    & \csi{coth} & \csi{dim} & \csi{inf}  & \csi{liminf} & \csi{max}    \\
    \csi{sinh}   & \csi{sup}  & \csi{tan} & \csi{tanh} & \csi{min}    & \csi{Pr}     \\
    \csi{sec}    & \csi{sin}                                                         \\
    \bottomrule
  \end{tabular}
\end{table}

If these are not enough for you, use the \csi{DeclareMathOperator} command to
define your own. It can be only used in the preamble.
\begin{example}[vertical_mode, examplewidth=0.6\linewidth]
%!showbegin !hide
% In preamble
\DeclareMathOperator{\argh}{argh}
% ...
%!showend !hide
\[ \argh(x) = \sinh(\max(x, x^2)) \]
\end{example}

\subsection{Big Operators}

At the beginning of the \autoref{sec:single_equations}, we used the
summation operator to show off some capabilities of mathematical typesetting. To
typeset it, use the \csi{sum} command, its lower and upper limits are specified
by the sub- and superscript operators.
\begin{example}
\(
  \sum_{k=0}^{n} \frac{1}{k^2}
\)
\end{example}
The appearance in text style differs massively from the one in
display style.
\begin{example}
\[
  \sum_{k=0}^{n} \frac{1}{k^2}
\]
\end{example}

This is an example of what's commonly known as big operator. There are other
such operators, such as \csi{prod} for products, or \csi{bigwedge} for
conjunctions. Some functions listed in \autoref{tbl:functions} are also
big operators.
\begin{example}
\[
  c = \max_{x\in X} f(x)
\]
\end{example}

You can define your own big operators by using a starred version of the
\csi{DeclareMathOperator} command.
\begin{example}[vertical_mode, examplewidth=0.6\linewidth]
%!showbegin !hide
% In preamble
\DeclareMathOperator*{\nut}{Nut}
% ...
%!showend !hide
\[ \nut_y = \lim_{x \to y} \argh{x} \]
\end{example}

If you have a long limit, it may make sense to typeset it vertically instead of
horizontally. This can be done using the \csi{substack} command. Inside, you can
place \cs{\bs} to indicate where new lines should be started.
\begin{example}
\[
  \sum^n_{
    \substack{0<i<n \\
    j\subseteq i}
  }
   P(i,j) = Q(i,j)
\]
\end{example}

The integral symbol is also a big operator, but it only shifts the lower limit
left.
\begin{example}
\[
  \int_a^b \liminf_{a \to x} a^2
\]
\end{example}
Due to the fact that the symbol is highly slanted to the right, typesetting
multiple integrals leads to excessive space around them. Use
\csi{iint},\csi{iiint},\csi{iiiint} instead for improved spacing.
\begin{example}
\[ \int\int\int\int \]
vs.\
\[ \iiiint \]
\end{example}

If you want to suppress the big operators' limit-placement-behaviour and typeset
normal, sub-, or superscripted text next to them, you can simply surround them
with curly braces.
\begin{example}
\[
  {\sum_{a}}^b
  \qquad%!hide
  {\int}_a^b
  \qquad%!hide
  {\nut^b}_a
\]
\end{example}
However, if a long limit is present this may lead to excessive spacing
before the sub- or superscripts.
\begin{example}
\[ {\sum_{loooooong}}^{b} \]
\end{example}
To fix the issue, use the
\begin{lscommand}
  \csi{sideset}[left: m, right: m, symbol: m]
\end{lscommand}
command. It surrounds the \carg{symbol} with left and right commands before
typesetting its limits.
\begin{example}[vertical_mode, examplewidth=0.7\linewidth]
\[ \sideset{^{a}}{^{b}}{\sum}_{loooooong} \]
\end{example}

\subsection{Math Accents}\label{sec:math_accents}

To denote an arithmetic mean taken over a variable, a notation with a bar over
the variable is used: \(\bar x\). If you remember \autoref{accents} from
\autopageref{accents}, you may think it would be possible to write it as
\mintinline{latex}|\=x|. This will not work though. In fact, none of the
commands from this table will work in math mode. There is a good conceptual
reason for this---the accents listed there are meant to typeset non-Latin
letters that are used in various languages. The character
\mintinline{latex}|\"u| is meant to represent u-umlaut and the correct glyph
for it will be chosen if it exists in the current font. In math, we don't want
an u-umlaut---we want the \enquote{double dot above} operator applied to
variable \(u\). Thus, different commands are used to achieve this.

To actually get a bar over a variable, you can use the \csi{bar} command. Other
accents\index{mathematical!accents} include \csi{hat}, \csi{grave},
\csi{acute}, \csi{tilde} or \csi{ddot}. Refer to~\cite{unicode-math-symbols}
for a full list.
\begin{example}
\(\bar{x}\) \(\hat{x}\)
\(\grave{x}\) \(\acute{x}\)
\(\tilde{x}\) \(\ddot{x}\)
\end{example}

Some accents also exist in a \enquote*{wide} version. These can encompass more
than one character. Compare \csi{hat} to \csi{widehat} in the example below.
\begin{example}
\(\hat{ABC}\) vs.\
\(\widehat{ABC}\)
\end{example}
The wide version of the \csi{bar} accent is called \csi{overline}. It is useful
if you want to mark the repetend of a decimal fraction.
\begin{example}
\(0.123\overline{456789}\)
\end{example}

Some wide accents even have limits. For example, the \csi{overbrace} and
\csi{underbrace} commands enable you to create horizontal braces with an
expression above or below them.
\begin{example}
\[
  \underbrace{
    \overbrace{(a+b+c)}^6
    \times
    \overbrace{(d+e+f)}^7
  }_{\text{meaning of life}}=42
\]
\end{example}

You can even create your own math-accents using
\csi{overset} and \csi{underset}.
\begin{example}
\(\overset{\text{foo}}{x}\)
\(\underset{\times}{A}\)
\end{example}
These commands may also be used when creating custom \wi{binary relations}.
Make sure that you do not overwrite existing commands!
\begin{example}
\(a \overset{\text{def}}{=} b\)
vs.\ \(a \eqdef b\)
\end{example}

\subsection{Delimiters}\label{sec:delimiters}

Besides the standard parentheses, brackets and braces, \LaTeX{} provides all
sorts of symbols for \wi{delimiters}, such as:
\begin{example}
\[
  \langle x \rangle
  \; %!hide
  \lBrack x \rBrack
  \; %!hide
  \lfloor x \rfloor
  \; %!hide
  \lvert x \rvert
\]
\end{example}
While all of them work fine for bungalow-style math, things get ugly when the
expression inside them starts getting tall.
\begin{example}[vertical_mode, examplewidth=0.8\linewidth]
\[
  {\lfloor
    \frac
    {{\langle\sum_{k=1}^{\infty} k^{-4}\rangle}^3}
    {\frac{{\lvert\{a,b,c\}\rvert}^8}{{(x^4)}^3}}
  \rfloor}^6
\]
\end{example}

To fix this, you can use the \csi{left} and \csi{right} commands. They take one
argument---the delimiter to extend---and adapt its size based on the content
they delimit. You must close every \csi{left} with a corresponding \csi{right},
but they do not have to use the same delimiter.
\begin{chktexignore}
\begin{example}
\[
  \left(
    \frac{1}{1 +
      \frac{1}{1 +
        \frac{1}{1 +
          \frac{1}{1 +
            \sqrt{2}}}}}
  \right]
\]
\end{example}
\end{chktexignore}
If you want to typeset a delimiter only on one side of the expression, a special
value may be passed: the dot character \ai{.}, which is treated as an invisible
delimiter.
\begin{example}
\[
  x = \left.
    \sum_{k=1}^{\infty}
      \frac{1}{k^2}
  \right\}
\]
\end{example}

While using the \csi{left} and \csi{right} commands directly is sometimes
necessary, the simplest case of using some predefined delimiters on both sides
is the most common. For this usage, the command
\begin{lscommand}
  \csi{DeclarePairedDelimiter}[name: M, left delim: m, right delim: m]
\end{lscommand}
is really useful. It declares the \carg{name} command which simply encloses its
argument between \carg{left delim} and \carg{right delim}, while its starred
version additionally uses \csi{left} and \csi{right} commands when typesetting
delimiters.
\begin{chktexignore}
\begin{example}[vertical_mode, examplewidth=0.8\linewidth]
\DeclarePairedDelimiter{\set}{\{}{\}}
\DeclarePairedDelimiter{\size}{\lvert}{\rvert}
\DeclarePairedDelimiter{\mean}{\langle}{\rangle}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\group}{(}{)}
\[
  \floor*{
    \frac
    {\mean*{\sum_{k=1}^{\infty} k^{-4}}^3}
    {\frac{\size*{\set{a,b,c}}^8}{\group*{x^4}^3}}
  }^6
\]
\end{example}
\end{chktexignore}

In some special circumstances, you may also want to select the size of the
delimiter yourself. You can do this by using the \csi{big}, \csi{Big},
\csi{bigg} and \csi{Bigg} commands. These may be either prepended to a
delimiting symbol with \enquote{l} and \enquote{r} suffixes, or passed as an
optional argument to a declared delimiter.
\begin{chktexignore}
  \begin{example}
\DeclarePairedDelimiter{%
  \set}{\{}{\}}
\( \bigl[ \ddagger \Biggr) \)
\quad %!hide
\( \set[\Big]{1,\frac{3}{4}} \)
\end{example}
\end{chktexignore}

If the \csi{DeclarePairedDelimiter} is not enough for you, there also exists
a more powerful \csi{DeclarePairedDelimiterX} command. It allows you to define
delimiters that are composed of more than one part (such as bra-kets) and
manipulate their arguments. For a full description, check out the documentation
of \pai*{mathtools} package.

\section{Multiline Equations}\index{long equations}

The math environments discussed so far only allow typesetting a single line
equation. However, sometimes an equation might be too long to fit.
\begin{example}
\begin{equation}
  a = b + c + d + e + f
  + g + h + i + j
  + k + l + m + n + o + p
\end{equation}
\end{example}
In this case, it is necessary to introduce line breaks inside the equation. When
doing so, it is important to remember a few rules to improve the readability:
\begin{enumerate}
  \item In general one should always break an equation \emph{before} an
        equality sign or operator.
  \item A break before an equality sign is preferable to a break before
        any operator.
  \item A break before a plus- or minus-operator is preferable to a break
        before a multiplication-operator.
  \item Any other type of break should be avoided if at all possible.
\end{enumerate}

This section will introduce several environments to typeset equations with
linebreaks inside them. These and more are described in more detail in the
\pai*{amsmath} package documentation.

\subsection{Long Equations}\label{sec:multline}

The easiest way to display long equations is the \ei{multline} environment. It
allows introducing line breaks with the \csi{\bs} command.
\begin{example}
\begin{multline}
  a + b + c + d + e
  + f + g + h + i \\
  = j + k + l + m + n
\end{multline}
\end{example}
The first line in \ei{multline} environment is aligned to the left, and the last
one to the right, while all the others are centred.
\begin{example}
\begin{multline}
  a + b + c + d + e \\
  + f + g + h + i \\
  = j + k + l + m + n
\end{multline}
\end{example}

If you do not want some particular inner line centred, you can use
\csi{shoveleft} and \csi{shoveright} commands to force the line to be left or
right aligned.
\begin{example}
\begin{multline}
  a + b + c \\
  \shoveleft{+ d + e + f} \\
  \shoveright{+ g + h + i} \\
  = j + k + l + m + n
\end{multline}
\end{example}

As with \ei{equation*}, there also exists a starred \ei{multline*} version that
suppresses the equation number.

\subsection{Multiple Unaligned Equations}\index{equation!multiple}

When typsetting multiple equations within several \env{equation} environments,
unneeded spacing appears between them.
\begin{example}
\begin{equation}
  2 + 2 = 4
\end{equation}
\begin{equation}
  2 \times 2 = 4
\end{equation}
\begin{equation}
  2 + 2 \times 2 = 6
\end{equation}
\end{example}
Use the \ei{gather} environment to eliminate the extra space. It allows you to break
lines using the \csi{\bs} command, and centres each equation.
\begin{example}
\begin{gather}
  2 + 2 = 4 \\
  2 \times 2 = 4 \\
  2 + 2 \times 2 = 6
\end{gather}
\end{example}
The equation numbering commands, such as \csi{eqref}, \csi{label} and \csi{tag},
now apply to the line they are present in. Additionally the command
\csi{notag} allows you to suppress equation numbering for a
particular line.
\begin{example}
\begin{gather}
  2 + 2 = 4
    \tag{Easy}\label{easy} \\
  2 \times 2 = 4 \notag \\
  2 + 2 \times 2 = 6
    \label{hard}
\end{gather}
Note:~\eqref{easy} is easier
than~\eqref{hard}.
\end{example}
The above example also illustrates that the centring of the equations inside
the environment may depend upon the length of the tag. Keep this in mind if
your tags and/or equations get long.

As always, the starred version of the environment, \ei{gather*}, suppresses
all equation numbers.

\subsection{Multiple Aligned Equations}\label{sec:aligned_equations}

If the gathered equations have a natural midpoint, it may be the case that the
\ei{align} environment is much better suited to typeset them. It allows you to
align the equations by inserting the \ai{\&} character, the same as in the
\env{tabular} environment. Note that the \ai{\&} should come \emph{before} any
binary operator, in order to produce the correct spacing.
\begin{example}
\begin{align}
  2 + 2 & = 2 \times 2 \\
  3 + 3 & \neq 3 \times 3 \\
  2 + 2 \times 2 & < 8
\end{align}
\end{example}

The \ei{align} environment allows placing multiple bits of math on a single line
by using \ai{\&} as a separator. The bits are considered to be paired, so every
second alignment character will produce a bigger space to accommodate for the
spacing between columns.
\begin{example}
\begin{align}
  a & \succeq b & c & \leq d \\
  a & \geq d & d & \prec c
\end{align}
\end{example}

The \ei{align} environment is also really useful when writing transformations of
a single equation over multiple lines.
\begin{example}
\begin{align}
  \sum_{k=0}^n k
    &= \sum_{k=0}^{n-1} k + n \\
    &= \frac{n(n-1)}{2} + n \\
    &= \frac{n(n+1)}{2}
\end{align}
\end{example}
We can even use additional columns to add line-by-line
comments with the \csi{text} command.
\begin{example}
\begin{align*}
  \sum_{k=0}^n k
    &= \sum_{k=0}^{n-1} k + n
      && \text{definition} \\
    &= \frac{n(n - 1)}{2} + n
      && \text{induction} \\
    &= \frac{n(n + 1)}{2}
      && \text{trivial}
\end{align*}
\end{example}

The \csi{phantom} command from \autoref{sec:math_phantoms} allows us to
correctly align equation systems.
\begin{example}
\begin{align}
  a + b + c
    &= d + e + f \nonumber \\
    & \phantom{=}\ + g + h
               \nonumber \\
    & \phantom{=}\ + i \\
    &= j + k + l
\end{align}
\end{example}
\LaTeX{} encloses relation symbols in thick spaces \csi{;} and binary symbols in
medium spaces \csi{:}. The symbols \(=\) and \(+\) in our example are each of
this type. The \csi{phantom} command strips \(=\) of its relation status, leaving
it short of two thick spaces. On the other hand, \LaTeX{} interprets \(+\)
following \csi{phantom} as a binary symbol, creating a spurious medium space.
So we need an extra normal space: \verb*|\ |\verb| = \; + \; - \:|.

If this aproach seems a bit complicated to you, have a look at \autoref{sec:IEEEeqnarray_intro}.

\subsection{Equations as Building Blocks}

All the environments presented above can be used inside other equations by
appending \enquote{-ed} to their name. They no longer number the equations
inside them, and accept an optional vertical positioning argument, with the
same semantics as those accepted by tabular (see \autoref{sec:tables} on
\autopageref{sec:tables}).
\begin{example}
\[
  \begin{multlined}[t]
    1 + 2 \\
    + 3 + 4
  \end{multlined} =
  \begin{gathered}[c]
    1 + 2 \\
    + 3 + 4
  \end{gathered} =
  \begin{aligned}[b]
    1 & + 2 \\
      & + 3 + 4
  \end{aligned}
\]
\end{example}
These are useful if you want to, for example, break an equation into multiple
lines with alignment, but still retain only a single equation number.
\begin{example}
\begin{equation}
  \begin{aligned}
    2 + 2 \times 2
      &= 2 \times 2 + 2 \\
      &\neq 2 \times (2 + 2) \\
  \end{aligned}
\end{equation}
\end{example}
They can be also freely nested, if the need arises.
\begin{example}
\begin{align}
  a + b + c
    &= \begin{multlined}[t]
      d + e \\
      + e + f \\
      + h
    \end{multlined} \\
    &= \begin{aligned}[t]
      i &+ j \\
        &- k \\
        &\div m \\
        &\times n
    \end{aligned} \\
    &= o + p + q
\end{align}
\end{example}

\subsection{IEEEeqnarray Environment}\label{sec:IEEEeqnarray_intro}

If the environments defined in \ei{amsmath} do not meet your needs, you can try
the \ei{IEEEeqnarray} from the \pai*{IEEEtrantools} package. It allows you to
specify the alignment of each math column separately, like in the
\env{tabular} environment. Here we will present some of its basic
functionalities. More information about \texttt{IEEEeqnarray} can be found in
Appendix~F of~\cite{IEEEtran_HOWTO}.

To specify column alignments, use \cargv{l}, \cargv{c} and \cargv{r}. Their
uppercase version also adds a small space around the column, which is useful in
case of binary operators. For example, to emulate the \ei{align} environment we
could use \cargv{rCl}, i.e., three columns: the first column right-justified,
the middle one centred with a little more space around it, and the third column
left-justified.
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c \\
  & = & d + e + f + g + h \\
  & = & i + j + k
\end{IEEEeqnarray}
\end{example}

In contrast to the \pai{amsmath} environments, \ei{IEEEeqnarray} does not
try to avoid collisions between the equation and its number.
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c \\
  & = & d + e + f
    + g + h + i + j \\
  & = & k + l + m + n.
\end{IEEEeqnarray}
\end{example}
To avoid this, use the \csi{IEEEeqnarraynumspace} on the offending line. It will
shift the whole equation left to accommodate the number present on the
given line.
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c  \\
  & = & d + e + f
    + g + h + i + j
    \IEEEeqnarraynumspace \\
  & = & k + l + m + n.
\end{IEEEeqnarray}
\end{example}

You can also use \csi{IEEEeqnarraymulticol} to adjust only a single line
within the environment, with its usage being similar to that of the
\cs{multicol} environment.
\begin{example}
\begin{IEEEeqnarray}{rCl}
  \IEEEeqnarraymulticol{3}{l}{
    a + b + c + d = e + f
  } \\
  e + f & = & g + h \\
  & = & i + j + k + l + m
\end{IEEEeqnarray}
\end{example}

If a particular line should not have an equation number, the number can be
suppressed using \csi{notag}, as discussed before. Additionally,
\pai{IEEEtrantools} defines \csi{IEEEyesnumber} and \csi{IEEEyessubnumber}. The
former command can be used to turn on numbering within the starred version of
an environment.
\begin{example}
\begin{IEEEeqnarray*}{rCl}
  a & = & b + c \\
  & = & d + e \IEEEyesnumber\\
  & = & f + g
\end{IEEEeqnarray*}
\end{example}
The latter changes the numbering to indicate sub expressions.
\begin{example}
\begin{IEEEeqnarray}{rCl}
  a & = & b + c \\
  & = & d + e \notag \\
  & = & f + g
    \IEEEyessubnumber
\end{IEEEeqnarray}
\end{example}
Note that \cs{label} commands should eventually follow after these.

Here is an alternative
approach to the \csi{phantom} example above.
Note the extra \csi{:} space which is required to separate the
plus sign from the variable name. \LaTeX{} assumes the plus sign belongs to the
variable as it does not understand that line is continued from the previous line.
\begin{example}
\begin{IEEEeqnarray}{rCl}
a + b + c &= & d + e + f \\
& & +\: g + h   \nonumber \\
& & +\: i       \nonumber  \\
& = & j + k + l
\end{IEEEeqnarray}
\end{example}

\section{Units}\label{sec:units}\index{units (SI)}\index{SI}

When dealing with real world data, you will often find yourself writing units
such as \qty{10}{\kg} or \qty{25}{\coulomb\per\mole}. In technical writing, it
is crucial to accurately convey values to avoid errors and ambiguity. The
\emph{International System of Units} (\emph{SI})~\cite{si}, comes with a
detailed set of typesetting rules. For example, you may have noticed that in
the first sentence the space between \num{10} and \unit{\kg} is smaller than
between the words.

Fortunately, thanks to the logical nature of \LaTeX{} markup and the excellent
\pai*{siunitx} package, you do not need to know most of the rules. Just use the
special unit-commands provided by the package, and all the units in your
document will be typeset correctly.

\subsection{Pitfalls of Naïvely Entered Units}

Naïvely, one might write units like this:
\begin{example}
The speed of light
is exactly 299792458 m/s.
\end{example}
This may look fine initially, but if your document gets longer you will probably
get into a situation where an unfortunate line break occurs.
\begin{example}
\ldots{} The speed of light
is 299792458 m/s. Thus, we
can calculate \ldots
\end{example}
A non-breaking space will fix this problem, but the next one is already
waiting---the space between numbers. Digits of long numbers should be grouped
to make them easier to read. The above example should then be written like this:
\begin{example}
The speed of light is
299~792~458~m/s.
\end{example}
Yet another challenge arises when trying to write the units inside math
mode
\begin{example}
\(10~\frac{m}{s}
  \times 12~s = 120~m\)
\end{example}
Here we need to make sure that the units are written in roman font.
The above example should be then written as
\begin{example}
\(10~\frac{\textrm{m}}
  {\textrm{s}}
  \times 12~\textrm{s}
  = 120~\textrm{m}\)
\end{example}
Hopefully, these examples illustrate why a better method is needed.

\subsection{Basic Commands of the \pai{siunitx} Package}

The basic commands of \pai{siunitx} package are
\begin{lscommand}
  \csi{num}[options: o, number: m]\\
  \csi{unit}[options: o, unit: m]\\
  \csi{qty}[options:o, number:m, unit:m]
\end{lscommand}
The \csi{num} command typesets a number, \csi{unit} typesets a unit, and
\csi{qty} typesets a quantity, i.e.\ a number followed by a unit. All the
commands feature an optional \carg{options} argument, which is a comma delimited
key-value pair list that can influence the output of the command. The
\carg{unit} argument can be provided in one of two styles, either
\enquote{literal} or \enquote{interpreted}.

In literal mode units are entered as strings of letters
\begin{example}
\unit{kg} is a unit,
\qty{10}{m/s} is a quantity
\end{example}
Spaces in literal mode are ignored. If you want to insert a product of units,
use either dot \ai{.} or tilde \ai{\~{}}.
\begin{example}
\unit{N} is
not \unit{kg m / s^2},
but \unit{kg.m / s^2}
or \unit{kg~m / s^2}
\end{example}

In interpreted mode, on the other hand, units are entered using predefined
macros:
\begin{example}
\unit{\kilo\gram} is a unit,
\qty{10}{\metre\per\second}
is a quantity
\end{example}
At first glance this may seem less convenient, but this enables the package to
recognize the logical structure of the units, which means that the formatting
can be changed on the fly.
\begin{example}[examplewidth=0.8\linewidth, vertical_mode]
Which one do you prefer:
\(\unit{\newton} = \unit{
  \kilo\gram\metre\per\square\second}\),
\(\unit{\newton} = \unit[per-mode = fraction]{
  \kilo\gram\metre\per\second\squared}\) or
\(\unit{\N} = \unit[per-mode = symbol]{
  \kg\m\per\s\tothe{2}}\)?
\end{example}
The commands \csi{gram}, \csi{kilo}, \csi{per} are rather self-explanatory. As you
can see, we have also used the \cargv{per-mode} option to influence the unit
style. While the command \csi{tothe} typesets arbitrary superscripts, the
command \csi{of} typesets arbitrary subscripts, known as qualifiers.
\begin{example}
\unit{\kg\of{mol}},
\unit{\bel\of{i}}
\end{example}

Note that the \csi{per} command only works on the next unit by default. If we
want it to apply to all following units, we may use \cargv{sticky-per} option.
\begin{example}[examplewidth=0.7\linewidth, vertical_mode]
The unit of thermal conductivity is
\unit{\watt\per\metre\per\kelvin}
or equivalently
\unit[sticky-per]{\m\kg\per\s\cubed\K}.
\end{example}

Sometimes, you may want to make the units use a different colour, so they figure
more prominently. This can be done using \cargv{unit-color}. Options
\cargv{number-color} and \cargv{color} may be used to colour only the numeric
values or whole quantities. If you want to highlight a single unit in a
compound unit, you may use the \csi{highlight} command.
\begin{example}[examplewidth=0.8\linewidth, vertical_mode]
\qty[unit-color = red   ]{9.81}{\m\per\s\squared},
\qty[number-color = blue]{9.81}{\m\per\s\squared},
\qty[color = green      ]{9.81}{\m\per\s\squared},
\qty{9.81}{\m\per\highlight{orange}\s\squared}
\end{example}

Now let's turn our attention to numbers. Numeric values will always use dot
as a decimal separator, regardless of the symbol entered. If you want to use
comma as the decimal separator, change the \cargv{output-decimal-marker} option.
\begin{example}
\NewDocumentCommand{\cpi}{}{\symrm{\pi}} %!hide
\(\cpi \approx \num{3.14159}\)
\\ %!hide
\(\cpi \approx \num{3,14159}\)
\\ %!hide
\(\cpi \approx \num[
  output-decimal-marker={,}
]{3.14159}\)
\end{example}

Numbers may also be entered using exponent notation. The symbols before the
exponent and base may be controlled using \cargv{exponent-product} and
\cargv{exponent-base} options
\begin{example}
\(\qty{1}{\tonne}
  = \qty{1e6}{\g}\) \\
\(\qty{1}{\gibi\byte} = \qty[
  exponent-base = 2,
]{1e30}{\byte}\) \\
\(\qty{1}{\L} = \qty[
  exponent-product = \cdot,
]{1e-3}{\cubic\m}\)
\end{example}

If we want all numbers to be formatted in exponent notation, regardless of
their entered form, we may use the \cargv{exponent-mode} option.
\begin{example}
\(2^{16} = \num{65536}\) \\
\(2^{16} = \num[
  exponent-mode = scientific,
]{65536}\) \\
\(2^{16} = \num[
  exponent-mode = engineering,
]{65536}\) \\
\(2^{16} = \num[
  exponent-mode = fixed,
]{65.536e3}\) \\
\(2^{16} = \num[
  exponent-mode = fixed,
  fixed-exponent = 5,
]{65.536e3}\)
\end{example}

In some fields, it may be common to write an uncertainty next to the numbers.
This may be done in several ways. In order to customize the appearance of the
uncertainties, use the \cargv{uncertainty-mode} option.
\begin{example}
\(M_{\oplus} = \qty{
  5.9722(6) e24}{\kg}\)
  \\ %!hide
\(M_{\oplus} = \qty{
  5.9722 +- 0.0006 e24}{\kg}\)
  \\ %!hide
\(M_{\oplus} = \qty{
  5.9722 \pm 0.0006 e24}{\kg}\)
  \\ %!hide
\(M_{\oplus} = \qty[
    uncertainty-mode = separate
  ]{5.9722(6) e24}{\kg}\)
  \\ %!hide
\(M_{\oplus} = \qty[
  uncertainty-mode = full
]{5.9722(6) e24}{\kg}\)
\end{example}

By default, \pai{siunitx} typesets the quantities in math mode. This may be
especially jarring if you are using a different font for the document text. One
simple solution is to set the \cargv{mode} option to \cargv{text}.
\begin{example}
\setmainfont{Source Sans Pro} %!hide
\qty{1}{\degreeCelsius} is
equal to \qty{1}{\kelvin},
but \qty[
  mode = text,
]{0}{\degreeCelsius} is \qty[
  mode = text,
]{-273.15}{\kelvin}.
Bizarre, isn't it?
\end{example}
If your document contains both math and normal text, it is probably better to
use a matching math font. You will learn more about this in
\autoref{sec:math_fonts}.

The behaviour of the commands when it comes to typesetting units and quantities
may be customized even further. For a full list of options check out the
\pai{siunitx} package documentation.

To avoid repeating the options with every command, use the
\begin{lscommand}
  \csi{sisetup}[options: m]
\end{lscommand}
command. It can be used in the preamble to ensure consistent style throughout
the document, or inside the document when the style needs to be changed just
in a given element, such as a table. These options may be also passed as package
options. \autoref{sistandaloneexa} shows an example usage of the package in
a full document.
\begin{listing}
  \begin{example}[standalone,
    template=empty,
    examplewidth=\linewidth,paperwidth=12cm,
    paperheight=5.5cm,
    vertical_mode]
\documentclass{article}

\usepackage[paperheight=\height,paperwidth=\width,margin=0.3cm]{geometry} %!hide
\sloppy %!hide
\usepackage{booktabs}
\usepackage[per-mode = fraction, unit-color = red]{siunitx}

\begin{document}
Units are typeset like this: \qty{9.81}{\m\per\s\squared}.
\begin{table}[h]
  \centering
  \sisetup{exponent-mode = fixed, fixed-exponent = 1}
  \begin{tabular}{@{}lr@{}}
    \toprule
    No. & Result (\unit{\kg}) \\
    \midrule
    1   & \num{12.3}          \\
    2   & \num{0.3}           \\
    3   & \num{1e2}           \\
    \bottomrule
  \end{tabular}
  \caption{Measurement results.
    Here custom options are used.}\label{table}
\end{table}

Now we are back to normal: \qty{3.637e-4}{\m\squared\per\s}.
\end{document}
\end{example}
  \caption{An example of using \pai{siunitx} in a document.}%
  \label{sistandaloneexa}
\end{listing}

\subsection{Other \pai{siunitx} Commands}

Besides the basic commands described above, \pai{siunitx} also defines several
other useful commands.

Angles are special in that they use base \(60\) instead of base \(10\) when
subdividing. The command
\begin{lscommand}
  \csi{ang}[options: o, angle: m]
\end{lscommand}
exists in order to simplify entering them. If they are entered using a semicolon
as a separator, then the following numbers are treated as minutes and seconds.
If they are given as a decimal number, they will be displayed as such.
\begin{example}
\ang{10}
\qquad %!hide
\ang{1;2;3}
\qquad %!hide
\ang{;;20} \\
\ang{32.5}
\qquad %!hide
\qty{60}{\degree}
\end{example}

When listing several numbers, we may use the
\begin{lscommand}
  \csi{numlist}[options: o, numbers: m]
\end{lscommand}
command, where \carg{numbers} are delimited by semicolons. This command is
context-aware, which means it will produce correct results when used with
\pai{polyglossia}.
\begin{example}
\numlist{1;2;3;4}

\begin{german}
  \numlist{1;2;3;4}
\end{german}
\end{example}

The package also contains dedicated commands for dealing with products and
ranges of numbers. The numbers in a product should be delimited with the
\verb|x| letter.
\begin{example}
Pick a number from
range \numrange{1}{10}. \\
\numproduct{2x5} is \(10\). \\
\begin{german}
  \numrange{1}{10}
\end{german}
\end{example}

All these commands also have quantity versions.
\begin{example}
Obtained results:
\qtylist{2;5;7}{\L}.\\
Acceptable range is
\qtyrange{1}{10}{\kg}. \\
This area is
\qtyproduct{2x5}{\metre}.
\end{example}

If we are dealing with quantum mechanics, then complex numbers may be useful. To
typeset them, use \csi{complexnum} and \csi{complexqty}. They can be entered in
both Cartesian form and polar coordinates.
\begin{example}[examplewidth=0.5\linewidth]
The conjugate of
\complexnum{2+3i} is
\complexnum{2-3i}
which is approximately
\complexnum{3.6056:-56.310}. \\
Why is my scale showing my
weight is
\complexqty{65+i21}{\kg}?
\end{example}

Sometimes the unit we want to use is missing. For example,
throughout this book, the unit of typographical point is used when talking about
font sizes. To define it we may use the
\begin{lscommand}
  \csi{DeclareSIUnit}[options:o, unit:m, symbol:m]
\end{lscommand}
command. The \carg{unit} is the macro we will use in the interpreted mode,
while the \carg{symbol} is the typeset symbol. The \carg{options} allow us to
define defaults concerning, for example, the spacing of the unit in
quantities.
\begin{example}
\DeclareSIUnit{\pt}{pt}
The default font size
in \LaTeX{} is \qty{10}{\pt}.
\end{example}

This command may also be used when we want to adjust the appearance of a
predefined unit. For example, the default litre is typeset using uppercase
\enquote*{L}, but you may want to change to lowercase \enquote*{l}, instead.
\begin{example}
Litre before redefining:
\unit{\L}. \\
\DeclareSIUnit{\litre}{l}
Litre after redefining:
\unit{\L}.
\end{example}

Similarly, the commands
\begin{lscommand}
  \csi{DeclareSIPrefix}    \\
  \csi{DeclareSIPower}     \\
  \csi{DeclareSIQualifier}
\end{lscommand}
allow definition of unit-related macros in case additional are needed.
\begin{example}[examplewidth=0.8\linewidth, vertical_mode]
\DeclareSIUnit{\pt}{pt}
\DeclareSIPower{\quartic}{\tothefourth}{4}
\DeclareSIPrefix{\decakilo}{dk}{4}
\DeclareSIQualifier{\polymer}{pol}

It's over \qty{9000}{\quartic\decakilo\pt\polymer}!
\end{example}

\subsection{Table Columns with Numbers}\label{sec:sitables}\index{decimal
  alignment}

When typesetting tables that contain numeric data, it is often useful to align
them along the decimal point, so they can be compared easily. The \pai{siunitx}
package adds a special column specifier, \cargv{S}, to the \ei{tabular}
environment for this purpose. Non-numeric data must be surrounded by curly
brackets in such columns.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\begin{tabular}{@{}lS@{}}
  \toprule
  Day       & {Candy eaten (\unit{\g})} \\
  \midrule
  Monday    & .3011                     \\
  Tuesday   & 54.86                     \\
  Wednesday & 1000.9722                 \\
  Thursday  & -1000.9722                \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{A simple example of using \pai{siunitx}'s \cargv{S} column
    specification.}
\end{listing}

When presenting numeric data, such as above, it is good to remember the
following two rules:
\begin{itemize}
  \item Never drop the leading zero before the decimal point.
  \item If the unit is the same in all cells, put it in the heading.
\end{itemize}
All numbers within \cargv{S} columns are automatically parsed by \pai{siunitx},
which means that, if we use it, the first rule will be enforced for us.

In order to influence parsing\slash{}displaying options of a
single column, pass them in square brackets to the column specification. See
\autoref{lst:siunitxS} for an example.
\begin{listing}
  \begin{example}[examplewidth=0.8\linewidth, vertical_mode]
\DeclareSIUnit{\eur}{\euro}
\begin{tabular} {
    @{}l
    S[output-decimal-marker={,},
      per-mode=symbol]@{}
  }
  \toprule
  Candy        & {Price (\unit{\eur\per\kg})} \\
  \midrule
  Chocolate    & 11.30                        \\
  Lollipops    & 15.86                        \\
  Marshmallows & 5.97                         \\
  Golden taffy & 1125.12                      \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of using optional parameters in a single \cargv{S}
    column specification.}\label{lst:siunitxS}
\end{listing}

Besides the standard options, there are also table-specific options that can be
passed to the columns. An important one is \cargv{table-format}. By default, the
\cargv{S} specifier centres the decimal point leaving equal space to the left
and to the right of it. This leads to a lot of empty space if lengths of
integer and fraction parts are widely different as can be seen in
\autoref{lst:toowide}.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\sisetup{exponent-mode = fixed}
\begin{tabular} {@{}SS@{}}
  \toprule
  {\unit{\ug}} & {\unit{\kg}} \\
  \midrule
  1 & 1e-9 \\
  0.2 & 2e-10 \\
  35 & 35e-8 \\
  -100 & -1e-7 \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An anti-example of using \pai{siunitx}'s \cargv{S} column
    specification without setting the \cargv{table-format}.}\label{lst:toowide}
\end{listing}
We can then use
\cargv{table-format} to tell \LaTeX{} how much space should be reserved
before and after dot. For example, \cargv{6.2} means that it should reserve
space for 6 digits before the decimal point, and for two digits after. The
format may also contain information about signs, exponents, or text around
the numbers. See \autoref{lst:tableformat} for an example.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\sisetup{exponent-mode = fixed}
\begin{tabular} {
    @{}
    S[table-format = +3.1]
    S[table-format = +1.10]
    @{}
  }
  \toprule
  \multicolumn{2}{c}{Weight} \\
  \midrule
  {\unit{\ug}} & {\unit{\kg}} \\
  \midrule
  1 & 1e-9 \\
  0.2 & 2e-10 \\
  35 & 35e-8 \\
  -100 & -1e-7 \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of using \pai{siunitx}'s \cargv{S} column
    specification with the \cargv{table-format} key.}\label{lst:tableformat}
\end{listing}

By default, numbers and text within the \cargv{S} columns and centred. If you
want to change the alignment, use the \cargv{table-number-alignment} and
\cargv{table-text-alignment} options. See \autoref{lst:salignment} for an
example.
\begin{listing}
  \begin{example}[examplewidth=0.7\linewidth, vertical_mode]
\begin{tabular} {
    @{}
    S[
      table-format = 2.1(1.1),
      table-number-alignment = left,
      uncertainty-mode = separate,
    ]
    S[
      table-format = 2.2e2{ big!},
      table-text-alignment = right,
    ]
    @{}
  }
  \toprule
  {Confidence (\unit{\percent})}
    & {Value} \\
  \midrule
  57.1(2) & 10e2 \\
  25.3(0) & 2e-1 \\
  0(0.1)  & 99.99e99{ big!} \\
  92(1)      & 7.2e10 \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of aligning text and numbers inside the \pai{siunitx}'s
    \cargv{S} column.}\label{lst:salignment}
\end{listing}
The numbers may also be aligned inside a \csi{multicol} or \csi{multirow},
using the \csi{tablenum} command as seen in \autoref{lst:tablenum}.
\begin{listing}
  \begin{example}[examplewidth=0.75\linewidth, vertical_mode]
\sisetup{table-format = 4.4e1}
\begin{tabular}{@{}lr@{}}
  \toprule
  Candy     & Friend                         \\
  \midrule
  Chocolate & Peter                          \\
  Lollipop  & Jane                           \\
  \multicolumn{2}{c}{\tablenum{12,34 e0}}    \\
  \multicolumn{2}{c}{\tablenum{333.5567 e1}} \\
  \multicolumn{2}{c}{\tablenum{4563.21 e2}}  \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of using the \csi{tablenum} command.}\label{lst:tablenum}
\end{listing}

If you don't want the decimal alignment but would still like to have
numbers in columns formatted by \pai{siunitx}, change the
\cargv{table-alignment-mode} to \cargv{none}. See \autoref{lst:snoalignment}
for an example.
\begin{listing}
  \begin{example}
\sisetup{
  table-alignment-mode = none,
  output-decimal-marker = {,},
  unit-color = red,
}
\begin{tabular}{@{}cS@{}}
  \toprule
  Variable & {Value} \\
  \midrule
  foo & 101.892 \\
  bar & 2e-1 \\
  baz & \qty{2.1}{\kg}  \\
  \bottomrule
\end{tabular}
\end{example}
  \caption{An example of using the \cargv{S} column specifier without aligning
    numbers.}\label{lst:snoalignment}
\end{listing}

\section{Matrices and the like}\label{sec:arraymat}

Typesetting matrices\index{matrix} in \LaTeX{} is possible with the \ei{matrix}
environment from the \pai*{amsmath} packages. It simply aligns the lines and
columns as in the \env{tabular} environment and does not place any delimiters
around its contents. In contrast to tabular, it does not accept column
specifications, and each of its entries is typeset in math mode. The maximum
number of columns a \ei{matrix} can have is \(10\).
\begin{example}
\( \left[
  \begin{matrix}
  1 & 2 \\
  3 & 4 \\
  \end{matrix}
  \right] \)
\end{example}

Because matrices are usually delimited, there are five additional versions that
simply surround the matrix contents within delimiters. These are
\begin{description}
  \item[\ei{pmatrix}] that uses parentheses as delimiters:
    \(\bigl(
    \begin{smallmatrix}
      1 & 2 \\
      3 & 4 \\
    \end{smallmatrix}
    \bigr)\).
  \item[\ei{bmatrix}] that uses brackets as delimiters:
    \(\bigl[
      \begin{smallmatrix}
        1 & 2 \\
        3 & 4 \\
      \end{smallmatrix}
      \bigr]\).
  \item[\ei{Bmatrix}] that uses braces as delimiters:
    \(\bigl\{
    \begin{smallmatrix}
      1 & 2 \\
      3 & 4 \\
    \end{smallmatrix}
    \bigr\}\).
  \item[\ei{vmatrix}] that uses vertical lines as delimiters:
    \(\bigl\vert
    \begin{smallmatrix}
      1 & 2 \\
      3 & 4 \\
    \end{smallmatrix}
    \bigr\vert\).
  \item[\ei{Vmatrix}] that uses double vertical lines as delimiters:
    \(\bigl\Vert
    \begin{smallmatrix}
      1 & 2 \\
      3 & 4 \\
    \end{smallmatrix}
    \bigr\Vert\).
\end{description}

Matrices created using these environments are rather large, because they are
meant to be typeset in display math. If for some reason you want to typeset a
matrix within text, you may get better results with the \ei{smallmatrix}
environment. Note that there are no delimited variants, so you must
provide any delimiters yourself.
\begin{example}
Compare \(
  \begin{matrix}
    1 & 2 \\
    3 & 4 \\
  \end{matrix}
\) with \(
  \begin{smallmatrix}
    1 & 2 \\
    3 & 4 \\
  \end{smallmatrix}
\)
\end{example}

The \ei{matrix} environment could also be used to typeset \wi{piecewise
  function}s, by using the \cargv{.} character as an invisible \csi{right}
delimiter in conjunction with a left brace. However, a much better alternative
is the \ei{cases} environment. Its contents are left aligned, and the delimiters
are already provided.
\begin{example}
\[
  \lvert x \rvert =
  \begin{cases}
    -x & \text{if } x < 0, \\
    0  & \text{if } x = 0, \\
    x  & \text{if } x > 0.
  \end{cases}
\]
\end{example}

If you need more control over the alignment of the individual columns, you may
also use the \ei{array} environment. It accepts the column specifier, just like
\env{tabular}, but typesets its contents in math mode. Note that it
introduces a bit more spacing compared to the \ei{matrix} environments.
\begin{example}
\[
  \begin{array}{rcl}
    12 & 1 & 21 \\
    1 & 22 & 101 \\
  \end{array}
\]
\end{example}

\section{Spacing in Math Mode}\label{sec:math-spacing}%
\index{math spacing}

\subsection{Mathematical Object Classes}

\LaTeX{} decides how much space to surround the symbols in math mode based
on their \emph{class}. For example, \(\leq\) belongs to class of binary
relations, so it is typeset with surrounding spaces. The class of a symbol can be
changed using the commands listed in \autoref{tbl:math_classes}.
\begin{table}
  \caption{Commands to influence mathematical object classes}\label{tbl:math_classes}
  \begin{tabular}{@{}cp{4.5cm}p{2.5cm}@{}}
    \toprule
    Command         & Explanation
                    & Examples                                                       \\
    \midrule
    \csi{mathord}   & Ordinary symbols, that do not require any special handling
                    & \mintinline{latex}|x| \(x\) \newline \csi{bot} \(\bot\)        \\
    \csi{mathop}    & Large operators, that are vertically centred within expression
                    & \csi{sum} \(\sum\) \newline \csi{bigcap} \(\bigcap\)           \\
    \csi{mathbin}   & Binary operators, with extra spacing around them
                    & \mintinline{latex}|+| \(+\) \newline \csi{times} \(\times\)    \\
    \csi{mathrel}   & Binary relations, with extra spacing around them
                    & \mintinline{latex}|=| \(=\) \newline \csi{succeq} \(\succeq\)  \\
    \csi{mathopen}  & Symbols that open groups, with space before
                    & \mintinline{latex}|(| \((\) \newline \csi{lBrack} \(\lBrack\)  \\ %chktex 36
    \csi{mathclose} & Symbols that close groups, with space after
                    & \mintinline{latex}|)| \()\) \newline \csi{rBrack} \(\rBrack\)  \\
    \csi{mathpunct} & Punctuation symbols, with space after
                    & \mintinline{latex}|,| \(,\) \newline \csi{colon} \(\colon\)    \\ %chktex 40
    \bottomrule
  \end{tabular}
\end{table}
For example, the symbol \(R\) is normally treated as alphabetical character,
but we may force it to treat it as relation symbol using the \csi{mathrel}
command.
\begin{example}
Let \(R\) be any relation.
We should now write it like
this \(a \mathrel{R} b\),
and not like this \(a R b\).
\end{example}

It is important to use symbols with proper classes while typesetting
mathematics. Some symbols may look the same as a single glyph but are different
in terms of their classes. For example, \csi{bot} and \csi{perp} look very
similar, but the former is meant to typeset a symbol, while the latter
represents the relation of perpendicularity.
\begin{example}
Let \(x \in \{\top, \bot\}\).
\\ %!hide
Given two lines \(k \perp l\).
\end{example}
Another good example is the difference between the vertical bar symbol, \ai{|},
as compared to the \csi{lvert} and \csi{rvert} commands. The former is a symbol,
while the latter are commands suitable for delimiting expressions.

Class commands should not be used throughout the body of the document. If
you want to use a new symbol (for example, an image) or repurpose an old one (such
as the \(R\) relation), define a logical wrapper for it that uses the
appropriate class inside.
\begin{example}
\NewDocumentCommand{\modulo}{}{%
  \mathbin{\%}%
}
\( 17 \modulo 3 = 2 \)
\end{example}

\subsection{Manual Spacing}\label{sec:math_spacing}

If \LaTeX{}'s choice of spacing within formulae is not satisfactory, it can
be adjusted manually. The most basic command to do so is
\begin{lscommand}
  \csi{mspace}[width: m]
\end{lscommand}
The \carg{width} is specified using a special unit \enquote{\unit{mu}}, which
is roughly equal to \sfrac{1}{18} of the width of letter \enquote{M} in the
current math font.\footnote{Units are explained in more detail in
  \autoref{sec:dimensions}.}
\begin{example}
\( 1 \mspace{18mu} 2 \)
\\ %!hide
\textinterrobang{} vs.\
\( ? \mspace{-7mu} ! \)
\end{example}
There also exist predefined synonyms for the values most commonly used. These
are presented in \autoref{tbl:math_space} and are usually sufficient when
creating a document.
\begin{table}
  \ExplSyntaxOn
  \NewDocumentCommand{\ShowSpace}{m}{\(\rightarrow \mspace{-2mu} #1 \leftarrow\)}
  \ExplSyntaxOff
  \caption{Commands for manual math spacing}\label{tbl:math_space}
  \begin{tabular}{llll}
    \toprule
    Command             & Alias   & Equivalent to       & Effect                     \\
    \midrule
    \emph{none}         &         &                     & \ShowSpace{}               \\[0.5em]
    \csi{thinspace}     & \csi{,} & \ltx|\mspace{3mu}|  & \ShowSpace{\thinspace}     \\
    \csi{medspace}      & \csi{:} & \ltx|\mspace{4mu}|  & \ShowSpace{\medspace}      \\
    \csi{thickspace}    & \csi{;} & \ltx|\mspace{5mu}|  & \ShowSpace{\thickspace}    \\
    \csi{quad}          &         & \ltx|\mspace{18mu}| & \ShowSpace{\quad}          \\
    \csi{qquad}         &         & \ltx|\mspace{36mu}| & \ShowSpace{\qquad}         \\[0.5em]
    \csi{negthinspace}  & \csi{!} & \ltx|\mspace{-3mu}| & \ShowSpace{\negthinspace}  \\
    \csi{negmedspace}   &         & \ltx|\mspace{-4mu}| & \ShowSpace{\negmedspace}   \\
    \csi{negthickspace} &         & \ltx|\mspace{-5mu}| & \ShowSpace{\negthickspace} \\
    \bottomrule
  \end{tabular}
\end{table}
For example, if you wanted to define the \enquote{d} in differentials, you may
want to insert a small space before it, to separate it from the contents of the
integral.
\begin{example}
\NewDocumentCommand{\ud}{}{%
  \,\symrm{d}%
}
\[
  \int_a^b f(x)\ud x
\]
\end{example}

Negative spaces can also be used if you want to create your own
mathematical symbols by overlaying existing ones.
\begin{example}
\NewDocumentCommand{\myrel}{}{
  \mathrel{
    -\mspace{-11mu}
    \infty{}
    \mspace{-11mu}-
  }
}
\( x \myrel y \)
\end{example}

\subsection{Phantoms}\label{sec:math_phantoms}

In some situations, it may be useful to insert the space that would normally be
occupied by some existing symbol. While you could eyeball it and insert
appropriate \csi{mspace}, there is a better way to do so---phantoms. There are
three commands for inserting phantoms:
\begin{lscommand}
  \csi{phantom}[text: m] \\
  \csi{vphantom}[text: m] \\
  \csi{hphantom}[text: m]
\end{lscommand}
Each of these typesets an invisible box that has dimensions equal to the text
that it received as an argument. The \csi{vphantom} has zero width, while the
\csi{hphantom} has zero height.

For example, when creating left superscripts and subscripts, they will be
aligned to the left, since they actually apply to the previous (empty) symbol.
A simple fix would be to pad the space using appropriate phantom. In the real
world, it would be better to use the \csi{prescript} command from the
\pai{mathtools} package.
\begin{example}
\( {}^{14}_{6}A \) vs.\
\( \prescript{14}{6}A \) vs.\
\( {}^{14}_{\phantom{1}6}A \)
\end{example}
Left superscripts and subscripts are often found in chemistry, when typesetting
isotopes. If you intend to use \LaTeX{} for that, it is better to use a
dedicated package, such as \pai*{chemformula} or \pai*{mhchem}.

The \csi{vphantom} command is useful if you want to typeset a formula having
delimiters split over multiple lines (since delimiters only work with a
single-line formula inside of them). Using that command, we can artificially
increase the height of the sub-formula, so that the height of the delimiters
will be calculated correctly.
\begin{example}
\NewDocumentCommand{\ud}{}{\,\symrm{d}} %!hide
\begin{multline*}
  f(a, b) = \left(
    \int_a^b f(x)
    loooooong
  \right. \\
  \left.
    \vphantom{
      \int_a^b f(x)
      loooooong
    }
    short \ud x
  \right)
\end{multline*}
\end{example}

\section{Theorems and Proofs}

When writing mathematical documents, you probably need a way to typeset
\enquote{lemmas}, \enquote{definitions}, \enquote{axioms}, and similar
structures. These are known as \emph{theorems} in \LaTeX{}, and can be created
using the
\begin{lscommand}
  \csi{newtheorem}[name:m, counter:o, caption:m, section:o]
\end{lscommand}
command. The \carg{name} argument is name of the newly created environment used
to typeset the theorem. The \carg{caption} argument defines the actual name,
which will be printed in the final document.

The two optional arguments are both used to specify the numbering used on the
\enquote{theorem}. Only one of them may be present. Use the \carg{counter}
argument to specify the \carg{name} of a previously declared \enquote{theorem}.
This will make the new theorem be numbered the same way as the old one. The
\carg{section} argument allows you to specify the sectional unit within which
the theorem should get its numbers. The starred version of the command defines
a theorem without a counter.

After executing the \csi{newtheorem} command in the preamble of your document,
you can use the following environment within the document.
\begin{minted}{latex}
\begin{«\carg{name}»}[«\carg{title}»]
  This is my interesting theorem
\end{«\carg{name}»}
\end{minted}
The optional \carg{title} argument can be used to locally typeset the theorem
name next to the caption.
\begin{example}[standalone, paperheight=4cm]
\newtheorem{proposition}{Proposition}
% ...
\begin{document} %!hide
\begin{proposition}
  I propose that this should
  be enough of dummy text.
\end{proposition}
\begin{proposition}[More]
  It is not enough for more
  than one proposition.
\end{proposition}
\end{document}%!hide
\end{example}

The \pai*{amsthm} package provides the
\begin{lscommand}
  \csi{theoremstyle}[style: m]
\end{lscommand}
command, which lets you further customise a theorem by picking from three
predefined styles: \cargv{definition} (bold title, roman body), \cargv{plain}
(bold title, italic body), or \cargv{remark} (italic title, roman body). An
example of using these commands is presented in \autoref{lst:theorems}
\begin{listing}
  \begin{lined}{\textwidth}
    \begin{example}[standalone, paperheight=6cm]
\usepackage{amsthm}

\theoremstyle{definition}
\newtheorem{axiom}{Axiom}[section]
\theoremstyle{plain}
\newtheorem{theorem}[axiom]{Theorem}
\theoremstyle{remark}
\newtheorem*{remark}{Remark}
% ...
\begin{document} %!hide
\section{First}
\begin{axiom}[Uncertainty]
  Nothing is certain.
\end{axiom}
\begin{theorem}
  It is uncertain whether
  this theorem is true.
\end{theorem}
\begin{remark}[Other things]
  Other things are
  probably also uncertain.
\end{remark}
\end{document}%!hide
\end{example}
  \end{lined}
  \caption{An example of creating several theorem environments with different
    styles.}\label{lst:theorems}
\end{listing}

If you want to customise your theorems down to the last dot, the
\pai*{ntheorem} package offers a plethora of options.

The \pai{amsthm} package also provides the \ei{proof} environment to use with
theorems.
\begin{example}
\begin{proof}
  Trivial.
\end{proof}
\end{example}
The QED symbol (\(\qedsymbol\)) is put at the end of the last line in the
environment. This may create unnecessary lines if the proof does not end with a
paragraph.
\begin{example}
\begin{proof}
  Trivial, use
  \[ E=mc^2. \]
\end{proof}
\end{example}
You can adjust its placement using the \csi{qedhere} command.
\begin{example}
\begin{proof}
 Trivial, use
 \[ E=mc^2. \qedhere \]
\end{proof}
\end{example}

If you do not like the default symbol, you can redefine the \csi{qedsymbol}
macro to your liking.
\begin{example}
\RenewDocumentCommand{%
  \qedsymbol}{}{QED}
\begin{proof}
  Trivial.
\end{proof}
\RenewDocumentCommand{%
  \qedsymbol}{}{\(\QED\)}
\begin{proof}
  Trivial.
\end{proof}
\end{example}

\section{Fiddling with Math Styles}\label{sec:fontsz}

You have already seen that \LaTeX{} typesets mathematics differently, according
to whether it is in inline or display style. There are actually four styles, the
additional two being typically used for super- and subscripts. If you want to
change the style chosen by \LaTeX{}, you can do so by using the commands
presented in \autoref{tbl:math_styles}.
\begin{table}
  \NewDocumentCommand{\mathipsum}{}{\sum_{k = 0}^{\infty} ABCabc123}
  \ExplSyntaxOn
  \NewDocumentCommand{\ShowStyle}{m}{
    \csi{#1} & \(\use:c{#1} \mathipsum \)
  }
  \ExplSyntaxOff
  \caption{Math style commands available in
    \LaTeX{}}\label{tbl:math_styles}
  \begin{tabular}{@{}ll@{}}
    \toprule
    Command & Example             \\
    \midrule
    \ShowStyle{displaystyle}      \\
    \ShowStyle{textstyle}         \\
    \ShowStyle{scriptstyle}       \\
    \ShowStyle{scriptscriptstyle} \\
    \bottomrule
  \end{tabular}
\end{table}

By default, the \csi{frac} command decreases the style of its contents by one
level when possible.
\begin{example}
\[
  \frac
    {\frac
      {\frac{1}{2}}
      {2}}
    {2}
\]
\end{example}
If you want to prevent this, use the appropriate command in its arguments.
\begin{example}
\[
\frac
  {\displaystyle
   \sum_{k=1}^n (x_k - x)^2}
  {\displaystyle
   \left(
    \sum_{k=1}^n (x_k - x)
   \right)^2}
\]
\end{example}

When typesetting formulae within text, you may enclose tall or deep math
expressions, or sub-expressions, within \csi{smash}. This makes \LaTeX{} ignore
the height of these expressions and keeps the line spacing even, but risks
overlap with the surrounding text.
\begin{example}
A \(d_{e_{e_p}}\) mathematical
expression followed by a
\(h^{i^{g^h}}\) expression.
As opposed to a smashed
\smash{\(d_{e_{e_p}}\)}
expression followed by a
\smash{\(h^{i^{g^h}}\)}
expression.
\end{example}

The \csi{smash} command accepts an optional argument---either \cargv{t} or
\cargv{b}---that changes the height of top or bottom part of the symbol to
zero. This may be useful in some rare circumstances, for example, when adjacent
radical symbols don't line up due to differing content heights.
\begin{example}
\(  \sqrt{x}
  + \sqrt{y}
  + \sqrt{z}\)
vs.\
\(  \sqrt{x}
  + \sqrt{\smash[b]{y}}
  + \sqrt{z} \)
\end{example}

\section{Dots}

Use the \csi{dots} command to omit an easily deduced part of a mathematical
expression, like \(0, 1, 2, \dots\) to indicate the sequence of all natural
numbers. It attempts to adjust its output based on the surrounding symbols.
\begin{example}
\(1, 2, 3, \dots, 100\) vs.\
\(1 + 2 + 3 + \dots + 100\)
\end{example}

If the spacing chosen by \LaTeX{} is not appropriate, you can specify it
explicitly by using:
\begin{description}
  \item[\csi{dotsc}] for dots between commas (\(1, 2, \dotsc, 100\))
  \item[\csi{dotsb}] for dots between binary operators or relations (\(1 < 2 <
    \dotsb < 100\))
  \item[\csi{dotsm}] for dots indicating multiplication (\(X_1 X_2 \dotsm
    X_{100}\))
  \item[\csi{dotsi}] for dots between integrals (\(\int_{X_1}\int_{X_2}
    \dotsi \int_{X_{100}}\))
  \item[\csi{dotso}] for dots in situations not matched by any of the above
    (\(1\dotso+\))
\end{description}
\begin{example}
\(1 + 2 + 3 + \dots\) vs.\
\(1 + 2 + 3 + \dotsb\)
\end{example}
You can also redefine the above wrappers if the version chosen by \LaTeX{} is
not to your liking. By default, all of these commands choose between
\csi{ldots}, for dots on baseline, and \csi{cdots}, for centred dots.
\begin{example}
\RenewDocumentCommand{%
  \dotsb}{}{\ldots}
\( 1 + 2 + 3 + \dotsb + 100 \)
\end{example}

In the case of matrices, you may also need non-horizontal dots. These are
accessible from the commands \csi{vdots} (vertical dots \(\vdots\)), \csi{ddots}
(descending dots \(\ddots\)), and \csi{adots} (ascending dots \(\adots\)).
\begin{example}
\[ \begin{bmatrix}
  a_{1,1} & \cdots  & a_{1,n} \\
  \vdots  & \ddots  & \vdots  \\
  a_{m,1} & \cdots  & a_{m,n} \\
\end{bmatrix} \]
\end{example}

\section{More About Fractions}\label{sec:fractions}

You have already learned about the \csi{frac} command for typesetting built-up
fractions. Its output depends on whether it is typeset in display or text
style.
\begin{example}
\( \frac{1}{2} \) vs.\
\[ \frac{1}{2} \]
\end{example}

If you don't want to type \csi{displaystyle} or \csi{textstyle} every time to
correct the style of fractions, you can use \csi{tfrac} and \csi{dfrac}. These
always typeset the fractions in text or display style, respectively.
\begin{example}
\( \dfrac{1}{2} \) vs.\
\( \tfrac{1}{2} \)
\[ \dfrac{1}{2}\text{ vs.\ }
  \tfrac{1}{2} \]
\end{example}

When writing the fractions in-line, often the slashed form \(1/2\) is
preferable for small fractions. You may also want to use the \pai*{xfrac}
package and the \csi{sfrac} command it provides to typeset them in a slashed
form with smaller numbers.
\begin{example}
\( \frac{1}{2} \) vs.\
\sfrac{1}{2} vs.\
\( 1/2 \) vs.\ \textonehalf{}
\end{example}
Note that \csi{sfrac} essentially \enquote*{fakes} the fraction by manually
placing relevant symbols in the given positions. If the faked version is not to
your liking, the package provides more customization options. These are
described in the package documentation. Some fonts support arbitrary fractions
as symbols, which may produce better results; you can find more information
about it in the \autoref{sec:fontspec}.

If you have tried writing continued fractions, you may have noticed that the
spacing is not ideal. The \pai{amsmath} package defines a special \csi{cfrac}
command to fix this issue.
\begin{example}
\[
  \dfrac{1}{
    1 + \dfrac{1}{
      1 + \dfrac{1}{
        1 + \dotsb}}}
\]
vs.\
\[
  \cfrac{1}{
    1 + \cfrac{1}{
      1 + \cfrac{1}{
        1 + \dotsb}}}
\]
\end{example}

Binomial coefficients can be typeset using the \csi{binom}, \csi{tbinom} and
\csi{dbinom} commands. These work the same as the \csi{frac}, \csi{tfrac}
and \csi{dfrac} commands.
\begin{example}
\[
  \sum_{k=0}^{n} \binom{n}{k}
    = 2^{n}
\]
\end{example}

Built-up fractions and binomial coefficients are specialized examples of a
more general command called \csi{genfrac}. It allows you to typeset one
expression over another, with an optional line between them and optional
delimiters. Its full syntax is
\begin{lscommand}
  \csi{genfrac}[left:m, right:m, thickness:m, style: m, num:m, den: m]
\end{lscommand}
The \carg{left} and \carg{right} arguments are the left and right delimiters,
such as parentheses in the case of \csi{binom}. The \carg{thickness} argument
determines the thickness of the line between the expressions. If you leave it
empty, it defaults to the same as that used by \csi{frac}. The \carg{style}
argument is a number from \(0\) to \(3\), and overrides the default math style
used to typeset the symbol. For example, \csi{tfrac} sets it to \(1\), to always
typeset the symbol in text style.

As an example, to create a wrapper for the unsigned Stirling numbers of the
first kind you could write
\begin{chktexignore}
\begin{example}
\NewDocumentCommand{\stirfst}{}{
  \genfrac{[}{]}{0cm}{}
}
\[
  \sum_{k=0}^{n} \stirfst{n}{k}
    = n!
\]
\end{example}
\end{chktexignore}
You should avoid using \csi{genfrac} inside the body of the document, and always
define logical wrappers if you intend to use it in multiple places.

